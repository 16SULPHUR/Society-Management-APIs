/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2022 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
var We=Object.defineProperty;var Ve=(r,e,t)=>e in r?We(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var m=(r,e,t)=>(Ve(r,typeof e!="symbol"?e+"":e,t),t);var qt=r=>{if(typeof r!="string"||!r)return"";let e=r.trim();return e.startsWith("-/")?e=e.slice(2):e.startsWith("/")&&(e=e.slice(1)),e.endsWith("/")&&(e=e.slice(0,e.length-1)),e},_t=(...r)=>r.filter(e=>typeof e=="string"&&e).map(e=>qt(e)).join("/-/"),U=(...r)=>{let e=_t(...r);return e?`-/${e}/`:""};function Yt(r){let e=new URL(r),t=e.pathname+e.search+e.hash,i=t.lastIndexOf("http"),s=t.lastIndexOf("/"),o="";return i>=0?o=t.slice(i):s>=0&&(o=t.slice(s+1)),o}function Zt(r){let e=new URL(r),{pathname:t}=e,i=t.indexOf("/"),s=t.indexOf("/",i+1);return t.substring(i+1,s)}function Qt(r){let e=Jt(r),t=new URL(e),i=t.pathname.indexOf("/-/");return i===-1?[]:t.pathname.substring(i).split("/-/").filter(Boolean).map(o=>qt(o))}function Jt(r){let e=new URL(r),t=Yt(r),i=te(t)?ee(t).pathname:t;return e.pathname=e.pathname.replace(i,""),e.search="",e.hash="",e.toString()}function te(r){return r.startsWith("http")}function ee(r){let e=new URL(r);return{pathname:e.origin+e.pathname||"",search:e.search||"",hash:e.hash||""}}var F=(r,e,t)=>{let i=new URL(Jt(r));if(t=t||Yt(r),i.pathname.startsWith("//")&&(i.pathname=i.pathname.replace("//","/")),te(t)){let s=ee(t);i.pathname=i.pathname+(e||"")+(s.pathname||""),i.search=s.search,i.hash=s.hash}else i.pathname=i.pathname+(e||"")+(t||"");return i.toString()},Dt=(r,e)=>{let t=new URL(r);return t.pathname=e+"/",t.toString()};var P="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";function O(r,e){let t,i=(...s)=>{clearTimeout(t),t=setTimeout(()=>r(...s),e)};return i.cancel=()=>{clearTimeout(t)},i}var Ke=Object.defineProperty,Ge=(r,e,t)=>e in r?Ke(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ut=(r,e,t)=>(Ge(r,typeof e!="symbol"?e+"":e,t),t);function qe(r){let e=t=>{var i;for(let s in t)((i=t[s])==null?void 0:i.constructor)===Object&&(t[s]=e(t[s]));return{...t}};return e(r)}var b=class{constructor(r){r.constructor===Object?this.store=qe(r):(this._storeIsProxy=!0,this.store=r),this.callbackMap=Object.create(null)}static warn(r,e){console.warn(`Symbiote Data: cannot ${r}. Prop name: `+e)}read(r){return!this._storeIsProxy&&!this.store.hasOwnProperty(r)?(b.warn("read",r),null):this.store[r]}has(r){return this._storeIsProxy?this.store[r]!==void 0:this.store.hasOwnProperty(r)}add(r,e,t=!1){!t&&Object.keys(this.store).includes(r)||(this.store[r]=e,this.notify(r))}pub(r,e){if(!this._storeIsProxy&&!this.store.hasOwnProperty(r)){b.warn("publish",r);return}this.store[r]=e,this.notify(r)}multiPub(r){for(let e in r)this.pub(e,r[e])}notify(r){this.callbackMap[r]&&this.callbackMap[r].forEach(e=>{e(this.store[r])})}sub(r,e,t=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(r)?(b.warn("subscribe",r),null):(this.callbackMap[r]||(this.callbackMap[r]=new Set),this.callbackMap[r].add(e),t&&e(this.store[r]),{remove:()=>{this.callbackMap[r].delete(e),this.callbackMap[r].size||delete this.callbackMap[r]},callback:e})}static registerCtx(r,e=Symbol()){let t=b.globalStore.get(e);return t?console.warn('State: context UID "'+e+'" already in use'):(t=new b(r),b.globalStore.set(e,t)),t}static deleteCtx(r){b.globalStore.delete(r)}static getCtx(r,e=!0){return b.globalStore.get(r)||(e&&console.warn('State: wrong context UID - "'+r+'"'),null)}};b.globalStore=new Map;var f=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),se="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",Ye=se.length-1,Ze=class{static generate(r="XXXXXXXXX-XXX"){let e="";for(let t=0;t<r.length;t++)e+=r[t]==="-"?r[t]:se.charAt(Math.random()*Ye);return e}};function oe(r,e,t){let i=!0,s,o=e.split(".");return o.forEach((n,l)=>{l<o.length-1?r=r[n]:s=n}),r?r[s]=t:i=!1,i}function Qe(r){return r.split("-").map((e,t)=>e&&t?e[0].toUpperCase()+e.slice(1):e).join("").split("_").map((e,t)=>e&&t?e.toUpperCase():e).join("")}function Je(r,e){[...r.querySelectorAll(`[${f.REPEAT_ATTR}]`)].forEach(t=>{let i=t.getAttribute(f.REPEAT_ITEM_TAG_ATTR),s;if(i&&(s=window.customElements.get(i)),!s){s=class extends e.BaseComponent{constructor(){super(),i||(this.style.display="contents")}};let n=t.innerHTML;s.template=n,s.reg(i)}for(;t.firstChild;)t.firstChild.remove();let o=t.getAttribute(f.REPEAT_ATTR);e.sub(o,n=>{if(!n){for(;t.firstChild;)t.firstChild.remove();return}let l=[...t.children],a,h=c=>{c.forEach((u,_)=>{if(l[_])if(l[_].set$)setTimeout(()=>{l[_].set$(u)});else for(let g in u)l[_][g]=u[g];else{a||(a=new DocumentFragment);let g=new s;Object.assign(g.init$,u),a.appendChild(g)}}),a&&t.appendChild(a);let d=l.slice(c.length,l.length);for(let u of d)u.remove()};if(n.constructor===Array)h(n);else if(n.constructor===Object){let c=[];for(let d in n){let u=n[d];Object.defineProperty(u,"_KEY_",{value:d,enumerable:!0}),c.push(u)}h(c)}else console.warn("Symbiote repeat data type error:"),console.log(n)}),t.removeAttribute(f.REPEAT_ATTR),t.removeAttribute(f.REPEAT_ITEM_TAG_ATTR)})}var ie="__default__";function ti(r,e){if(e.shadowRoot)return;let t=[...r.querySelectorAll("slot")];if(!t.length)return;let i={};t.forEach(s=>{let o=s.getAttribute("name")||ie;i[o]={slot:s,fr:document.createDocumentFragment()}}),e.initChildren.forEach(s=>{var o;let n=ie;s instanceof Element&&s.hasAttribute("slot")&&(n=s.getAttribute("slot"),s.removeAttribute("slot")),(o=i[n])==null||o.fr.appendChild(s)}),Object.values(i).forEach(s=>{if(s.fr.childNodes.length)s.slot.parentNode.replaceChild(s.fr,s.slot);else if(s.slot.childNodes.length){let o=document.createDocumentFragment();o.append(...s.slot.childNodes),s.slot.parentNode.replaceChild(o,s.slot)}else s.slot.remove()})}function ei(r,e){[...r.querySelectorAll(`[${f.EL_REF_ATTR}]`)].forEach(t=>{let i=t.getAttribute(f.EL_REF_ATTR);e.ref[i]=t,t.removeAttribute(f.EL_REF_ATTR)})}function ii(r,e){[...r.querySelectorAll(`[${f.BIND_ATTR}]`)].forEach(t=>{let s=t.getAttribute(f.BIND_ATTR).split(";");[...t.attributes].forEach(o=>{if(o.name.startsWith("-")&&o.value){let n=Qe(o.name.replace("-",""));s.push(n+":"+o.value),t.removeAttribute(o.name)}}),s.forEach(o=>{if(!o)return;let n=o.split(":").map(c=>c.trim()),l=n[0],a;l.indexOf(f.ATTR_BIND_PRFX)===0&&(a=!0,l=l.replace(f.ATTR_BIND_PRFX,""));let h=n[1].split(",").map(c=>c.trim());for(let c of h){let d;c.startsWith("!!")?(d="double",c=c.replace("!!","")):c.startsWith("!")&&(d="single",c=c.replace("!","")),e.sub(c,u=>{d==="double"?u=!!u:d==="single"&&(u=!u),a?(u==null?void 0:u.constructor)===Boolean?u?t.setAttribute(l,""):t.removeAttribute(l):t.setAttribute(l,u):oe(t,l,u)||(t[f.SET_LATER_KEY]||(t[f.SET_LATER_KEY]=Object.create(null)),t[f.SET_LATER_KEY][l]=u)})}}),t.removeAttribute(f.BIND_ATTR)})}var gt="{{",lt="}}",ri="skip-text";function si(r){let e,t=[],i=document.createTreeWalker(r,NodeFilter.SHOW_TEXT,{acceptNode:s=>{var o;return!((o=s.parentElement)!=null&&o.hasAttribute(ri))&&s.textContent.includes(gt)&&s.textContent.includes(lt)&&1}});for(;e=i.nextNode();)t.push(e);return t}var oi=function(r,e){si(r).forEach(i=>{let s=[],o;for(;i.textContent.includes(lt);)i.textContent.startsWith(gt)?(o=i.textContent.indexOf(lt)+lt.length,i.splitText(o),s.push(i)):(o=i.textContent.indexOf(gt),i.splitText(o)),i=i.nextSibling;s.forEach(n=>{let l=n.textContent.replace(gt,"").replace(lt,"");n.textContent="",e.sub(l,a=>{n.textContent=a})})})},ni=[Je,ti,ei,ii,oi],bt="'",tt='"',li=/\\([0-9a-fA-F]{1,6} ?)/g;function ai(r){return(r[0]===tt||r[0]===bt)&&(r[r.length-1]===tt||r[r.length-1]===bt)}function hi(r){return(r[0]===tt||r[0]===bt)&&(r=r.slice(1)),(r[r.length-1]===tt||r[r.length-1]===bt)&&(r=r.slice(0,-1)),r}function ci(r){let e="",t="";for(var i=0;i<r.length;i++){let s=r[i+1];r[i]==="\\"&&s==='"'?(e+='\\"',i++):r[i]==='"'&&t!=="\\"?e+='\\"':e+=r[i],t=r[i]}return e}function di(r){let e=r;ai(r)&&(e=hi(e),e=e.replace(li,(t,i)=>String.fromCodePoint(parseInt(i.trim(),16))),e=e.replaceAll(`\\
`,"\\n"),e=ci(e),e=tt+e+tt);try{return JSON.parse(e)}catch{throw new Error(`Failed to parse CSS property value: ${e}. Original input: ${r}`)}}var re=0,J=null,z=null,B=class extends HTMLElement{constructor(){super(),Ut(this,"updateCssData",()=>{var r;this.dropCssDataCache(),(r=this.__boundCssProps)==null||r.forEach(e=>{let t=this.getCssData(this.__extractCssName(e),!0);t!==null&&this.$[e]!==t&&(this.$[e]=t)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return B}initCallback(){}__initCallback(){var r;this.__initialized||(this.__initialized=!0,(r=this.initCallback)==null||r.call(this))}render(r,e=this.renderShadow){let t;if((e||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let s=this.getAttribute(f.USE_TPL);if(s){let o=this.getRootNode(),n=(o==null?void 0:o.querySelector(s))||document.querySelector(s);n?r=n.content.cloneNode(!0):console.warn(`Symbiote template "${s}" is not found...`)}}if(this.processInnerHtml)for(let s of this.tplProcessors)s(this,this);if(r||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(r==null?void 0:r.constructor)===DocumentFragment)t=r;else if((r==null?void 0:r.constructor)===String){let s=document.createElement("template");s.innerHTML=r,t=s.content.cloneNode(!0)}else this.constructor.__tpl&&(t=this.constructor.__tpl.content.cloneNode(!0));for(let s of this.tplProcessors)s(t,this)}let i=()=>{t&&(e&&this.shadowRoot.appendChild(t)||this.appendChild(t)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){e=!0;let s=document.createElement("link");s.rel="stylesheet",s.href=this.constructor.__shadowStylesUrl,s.onload=i,this.shadowRoot.prepend(s)}else i()}addTemplateProcessor(r){this.tplProcessors.add(r)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=Ze.generate(),this.style.setProperty(f.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(f.CSS_CTX_PROP,!0)}get ctxName(){var r;let e=((r=this.getAttribute(f.CTX_NAME_ATTR))==null?void 0:r.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=e,e}get localCtx(){return this.__localCtx||(this.__localCtx=b.registerCtx({},this)),this.__localCtx}get nodeCtx(){return b.getCtx(this.ctxName,!1)||b.registerCtx({},this.ctxName)}static __parseProp(r,e){let t,i;if(r.startsWith(f.EXT_DATA_CTX_PRFX))t=e.nodeCtx,i=r.replace(f.EXT_DATA_CTX_PRFX,"");else if(r.includes(f.NAMED_DATA_CTX_SPLTR)){let s=r.split(f.NAMED_DATA_CTX_SPLTR);t=b.getCtx(s[0]),i=s[1]}else t=e.localCtx,i=r;return{ctx:t,name:i}}sub(r,e,t=!0){let i=o=>{this.isConnected&&e(o)},s=B.__parseProp(r,this);s.ctx.has(s.name)?this.allSubs.add(s.ctx.sub(s.name,i,t)):window.setTimeout(()=>{this.allSubs.add(s.ctx.sub(s.name,i,t))})}notify(r){let e=B.__parseProp(r,this);e.ctx.notify(e.name)}has(r){let e=B.__parseProp(r,this);return e.ctx.has(e.name)}add(r,e,t=!1){let i=B.__parseProp(r,this);i.ctx.add(i.name,e,t)}add$(r,e=!1){for(let t in r)this.add(t,r[t],e)}get $(){if(!this.__stateProxy){let r=Object.create(null);this.__stateProxy=new Proxy(r,{set:(e,t,i)=>{let s=B.__parseProp(t,this);return s.ctx.pub(s.name,i),!0},get:(e,t)=>{let i=B.__parseProp(t,this);return i.ctx.read(i.name)}})}return this.__stateProxy}set$(r,e=!1){for(let t in r){let i=r[t];e||![String,Number,Boolean].includes(i==null?void 0:i.constructor)?this.$[t]=i:this.$[t]!==i&&(this.$[t]=i)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(f.CTX_OWNER_ATTR)&&this.getAttribute(f.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let r=this.constructor.__attrDesc;if(r)for(let e of Object.values(r))Object.keys(this.init$).includes(e)||(this.init$[e]="");for(let e in this.init$)if(e.startsWith(f.EXT_DATA_CTX_PRFX))this.nodeCtx.add(e.replace(f.EXT_DATA_CTX_PRFX,""),this.init$[e],this.__ctxOwner);else if(e.includes(f.NAMED_DATA_CTX_SPLTR)){let t=e.split(f.NAMED_DATA_CTX_SPLTR),i=t[0].trim(),s=t[1].trim();if(i&&s){let o=b.getCtx(i,!1);o||(o=b.registerCtx({},i)),o.add(s,this.init$[e])}}else this.localCtx.add(e,this.init$[e]);for(let e in this.cssInit$)this.bindCssData(e,this.cssInit$[e]);this.__dataCtxInitialized=!0}connectedCallback(){var r;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let e=(r=this.getAttribute(f.CTX_NAME_ATTR))==null?void 0:r.trim();if(e&&this.style.setProperty(f.CSS_CTX_PROP,`'${e}'`),this.__initDataCtx(),this[f.SET_LATER_KEY]){for(let t in this[f.SET_LATER_KEY])oe(this,t,this[f.SET_LATER_KEY][t]);delete this[f.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let t of ni)this.addTemplateProcessor(t);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let t=this.getRootNode();if(!t)return;if(t==null?void 0:t.querySelector(`link[${f.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let s=this.constructor.__rootStylesLink.cloneNode(!0);s.setAttribute(f.ROOT_STYLE_ATTR_NAME,this.constructor.is),s.onload=()=>{this.render()},t.nodeType===Node.DOCUMENT_NODE?t.head.appendChild(s):t.prepend(s)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let r of this.allSubs)r.remove(),this.allSubs.delete(r);for(let r of this.tplProcessors)this.tplProcessors.delete(r);z==null||z.delete(this.updateCssData),z!=null&&z.size||(J==null||J.disconnect(),J=null,z=null)},100)))}static reg(r,e=!1){r||(re++,r=`${f.AUTO_TAG_PRFX}-${re}`),this.__tag=r;let t=window.customElements.get(r);if(t){!e&&t!==this&&console.warn([`Element with tag name "${r}" already registered.`,`You're trying to override it with another class "${this.name}".`,"This is most likely a mistake.","New element will not be registered."].join(`
`));return}window.customElements.define(r,e?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(r){this.observedAttributes=Object.keys(r),this.__attrDesc=r}attributeChangedCallback(r,e,t){var i;if(e===t)return;let s=(i=this.constructor.__attrDesc)==null?void 0:i[r];s?this.__dataCtxInitialized?this.$[s]=t:this.init$[s]=t:this[r]=t}getCssData(r,e=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(r)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let t=this.__computedStyle.getPropertyValue(r).trim();try{this.__cssDataCache[r]=di(t)}catch{!e&&console.warn(`CSS Data error: ${r}`),this.__cssDataCache[r]=null}}return this.__cssDataCache[r]}__extractCssName(r){return r.split("--").map((e,t)=>t===0?"":e).join("--")}__initStyleAttrObserver(){z||(z=new Set),z.add(this.updateCssData),J||(J=new MutationObserver(r=>{r[0].type==="attributes"&&z.forEach(e=>{e()})}),J.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(r,e=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(r);let t=this.getCssData(this.__extractCssName(r),!0);t===null&&(t=e),this.add(r,t),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(r,e,t){let i="__"+r;this[i]=this[r],Object.defineProperty(this,r,{set:s=>{this[i]=s,t?window.setTimeout(()=>{e==null||e(s)}):e==null||e(s)},get:()=>this[i]}),this[r]=this[i]}static set shadowStyles(r){let e=new Blob([r],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(e)}static set rootStyles(r){if(!this.__rootStylesLink){let e=new Blob([r],{type:"text/css"}),t=URL.createObjectURL(e),i=document.createElement("link");i.href=t,i.rel="stylesheet",this.__rootStylesLink=i}}},Ft=B;Ut(Ft,"template");var Mt=class{static _print(r){console.warn(r)}static setDefaultTitle(r){this.defaultTitle=r}static setRoutingMap(r){Object.assign(this.appMap,r);for(let e in this.appMap)!this.defaultRoute&&this.appMap[e].default===!0?this.defaultRoute=e:!this.errorRoute&&this.appMap[e].error===!0&&(this.errorRoute=e)}static set routingEventName(r){this.__routingEventName=r}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let r={route:null,options:{}};return window.location.search.split(this.separator).forEach(t=>{if(t.includes("?"))r.route=t.replace("?","");else if(t.includes("=")){let i=t.split("=");r.options[i[0]]=decodeURI(i[1])}else r.options[t]=!0}),r}static notify(){let r=this.readAddressBar(),e=this.appMap[r.route];if(e&&e.title&&(document.title=e.title),r.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!e&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!e&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!e){this._print(`Route "${r.route}" not found...`);return}let t=new CustomEvent(Mt.routingEventName,{detail:{route:r.route,options:Object.assign(e||{},r.options)}});window.dispatchEvent(t)}static reflect(r,e={}){let t=this.appMap[r];if(!t){this._print("Wrong route: "+r);return}let i="?"+r;for(let o in e)e[o]===!0?i+=this.separator+o:i+=this.separator+o+`=${e[o]}`;let s=t.title||this.defaultTitle||"";window.history.pushState(null,s,i),document.title=s}static applyRoute(r,e={}){this.reflect(r,e),this.notify()}static setSeparator(r){this._separator=r}static get separator(){return this._separator||"&"}static createRouterData(r,e){this.setRoutingMap(e);let t=b.registerCtx({route:null,options:null,title:null},r);return window.addEventListener(this.routingEventName,i=>{var s;t.multiPub({route:i.detail.route,options:i.detail.options,title:((s=i.detail.options)==null?void 0:s.title)||this.defaultTitle||""})}),Mt.notify(),this.initPopstateListener(),t}static initPopstateListener(){this.__onPopstate||(this.__onPopstate=()=>{this.notify()},window.addEventListener("popstate",this.__onPopstate))}static removePopstateListener(){window.removeEventListener("popstate",this.__onPopstate),this.__onPopstate=null}};Mt.appMap=Object.create(null);var ne="idb-store-ready",ui="symbiote-db",pi="symbiote-idb-update_",fi=class{_notifyWhenReady(r=null){window.dispatchEvent(new CustomEvent(ne,{detail:{dbName:this.name,storeName:this.storeName,event:r}}))}get _updEventName(){return pi+this.name}_getUpdateEvent(r){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:r}})}_notifySubscribers(r){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,r),window.dispatchEvent(this._getUpdateEvent(r))}constructor(r,e){this.name=r,this.storeName=e,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=t=>{this.db=t.target.result,this.objStore=this.db.createObjectStore(e,{keyPath:"_key"}),this.objStore.transaction.oncomplete=i=>{this._notifyWhenReady(i)}},this.request.onsuccess=t=>{this.db=t.target.result,this._notifyWhenReady(t)},this.request.onerror=t=>{console.error(t)},this._subscriptionsMap={},this._updateHandler=t=>{t.key===this.name&&this._subscriptionsMap[t.newValue]&&this._subscriptionsMap[t.newValue].forEach(async s=>{s(await this.read(t.newValue))})},this._localUpdateHandler=t=>{this._updateHandler(t.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(r){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(r);return new Promise((i,s)=>{t.onsuccess=o=>{var n;(n=o.target.result)!=null&&n._value?i(o.target.result._value):(i(null),console.warn(`IDB: cannot read "${r}"`))},t.onerror=o=>{s(o)}})}write(r,e,t=!1){let i={_key:r,_value:e},o=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(i);return new Promise((n,l)=>{o.onsuccess=a=>{t||this._notifySubscribers(r),n(a.target.result)},o.onerror=a=>{l(a)}})}delete(r,e=!1){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(r);return new Promise((s,o)=>{i.onsuccess=n=>{e||this._notifySubscribers(r),s(n)},i.onerror=n=>{o(n)}})}getAll(){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((t,i)=>{e.onsuccess=s=>{let o=s.target.result;t(o.map(n=>n._value))},e.onerror=s=>{i(s)}})}subscribe(r,e){this._subscriptionsMap[r]||(this._subscriptionsMap[r]=new Set);let t=this._subscriptionsMap[r];return t.add(e),{remove:()=>{t.delete(e),t.size||delete this._subscriptionsMap[r]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,le.clear(this.name)}},le=class{static get readyEventName(){return ne}static open(r=ui,e="store"){let t=r+"/"+e;return this._reg[t]||(this._reg[t]=new fi(r,e)),this._reg[t]}static clear(r){window.indexedDB.deleteDatabase(r);for(let e in this._reg)e.split("/")[0]===r&&delete this._reg[e]}};Ut(le,"_reg",Object.create(null));var R=Object.freeze({UPLOAD_START:"upload-start",REMOVE:"remove",UPLOAD_PROGRESS:"upload-progress",UPLOAD_FINISH:"upload-finish",UPLOAD_ERROR:"upload-error",VALIDATION_ERROR:"validation-error",CLOUD_MODIFICATION:"cloud-modification",DATA_OUTPUT:"data-output",DONE_FLOW:"done-flow",INIT_FLOW:"init-flow"}),mi=Object.freeze({[R.UPLOAD_START]:"LR_UPLOAD_START",[R.REMOVE]:"LR_REMOVE",[R.UPLOAD_PROGRESS]:"LR_UPLOAD_PROGRESS",[R.UPLOAD_FINISH]:"LR_UPLOAD_FINISH",[R.UPLOAD_ERROR]:"LR_UPLOAD_ERROR",[R.VALIDATION_ERROR]:"LR_VALIDATION_ERROR",[R.CLOUD_MODIFICATION]:"LR_CLOUD_MODIFICATION",[R.DATA_OUTPUT]:"LR_DATA_OUTPUT",[R.DONE_FLOW]:"LR_DONE_FLOW",[R.INIT_FLOW]:"LR_INIT_FLOW"}),vt=class{constructor(e){m(this,"_timeoutStore",new Map);m(this,"_targets",new Set);this._getCtxName=e}bindTarget(e){this._targets.add(e)}unbindTarget(e){this._targets.delete(e)}_dispatch(e,t){for(let s of this._targets)s.dispatchEvent(new CustomEvent(e,{detail:t}));let i=mi[e];window.dispatchEvent(new CustomEvent(i,{detail:{ctx:this._getCtxName(),type:i,data:t}}))}emit(e,t,{debounce:i}={}){if(typeof i!="number"&&!i){this._dispatch(e,t);return}this._timeoutStore.has(e)&&window.clearTimeout(this._timeoutStore.get(e));let s=typeof i=="number"?i:20,o=window.setTimeout(()=>{this._dispatch(e,t),this._timeoutStore.delete(e)},s);this._timeoutStore.set(e,o)}};var ae="--uploadcare-blocks-window-height",Y=class{static registerClient(e){this.clientsRegistry.size===0&&this.attachTracker(),this.clientsRegistry.add(e)}static unregisterClient(e){this.clientsRegistry.delete(e),this.clientsRegistry.size===0&&this.detachTracker()}static attachTracker(){window.addEventListener("resize",this.flush,{passive:!0,capture:!0}),this.flush()}static detachTracker(){window.removeEventListener("resize",this.flush,{capture:!0}),document.documentElement.style.removeProperty(ae)}};m(Y,"clientsRegistry",new Set),m(Y,"flush",O(()=>{document.documentElement.style.setProperty(ae,`${window.innerHeight}px`)},100));var he=(r,e)=>new Intl.PluralRules(r).select(e);var _i=r=>r,zt="{{",de="}}",ce="plural:";function Xt(r,e,t={}){var n;let{openToken:i=zt,closeToken:s=de,transform:o=_i}=t;for(let l in e){let a=(n=e[l])==null?void 0:n.toString();r=r.replaceAll(i+l+s,typeof a=="string"?o(a):a)}return r}function ue(r){let e=[],t=r.indexOf(zt);for(;t!==-1;){let i=r.indexOf(de,t),s=r.substring(t+2,i);if(s.startsWith(ce)){let o=r.substring(t+2,i).replace(ce,""),n=o.substring(0,o.indexOf("(")),l=o.substring(o.indexOf("(")+1,o.indexOf(")"));e.push({variable:s,pluralKey:n,countVariable:l})}t=r.indexOf(zt,i)}return e}var W=r=>{var e;return(e=r.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g))==null?void 0:e.map(t=>t.toLowerCase()).join("-")};var yt=({element:r,attribute:e,onSuccess:t,onTimeout:i,timeout:s=300})=>{let o=r.getAttribute(e);if(o!==null){t(o);return}let n=new MutationObserver(h=>{let c=h[h.length-1];a(c)});n.observe(r,{attributes:!0,attributeFilter:[e]});let l=setTimeout(()=>{n.disconnect(),i()},s),a=h=>{let c=r.getAttribute(e);h.type==="attributes"&&h.attributeName===e&&c!==null&&(clearTimeout(l),n.disconnect(),t(c))}};var pe=new Set;function jt(r){pe.has(r)||(pe.add(r),console.warn(r))}var fe=()=>({"*blocksRegistry":new Set,"*eventEmitter":null});function me(r,e){[...r.querySelectorAll("[l10n]")].forEach(t=>{let i=t.getAttribute("l10n"),s="textContent";if(i.includes(":")){let n=i.split(":");s=n[0],i=n[1]}let o="l10n:"+i;e.__l10nKeys.push(o),e.add(o,i),e.sub(o,n=>{t[s]=e.l10n(n)}),t.removeAttribute("l10n")})}var x=r=>`*cfg/${r}`;var Ht="lr-",v=class extends Ft{constructor(){super();m(this,"requireCtxName",!1);m(this,"allowCustomTemplate",!0);m(this,"init$",fe());m(this,"updateCtxCssData",()=>{jt("Using CSS variables for configuration is deprecated. Please use `lr-config` instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/");let t=this.$["*blocksRegistry"];for(let i of t)i.isConnected&&i.updateCssData()});this.activityType=null,this.addTemplateProcessor(me),this.__l10nKeys=[]}l10n(t,i={}){if(!t)return"";let s=this.getCssData("--l10n-"+t,!0)||t,o=ue(s);for(let l of o)i[l.variable]=this.pluralize(l.pluralKey,Number(i[l.countVariable]));return Xt(s,i)}pluralize(t,i){let s=this.l10n("locale-name")||"en-US",o=he(s,i);return this.l10n(`${t}__${o}`)}emit(t,i,s){let o=this.has("*eventEmitter")&&this.$["*eventEmitter"];o&&o.emit(t,i,s)}applyL10nKey(t,i){let s="l10n:"+t;this.$[s]=i,this.__l10nKeys.push(t)}hasBlockInCtx(t){let i=this.$["*blocksRegistry"];for(let s of i)if(t(s))return!0;return!1}setOrAddState(t,i){this.add$({[t]:i},!0)}setActivity(t){if(this.hasBlockInCtx(i=>i.activityType===t)){this.$["*currentActivity"]=t;return}console.warn(`Activity type "${t}" not found in the context`)}connectedCallback(){let t=this.constructor.className;t&&this.classList.toggle(`${Ht}${t}`,!0),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?yt({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback(),Y.registerClient(this)}disconnectedCallback(){super.disconnectedCallback(),Y.unregisterClient(this)}initCallback(){this.$["*blocksRegistry"].add(this),this.$["*eventEmitter"]||(this.$["*eventEmitter"]=new vt(()=>this.ctxName))}destroyCallback(){let t=this.$["*blocksRegistry"];t.delete(this),b.deleteCtx(this),t.size===0&&setTimeout(()=>{this.destroyCtxCallback()},0)}destroyCtxCallback(){b.deleteCtx(this.ctxName)}fileSizeFmt(t,i=2){let s=["B","KB","MB","GB","TB"],o=h=>this.getCssData("--l10n-unit-"+h.toLowerCase(),!0)||h;if(t===0)return`0 ${o(s[0])}`;let n=1024,l=i<0?0:i,a=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/n**a).toFixed(l))+" "+o(s[a])}proxyUrl(t){let i=this.cfg.secureDeliveryProxy;return i?Xt(i,{previewUrl:t},{transform:s=>window.encodeURIComponent(s)}):t}parseCfgProp(t){return{ctx:this.nodeCtx,name:t.replace("*","")}}get cfg(){if(!this.__cfgProxy){let t=Object.create(null);this.__cfgProxy=new Proxy(t,{set:(i,s,o)=>{if(typeof s!="string")return!1;let n=x(s);return this.$[n]=o,!0},get:(i,s)=>{let o=x(s),n=this.parseCfgProp(o);return n.ctx.has(n.name)?n.ctx.read(n.name):(jt("Using CSS variables for configuration is deprecated. Please use `lr-config` instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.getCssData(`--cfg-${W(s)}`))}})}return this.__cfgProxy}subConfigValue(t,i){let s=this.parseCfgProp(x(t));s.ctx.has(s.name)?this.sub(x(t),i):(this.bindCssData(`--cfg-${W(t)}`),this.sub(`--cfg-${W(t)}`,i))}static reg(t){if(!t){super.reg();return}super.reg(t.startsWith(Ht)?t:Ht+t)}};m(v,"StateConsumerScope",null),m(v,"className","");var _e="--cfg-ctx-name",y=class extends v{get cfgCssCtxName(){return this.getCssData(_e,!0)}get cfgCtxName(){var t;let e=((t=this.getAttribute("ctx-name"))==null?void 0:t.trim())||this.cfgCssCtxName||this.__cachedCfgCtxName;return this.__cachedCfgCtxName=e,e}connectedCallback(){var e;if(!this.connectedOnce){let t=(e=this.getAttribute("ctx-name"))==null?void 0:e.trim();t&&this.style.setProperty(_e,`'${t}'`)}super.connectedCallback()}parseCfgProp(e){return{...super.parseCfgProp(e),ctx:b.getCtx(this.cfgCtxName)}}};function ge(...r){return r.reduce((e,t)=>{if(typeof t=="string")return e[t]=!0,e;for(let i of Object.keys(t))e[i]=t[i];return e},{})}function T(...r){let e=ge(...r);return Object.keys(e).reduce((t,i)=>(e[i]&&t.push(i),t),[]).join(" ")}function be(r,...e){let t=ge(...e);for(let i of Object.keys(t))r.classList.toggle(i,t[i])}var ve=r=>{if(!r)return[];let[e,t]=r.split(":").map(Number);if(!Number.isFinite(e)||!Number.isFinite(t)){console.error(`Invalid crop preset: ${r}`);return}return[{type:"aspect-ratio",width:e,height:t}]};var ye=r=>r?r.split(",").map(e=>e.trim()):[],wt=r=>r?r.join(","):"";var Bt=(r,e=",")=>r.trim().split(e).map(t=>t.trim()).filter(t=>t.length>0);var $={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};function gi(r,e){if(typeof e=="number")return $[r]!==e?`${r}/${e}`:"";if(typeof e=="boolean")return e&&$[r]!==e?`${r}`:"";if(r==="filter"){if(!e||$[r]===e.amount)return"";let{name:t,amount:i}=e;return`${r}/${t}/${i}`}if(r==="crop"){if(!e)return"";let{dimensions:t,coords:i}=e;return`${r}/${t.join("x")}/${i.join(",")}`}return""}var Te=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function V(r){return _t(...Te.filter(e=>typeof r[e]!="undefined"&&r[e]!==null).map(e=>{let t=r[e];return gi(e,t)}).filter(e=>!!e))}var Tt=_t("format/auto","progressive/yes"),X=([r])=>typeof r!="undefined"?Number(r):void 0,we=()=>!0,bi=([r,e])=>({name:r,amount:typeof e!="undefined"?Number(e):100}),vi=([r,e])=>({dimensions:Bt(r,"x").map(Number),coords:Bt(e).map(Number)}),yi={enhance:X,brightness:X,exposure:X,gamma:X,contrast:X,saturation:X,vibrance:X,warmth:X,filter:bi,mirror:we,flip:we,rotate:X,crop:vi};function Ce(r){let e={};for(let t of r){let[i,...s]=t.split("/");if(!Te.includes(i))continue;let o=yi[i],n=o(s);e[i]=n}return e}var w=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),E=[w.CROP,w.TUNING,w.FILTERS],xe=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],Ee=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],Ae=["rotate","mirror","flip"],L=Object.freeze({brightness:{zero:$.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:$.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:$.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:$.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:$.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:$.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:$.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:$.enhance,range:[0,100],keypointsNumber:1},filter:{zero:$.filter,range:[0,100],keypointsNumber:1}});var $e=r=>{if(!r)return E;let e=ye(r).filter(t=>E.includes(t));return e.length===0?E:e};function Se(r){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},"*cropPresetList":[],"*tabList":E,"*tabId":w.CROP,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:P,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,cropPreset:"",tabs:wt(E),"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let e=r.querySelectorAll("img");for(let t of e){let i=t.src;t.src=P,t.src=i}r.$["*networkProblems"]=!1},"*on.apply":e=>{if(!e)return;let t=r.$["*originalUrl"],i=U(V(e),"preview"),s=F(t,i),o={originalUrl:t,cdnUrlModifiers:i,cdnUrl:s,transformations:e};r.dispatchEvent(new CustomEvent("apply",{detail:o,bubbles:!0,composed:!0})),r.remove()},"*on.cancel":()=>{r.remove(),r.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}var Oe=`<div class="wrapper wrapper_desktop"><lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;"><div class="network_problems_content"><div class="network_problems_icon"><lr-icon size="20" name="sad"></lr-icon></div><div class="network_problems_text">Network error</div></div><div class="network_problems_footer"><lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui></div></lr-presence-toggle><div class="viewport"><div class="file_type_outer"><div class="file_type">{{fileType}}</div></div><div class="image_container" ref="img-container-el"><img src="${P}" class="image image_visible_from_editor" ref="img-el" /><lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper><lr-editor-image-fader ref="fader-el"></lr-editor-image-fader></div><div class="info_pan">{{msg}}</div></div><div class="toolbar"><lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="toolbar_content toolbar_content__editor"><lr-editor-toolbar></lr-editor-toolbar></div></div></div>`;var K=class extends y{constructor(){super();m(this,"_debouncedShowLoader",O(this._showLoader.bind(this),300));this.init$={...this.init$,...Se(this)}}get ctxName(){return this.autoCtxName}_showLoader(t){this.$.showLoader=t}_waitForSize(){return new Promise((i,s)=>{let o=setTimeout(()=>{s(new Error("[cloud-image-editor] timeout waiting for non-zero container size"))},3e3),n=new ResizeObserver(([l])=>{l.contentRect.width>0&&l.contentRect.height>0&&(i(),clearTimeout(o),n.disconnect())});n.observe(this)})}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async updateImage(){if(this.isConnected){if(await this._waitForSize(),this.$["*tabId"]===w.CROP?this.$["*cropperEl"].deactivate({reset:!0}):this.$["*faderEl"].deactivate(),this.$["*editorTransformations"]={},this.$.cdnUrl){let t=Zt(this.$.cdnUrl);this.$["*originalUrl"]=Dt(this.$.cdnUrl,t);let i=Qt(this.$.cdnUrl),s=Ce(i);this.$["*editorTransformations"]=s}else if(this.$.uuid)this.$["*originalUrl"]=Dt(this.cfg.cdnCname,this.$.uuid);else throw new Error("No UUID nor CDN URL provided");try{let t=F(this.$["*originalUrl"],U("json")),i=await fetch(t).then(n=>n.json()),{width:s,height:o}=i;this.$["*imageSize"]={width:s,height:o},this.$["*tabId"]===w.CROP?this.$["*cropperEl"].activate(this.$["*imageSize"]):this.$["*faderEl"].activate({url:this.$["*originalUrl"]})}catch(t){t&&console.error("Failed to load image info",t)}}}async initEditor(){try{await this._waitForSize()}catch(t){this.isConnected&&console.error(t.message);return}this.ref["img-el"].addEventListener("load",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==P&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",t=>{let i=this.ref["img-el"];i.src!==t&&(this._imgLoading=!0,i.src=t||P)}),this.sub("cropPreset",t=>{this.$["*cropPresetList"]=ve(t)}),this.sub("tabs",t=>{this.$["*tabList"]=$e(t)}),this.sub("*tabId",t=>{this.ref["img-el"].className=T("image",{image_hidden_to_cropper:t===w.CROP,image_hidden_effects:t!==w.CROP})}),this.classList.add("editor_ON"),this.sub("*networkProblems",t=>{this.$["presence.networkProblems"]=t,this.$["presence.modalCaption"]=!t}),this.sub("*editorTransformations",t=>{if(Object.keys(t).length===0)return;let i=this.$["*originalUrl"],s=U(V(t),"preview"),o=F(i,s),n={originalUrl:i,cdnUrlModifiers:s,cdnUrl:o,transformations:t};this.dispatchEvent(new CustomEvent("change",{detail:n,bubbles:!0,composed:!0}))},!1),this.sub("uuid",t=>t&&this.updateImage()),this.sub("cdnUrl",t=>t&&this.updateImage())}};m(K,"className","cloud-image-editor");K.template=Oe;K.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl","crop-preset":"cropPreset",tabs:"tabs"});var at=33.333333333333336,p=1,Wt=24,Ie=6;function Z(r,e){for(let t in e)r.setAttributeNS(null,t,e[t].toString())}function S(r,e={}){let t=document.createElementNS("http://www.w3.org/2000/svg",r);return Z(t,e),t}function Pe(r,e,t){let{x:i,y:s,width:o,height:n}=r,l=e.includes("w")?0:1,a=e.includes("n")?0:1,h=[-1,1][l],c=[-1,1][a],d=[i+l*o+1.5*h,s+a*n+1.5*c-24*t*c],u=[i+l*o+1.5*h,s+a*n+1.5*c],_=[i+l*o-24*t*h+1.5*h,s+a*n+1.5*c];return{d:`M ${d[0]} ${d[1]} L ${u[0]} ${u[1]} L ${_[0]} ${_[1]}`,center:u}}function Re(r,e,t){let{x:i,y:s,width:o,height:n}=r,l=["n","s"].includes(e)?.5:{w:0,e:1}[e],a=["w","e"].includes(e)?.5:{n:0,s:1}[e],h=[-1,1][l],c=[-1,1][a],d,u;["n","s"].includes(e)?(d=[i+l*o-34*t/2,s+a*n+1.5*c],u=[i+l*o+34*t/2,s+a*n+1.5*c]):(d=[i+l*o+1.5*h,s+a*n-34*t/2],u=[i+l*o+1.5*h,s+a*n+34*t/2]);let _=`M ${d[0]} ${d[1]} L ${u[0]} ${u[1]}`,g=[u[0]-(u[0]-d[0])/2,u[1]-(u[1]-d[1])/2];return{d:_,center:g}}function Le(r){return r===""?"move":["e","w"].includes(r)?"ew-resize":["n","s"].includes(r)?"ns-resize":["nw","se"].includes(r)?"nwse-resize":"nesw-resize"}function Ne({rect:r,delta:[e,t],imageBox:i}){return it({...r,x:r.x+e,y:r.y+t},i)}function it(r,e){let{x:t}=r,{y:i}=r;return r.x<e.x?t=e.x:r.x+r.width>e.x+e.width&&(t=e.x+e.width-r.width),r.y<e.y?i=e.y:r.y+r.height>e.y+e.height&&(i=e.y+e.height-r.height),{...r,x:t,y:i}}function wi({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[,s]=e,{y:o,width:n,height:l}=r;o+=s,l-=s,t&&(n=l*t);let a=r.x+r.width/2-n/2;return o<=i.y&&(o=i.y,l=r.y+r.height-o,t&&(n=l*t,a=r.x+r.width/2-n/2)),a<=i.x&&(a=i.x,o=r.y+r.height-l),a+n>=i.x+i.width&&(a=Math.max(i.x,i.x+i.width-n),n=i.x+i.width-a,t&&(l=n/t),o=r.y+r.height-l),l<p&&(l=p,t&&(n=l*t,a=r.x+r.width/2-n/2),o=r.y+r.height-l),n<p&&(n=p,t&&(l=n/t,a=r.x+r.width/2-n/2),o=r.y+r.height-l),{x:a,y:o,width:n,height:l}}function Ti({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s]=e,{x:o,width:n,height:l}=r;o+=s,n-=s,t&&(l=n/t);let a=r.y+r.height/2-l/2;return o<=i.x&&(o=i.x,n=r.x+r.width-o,t&&(l=n/t,a=r.y+r.height/2-l/2)),a<=i.y&&(a=i.y,o=r.x+r.width-n),a+l>=i.y+i.height&&(a=Math.max(i.y,i.y+i.height-l),l=i.y+i.height-a,t&&(n=l*t),o=r.x+r.width-n),l<p&&(l=p,t&&(n=l*t),a=r.y+r.height/2-l/2,o=r.x+r.width-n),n<p&&(n=p,t&&(l=n/t),a=r.y+r.height/2-l/2,o=r.x+r.width-n),{x:o,y:a,width:n,height:l}}function Ci({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[,s]=e,{y:o,width:n,height:l}=r;l+=s,t&&(n=l*t);let a=r.x+r.width/2-n/2;return o+l>=i.y+i.height&&(l=i.y+i.height-o,t&&(n=l*t),a=r.x+r.width/2-n/2),a<=i.x&&(a=i.x,o=r.y),a+n>=i.x+i.width&&(a=Math.max(i.x,i.x+i.width-n),n=i.x+i.width-a,t&&(l=n/t),o=r.y),l<p&&(l=p,t&&(n=l*t),a=r.x+r.width/2-n/2),n<p&&(n=p,t&&(l=n/t),a=r.x+r.width/2-n/2),{x:a,y:o,width:n,height:l}}function xi({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s]=e,{x:o,width:n,height:l}=r;n+=s,t&&(l=n/t);let a=r.y+r.height/2-l/2;return o+n>=i.x+i.width&&(n=i.x+i.width-o,t&&(l=n/t),a=r.y+r.height/2-l/2),a<=i.y&&(a=i.y,o=r.x),a+l>=i.y+i.height&&(a=Math.max(i.y,i.y+i.height-l),l=i.y+i.height-a,t&&(n=l*t),o=r.x),l<p&&(l=p,t&&(n=l*t),a=r.y+r.height/2-l/2),n<p&&(n=p,t&&(l=n/t),a=r.y+r.height/2-l/2),{x:o,y:a,width:n,height:l}}function Ei({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s,o]=e,{x:n,y:l,width:a,height:h}=r;return n+s<i.x&&(s=i.x-n),l+o<i.y&&(o=i.y-l),n+=s,a-=s,l+=o,h-=o,t&&Math.abs(a/h)>t?(o=a/t-h,h+=o,l-=o,l<=i.y&&(h=h-(i.y-l),a=h*t,n=r.x+r.width-a,l=i.y)):t&&(s=h*t-a,a=a+s,n-=s,n<=i.x&&(a=a-(i.x-n),h=a/t,n=i.x,l=r.y+r.height-h)),h<p&&(h=p,t&&(a=h*t),n=r.x+r.width-a,l=r.y+r.height-h),a<p&&(a=p,t&&(h=a/t),n=r.x+r.width-a,l=r.y+r.height-h),{x:n,y:l,width:a,height:h}}function Ai({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s,o]=e,{x:n,y:l,width:a,height:h}=r;return n+a+s>i.x+i.width&&(s=i.x+i.width-n-a),l+o<i.y&&(o=i.y-l),a+=s,l+=o,h-=o,t&&Math.abs(a/h)>t?(o=a/t-h,h+=o,l-=o,l<=i.y&&(h=h-(i.y-l),a=h*t,n=r.x,l=i.y)):t&&(s=h*t-a,a+=s,n+a>=i.x+i.width&&(a=i.x+i.width-n,h=a/t,n=i.x+i.width-a,l=r.y+r.height-h)),h<p&&(h=p,t&&(a=h*t),l=r.y+r.height-h),a<p&&(a=p,t&&(h=a/t),l=r.y+r.height-h),{x:n,y:l,width:a,height:h}}function $i({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s,o]=e,{x:n,y:l,width:a,height:h}=r;return n+s<i.x&&(s=i.x-n),l+h+o>i.y+i.height&&(o=i.y+i.height-l-h),n+=s,a-=s,h+=o,t&&Math.abs(a/h)>t?(o=a/t-h,h+=o,l+h>=i.y+i.height&&(h=i.y+i.height-l,a=h*t,n=r.x+r.width-a,l=i.y+i.height-h)):t&&(s=h*t-a,a+=s,n-=s,n<=i.x&&(a=a-(i.x-n),h=a/t,n=i.x,l=r.y)),h<p&&(h=p,t&&(a=h*t),n=r.x+r.width-a),a<p&&(a=p,t&&(h=a/t),n=r.x+r.width-a),{x:n,y:l,width:a,height:h}}function Si({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s,o]=e,{x:n,y:l,width:a,height:h}=r;return n+a+s>i.x+i.width&&(s=i.x+i.width-n-a),l+h+o>i.y+i.height&&(o=i.y+i.height-l-h),a+=s,h+=o,t&&Math.abs(a/h)>t?(o=a/t-h,h+=o,l+h>=i.y+i.height&&(h=i.y+i.height-l,a=h*t,n=r.x,l=i.y+i.height-h)):t&&(s=h*t-a,a+=s,n+a>=i.x+i.width&&(a=i.x+i.width-n,h=a/t,n=i.x+i.width-a,l=r.y)),h<p&&(h=p,t&&(a=h*t)),a<p&&(a=p,t&&(h=a/t)),{x:n,y:l,width:a,height:h}}function ke({direction:r,...e}){switch(r){case"n":return wi(e);case"w":return Ti(e);case"s":return Ci(e);case"e":return xi(e);case"nw":return Ei(e);case"ne":return Ai(e);case"sw":return $i(e);case"se":return Si(e);default:return e.rect}}function De(r,[e,t]){return r.x<=e&&e<=r.x+r.width&&r.y<=t&&t<=r.y+r.height}function Me(r,e){return r.x>=e.x&&r.y>=e.y&&r.x+r.width<=e.x+e.width&&r.y+r.height<=e.y+e.height}function Ue(r,e){return Math.abs(r.width/r.height-e)<.1}function rt({width:r,height:e},t){let i=t/90%2!==0;return{width:i?e:r,height:i?r:e}}function st(r){return{x:Math.round(r.x),y:Math.round(r.y),width:Math.round(r.width),height:Math.round(r.height)}}function G(r,e,t){return Math.min(Math.max(r,e),t)}var xt=class extends y{constructor(){super(),this.init$={...this.init$,dragging:!1},this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if(e===""&&t.height<=p&&t.width<=p)return!0;let i=t.height<=p&&(e.includes("n")||e.includes("s")),s=t.width<=p&&(e.includes("e")||e.includes("w"));return i||s}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:o}=e,n=this.ref["svg-el"],l=S("mask",{id:"backdrop-mask"}),a=S("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),h=S("rect",{x:t,y:i,width:s,height:o,fill:"black"});l.appendChild(a),l.appendChild(h);let c=S("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});n.appendChild(c),n.appendChild(l),this._backdropMask=l,this._backdropMaskInner=h}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask&&(this._backdropMask.style.display="block")}))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:o}=e;this._backdropMaskInner&&Z(this._backdropMaskInner,{x:t,y:i,width:s,height:o})}_updateFrame(){let e=this.$["*cropBox"];if(!(!e||!this._frameGuides||!this._frameThumbs)){for(let t of Object.values(this._frameThumbs)){let{direction:i,pathNode:s,interactionNode:o,groupNode:n}=t,l=i==="",a=i.length===2,{x:h,y:c,width:d,height:u}=e;if(l){let g={x:h+d/3,y:c+u/3,width:d/3,height:u/3};Z(o,g)}else{let g=G(Math.min(d,u)/(24*2+34)/2,0,1),{d:I,center:H}=a?Pe(e,i,g):Re(e,i,g),M=Math.max(Wt*G(Math.min(d,u)/Wt/3,0,1),Ie);Z(o,{x:H[0]-M,y:H[1]-M,width:M*2,height:M*2}),Z(s,{d:I})}let _=this._shouldThumbBeDisabled(i);n.setAttribute("class",T("thumb",{"thumb--hidden":_,"thumb--visible":!_}))}Z(this._frameGuides,{x:e.x-1*.5,y:e.y-1*.5,width:e.width+1,height:e.height+1})}}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let i=0;i<3;i++){let s=`${["n","","s"][t]}${["w","","e"][i]}`,o=S("g");o.classList.add("thumb"),o.setAttribute("with-effects","");let n=S("rect",{fill:"transparent"}),l=S("path",{stroke:"currentColor",fill:"none","stroke-width":3});o.appendChild(l),o.appendChild(n),e[s]={direction:s,pathNode:l,interactionNode:n,groupNode:o},n.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return e}_createGuides(){let e=S("svg"),t=S("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});e.appendChild(t);for(let i=1;i<=2;i++){let s=S("line",{x1:`${at*i}%`,y1:"0%",x2:`${at*i}%`,y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(s)}for(let i=1;i<=2;i++){let s=S("line",{x1:"0%",y1:`${at*i}%`,x2:"100%",y2:`${at*i}%`,stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(s)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),i=this._createGuides();t.appendChild(i);let s=this._createThumbs();for(let{groupNode:o}of Object.values(s))t.appendChild(o);e.appendChild(t),this._frameThumbs=s,this._frameGuides=i}_handlePointerDown(e,t){if(!this._frameThumbs)return;let i=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let s=this.$["*cropBox"],{x:o,y:n}=this.ref["svg-el"].getBoundingClientRect(),l=t.x-o,a=t.y-n;this.$.dragging=!0,this._draggingThumb=i,this._dragStartPoint=[l,a],this._dragStartCrop={...s}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging||!this._dragStartPoint||!this._draggingThumb)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:i,y:s}=t.getBoundingClientRect(),o=e.x-i,n=e.y-s,l=o-this._dragStartPoint[0],a=n-this._dragStartPoint[1],{direction:h}=this._draggingThumb,c=this._calcCropBox(h,[l,a]);c&&(this.$["*cropBox"]=c)}_calcCropBox(e,t){var h,c;let[i,s]=t,o=this.$["*imageBox"],n=(h=this._dragStartCrop)!=null?h:this.$["*cropBox"],l=(c=this.$["*cropPresetList"])==null?void 0:c[0],a=l?l.width/l.height:void 0;if(e===""?n=Ne({rect:n,delta:[i,s],imageBox:o}):n=ke({rect:n,delta:[i,s],direction:e,aspectRatio:a,imageBox:o}),!Object.values(n).every(d=>Number.isFinite(d)&&d>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:n});return}return it(st(n),this.$["*imageBox"])}_handleSvgPointerMove_(e){if(!this._frameThumbs)return;let t=Object.values(this._frameThumbs).find(i=>{if(this._shouldThumbBeDisabled(i.direction))return!1;let o=i.interactionNode.getBoundingClientRect(),n={x:o.x,y:o.y,width:o.width,height:o.height};return De(n,[e.x,e.y])});this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;this.ref["svg-el"].style.cursor=e?Le(e.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){this._frameThumbs&&Object.values(this._frameThumbs).map(({groupNode:t})=>t).forEach(t=>{t.setAttribute("class",T("thumb",{"thumb--hidden":!e,"thumb--visible":e}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",e=>{e&&(this._guidesHidden=e.height<=p||e.width<=p,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",e=>{this._frameGuides&&this._frameGuides.setAttribute("class",T({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}};xt.template='<svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg>';var j=class extends y{constructor(){super(...arguments);m(this,"init$",{...this.init$,active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",t=>{this._titleEl&&(this._titleEl.style.display=t?"block":"none")}),this.sub("active",t=>{this.className=T({active:t,not_active:!t})}),this.sub("on.click",t=>{this.onclick=t})}};j.template=`<div class="before"></div><lr-icon size="20" set="@name: icon;"></lr-icon><div class="title" ref="title-el">{{title}}</div>`;function Ii(r){let e=r+90;return e=e>=360?0:e,e}function Pi(r,e){return r==="rotate"?Ii(e):["mirror","flip"].includes(r)?!e:null}var ht=class extends j{initCallback(){super.initCallback(),this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e)}),this.$["on.click"]=e=>{let t=this.$["*cropperEl"].getValue(this._operation),i=Pi(this._operation,t);this.$["*cropperEl"].setValue(this._operation,i)}}};var ct={FILTER:"filter",COLOR_OPERATION:"color_operation"},k="original",Et=class extends y{constructor(){super(...arguments);m(this,"init$",{...this.init$,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":t=>{this.$["*faderEl"].set(t),this.$.value=t}})}setOperation(t,i){this._controlType=t==="filter"?ct.FILTER:ct.COLOR_OPERATION,this._operation=t,this._iconName=t,this._title=t.toUpperCase(),this._filter=i,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===k?void 0:this.$.value,filter:this._filter===k?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:t,zero:i}=L[this._operation],[s,o]=t;this.$.min=s,this.$.max=o,this.$.zero=i;let n=this.$["*editorTransformations"][this._operation];if(this._controlType===ct.FILTER){let l=o;if(n){let{name:a,amount:h}=n;l=a===this._filter?h:o}this.$.value=l,this.$.defaultValue=l}if(this._controlType===ct.COLOR_OPERATION){let l=typeof n!="undefined"?n:i;this.$.value=l,this.$.defaultValue=l}}apply(){let t;this._controlType===ct.FILTER?this._filter===k?t=null:t={name:this._filter,amount:this.$.value}:t=this.$.value;let i={...this.$["*editorTransformations"],[this._operation]:t};this.$["*editorTransformations"]=i}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",t=>{this._originalUrl=t}),this.sub("value",t=>{let i=`${this._filter||this._operation} ${t}`;this.$["*operationTooltip"]=i})}};Et.template=`<lr-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;" ></lr-slider-ui>`;function dt(r){let e=new Image;return{promise:new Promise((s,o)=>{e.src=r,e.onload=s,e.onerror=o}),image:e,cancel:()=>{e.naturalWidth===0&&(e.src=P)}}}function ut(r){let e=[];for(let o of r){let n=dt(o);e.push(n)}let t=e.map(o=>o.image);return{promise:Promise.allSettled(e.map(o=>o.promise)),images:t,cancel:()=>{e.forEach(o=>{o.cancel()})}}}var ot=class extends j{constructor(){super(...arguments);m(this,"init$",{...this.init$,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let t=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),i=window.devicePixelRatio,s=Math.ceil(i*t),o=i>=2?"lightest":"normal",n=100,l={...this.$["*editorTransformations"]};return l[this._operation]=this._filter!==k?{name:this._filter,amount:n}:void 0,F(this._originalUrl,U(Tt,V(l),`quality/${o}`,`scale_crop/${s}x${s}/center`))}_observerCallback(t,i){if(t[0].isIntersecting){let o=this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"],{promise:l,cancel:a}=dt(o);this._cancelPreload=a,l.catch(h=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:h})}).finally(()=>{n.style.backgroundImage=`url(${o})`,n.setAttribute("loaded",""),i.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=i=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",i=>{this._operation="filter",this._filter=i,this.$.isOriginal=i===k,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let t=this.$["*originalUrl"];this._originalUrl=t,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",i=>{this.$.active=i&&i===this._filter}),this.sub("isOriginal",i=>{this.$.iconSize=i?40:20}),this.sub("active",i=>{if(this.$.isOriginal)return;let s=this.ref["icon-el"];s.style.opacity=i?"1":"0";let o=this.ref["preview-el"];i?o.style.opacity="0":o.style.backgroundImage&&(o.style.opacity="1")}),this.sub("*networkProblems",i=>{if(!i){let s=this.proxyUrl(this._previewSrc()),o=this.ref["preview-el"];o.style.backgroundImage&&(o.style.backgroundImage="none",o.style.backgroundImage=`url(${s})`)}})}destroyCallback(){var t;super.destroyCallback(),(t=this._observer)==null||t.disconnect(),this._cancelPreload&&this._cancelPreload()}};ot.template=`<div class="before"></div><div class="preview" ref="preview-el"></div><lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>`;var pt=class extends j{constructor(){super(...arguments);m(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",t=>{t&&(this._operation=t,this.$.icon=t,this.$.title=this.l10n(t))}),this.sub("*editorTransformations",t=>{if(!this._operation)return;let{zero:i}=L[this._operation],s=t[this._operation],o=typeof s!="undefined"?s!==i:!1;this.$.active=o})}};var Fe=(r,e)=>{let t,i,s;return(...o)=>{t?(clearTimeout(i),i=setTimeout(()=>{Date.now()-s>=e&&(r(...o),s=Date.now())},Math.max(e-(Date.now()-s),0))):(r(...o),s=Date.now(),t=!0)}};function ze(r,e){let t={};for(let i of e){let s=r[i];(r.hasOwnProperty(i)||s!==void 0)&&(t[i]=s)}return t}function nt(r,e,t){let s=window.devicePixelRatio,o=Math.min(Math.ceil(e*s),3e3),n=s>=2?"lightest":"normal";return F(r,U(Tt,V(t),`quality/${n}`,`stretch/off/-/resize/${o}x`))}function Ri(r){return r?[({dimensions:t,coords:i})=>[...t,...i].every(s=>Number.isInteger(s)&&Number.isFinite(s)),({dimensions:t,coords:i})=>t.every(s=>s>0)&&i.every(s=>s>=0)].every(t=>t(r)):!0}var At=class extends y{constructor(){super(),this.init$={...this.init$,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}},this._commitDebounced=O(this._commit.bind(this),300),this._handleResizeThrottled=Fe(this._handleResize.bind(this),100),this._imageSize={width:0,height:0}}_handleResize(){!this.isConnected||!this._isActive||(this._initCanvas(),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let e=this.$["*editorTransformations"],t=ze(e,Object.keys(this.$["*operations"])),i={...this.$["*operations"],...t};this.$["*operations"]=i}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),i=this.offsetWidth,s=this.offsetHeight,o=window.devicePixelRatio;e.style.width=`${i}px`,e.style.height=`${s}px`,e.width=i*o,e.height=s*o,t==null||t.scale(o,o),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],i=this.$["*operations"],{rotate:s}=i,o={width:this.offsetWidth,height:this.offsetHeight},n=rt({width:e.naturalWidth,height:e.naturalHeight},s),l;if(n.width>o.width-t*2||n.height>o.height-t*2){let a=n.width/n.height,h=o.width/o.height;if(a>h){let c=o.width-t*2,d=c/a,u=0+t,_=t+(o.height-t*2)/2-d/2;l={x:u,y:_,width:c,height:d}}else{let c=o.height-t*2,d=c*a,u=t+(o.width-t*2)/2-d/2,_=0+t;l={x:u,y:_,width:d,height:c}}}else{let{width:a,height:h}=n,c=t+(o.width-t*2)/2-a/2,d=t+(o.height-t*2)/2-h/2;l={x:c,y:d,width:a,height:h}}this.$["*imageBox"]=st(l)}_alignCrop(){var d;let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,o=this.$["*editorTransformations"].crop,{width:n,x:l,y:a}=this.$["*imageBox"];if(o){let{dimensions:[u,_],coords:[g,I]}=o,{width:H}=rt(this._imageSize,s),M=n/H;e=it(st({x:l+g*M,y:a+I*M,width:u*M,height:_*M}),this.$["*imageBox"])}let h=(d=this.$["*cropPresetList"])==null?void 0:d[0],c=h?h.width/h.height:void 0;if(!Me(e,t)||c&&!Ue(e,c)){let u=t.width/t.height,_=t.width,g=t.height;c&&(u>c?_=Math.min(t.height*c,t.width):g=Math.min(t.width/c,t.height)),e={x:t.x+t.width/2-_/2,y:t.y+t.height/2-g/2,width:_,height:g}}this.$["*cropBox"]=it(st(e),this.$["*imageBox"])}_drawImage(){let e=this._ctx;if(!e)return;let t=this.$.image,i=this.$["*imageBox"],s=this.$["*operations"],{mirror:o,flip:n,rotate:l}=s,a=rt({width:i.width,height:i.height},l);e.save(),e.translate(i.x+i.width/2,i.y+i.height/2),e.rotate(l*Math.PI*-1/180),e.scale(o?-1:1,n?-1:1),e.drawImage(t,-a.width/2,-a.height/2,a.width,a.height),e.restore()}_draw(){if(!this._isActive||!this.$.image||!this._canvas||!this._ctx)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=T({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1})}))}_getCropDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:o,height:n}=t,{width:l,height:a}=rt(this._imageSize,s),{width:h,height:c}=e,d=o/l,u=n/a;return[G(Math.round(h/d),1,l),G(Math.round(c/u),1,a)]}_getCropTransformation(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:o,height:n,x:l,y:a}=t,{width:h,height:c}=rt(this._imageSize,s),{x:d,y:u}=e,_=o/h,g=n/c,I=this._getCropDimensions(),H={dimensions:I,coords:[G(Math.round((d-l)/_),0,h-I[0]),G(Math.round((u-a)/g),0,c-I[1])]};if(!Ri(H)){console.error("Cropper is trying to create invalid crop object",{payload:H});return}if(!(I[0]===h&&I[1]===c))return H}_commit(){if(!this.isConnected)return;let e=this.$["*operations"],{rotate:t,mirror:i,flip:s}=e,o=this._getCropTransformation(),l={...this.$["*editorTransformations"],crop:o,rotate:t,mirror:i,flip:s};this.$["*editorTransformations"]=l}setValue(e,t){console.log(`Apply cropper operation [${e}=${t}]`),this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}={}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset);try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._animateIn({fromViewer:t})}catch(i){console.error("Failed to activate cropper",{error:i})}this._observer=new ResizeObserver(([i])=>{i.contentRect.width>0&&i.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeThrottled()}),this._observer.observe(this)}}deactivate({reset:e=!1}={}){var t;this._isActive&&(!e&&this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=T({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}),(t=this._observer)==null||t.disconnect())}_transitionToCrop(){let e=this._getCropDimensions(),t=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,i=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,s=Math.min(t,i),o=this.$["*cropBox"].x+this.$["*cropBox"].width/2,n=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${s}) translate(${(this.offsetWidth/2-o)/s}px, ${(this.offsetHeight/2-n)/s}px)`,this.style.transformOrigin=`${o}px ${n}px`}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,t=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${e}px ${t}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let i=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let s=this.proxyUrl(nt(e,i,t)),{promise:o,cancel:n,image:l}=dt(s),a=this._handleImageLoading(s);return l.addEventListener("load",a,{once:!0}),l.addEventListener("error",a,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=n,o.then(()=>l).catch(h=>(console.error("Failed to load image",{error:h}),this.$["*networkProblems"]=!0,Promise.resolve(l)))}_handleImageLoading(e){let t="crop",i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{var s;(s=i==null?void 0:i.get(t))!=null&&s.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}initCallback(){super.initCallback(),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",()=>{this.$.image&&this._commitDebounced()}),this.sub("*cropPresetList",()=>{this._alignCrop()}),setTimeout(()=>{this.sub("*networkProblems",e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect()}};At.template=`<canvas class="canvas" ref="canvas-el"></canvas><lr-crop-frame ref="frame-el"></lr-crop-frame>`;function Vt(r,e,t){let i=Array(t);t--;for(let s=t;s>=0;s--)i[s]=Math.ceil((s*e+(t-s)*r)/t);return i}function Li(r){return r.reduce((e,t,i)=>i<r.length-1?[...e,[t,r[i+1]]]:e,[])}function Ni(r,e,t){let i=Li(r).find(([s,o])=>s<=e&&e<=o);return r.map(s=>{let o=Math.abs(i[0]-i[1]),n=Math.abs(e-i[0])/o;return i[0]===s?e>t?1:1-n:i[1]===s?e>=t?n:1:0})}function ki(r,e){return r.map((t,i)=>t<e?r.length-i:i)}function Xe(r,e){let t=L[r].keypointsNumber,{range:i,zero:s}=L[r];return[...new Set([...Vt(i[0],s,t+1),...Vt(s,i[1],t+1),s,e])].sort((o,n)=>o-n)}var Kt=class extends y{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=O(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(e){let t=this._operation,i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{var s;(s=i==null?void 0:i.get(t))!=null&&s.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let e of this._keypoints){let{image:t}=e;t&&(t.style.opacity=e.opacity.toString(),t.style.zIndex=e.zIndex.toString())}})}_imageSrc({url:e=this._url,filter:t=this._filter,operation:i,value:s}={}){let o={...this._transformations};i&&(o[i]=t?{name:t,amount:s}:s);let n=this.offsetWidth;return this.proxyUrl(nt(e,n,o))}_constructKeypoint(e,t){return{src:this._imageSrc({operation:e,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(e,t){return this._operation===e&&this._filter===t}_addKeypoint(e,t,i){let s=()=>!this._isSame(e,t)||this._value!==i||!!this._keypoints.find(a=>a.value===i);if(s())return;let o=this._constructKeypoint(e,i),n=new Image;n.src=o.src;let l=this._handleImageLoading(o.src);n.addEventListener("load",l,{once:!0}),n.addEventListener("error",l,{once:!0}),o.image=n,n.classList.add("fader-image"),n.addEventListener("load",()=>{if(s())return;let a=this._keypoints,h=a.findIndex(d=>d.value>i),c=h<a.length?a[h].image:null;!this._container||c&&!this._container.contains(c)||(a.splice(h,0,o),this._container.insertBefore(n,c),this._update(e,i))},{once:!0}),n.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(e){e=typeof e=="string"?parseInt(e,10):e,this._update(this._operation,e),this._addKeypointDebounced(this._operation,this._filter,e)}_update(e,t){this._operation=e,this._value=t;let{zero:i}=L[e],s=this._keypoints.map(l=>l.value),o=Ni(s,t,i),n=ki(s,i);for(let[l,a]of Object.entries(this._keypoints))a.opacity=o[l],a.zIndex=n[l];this._flush()}_createPreviewImage(){let e=new Image;return e.classList.add("fader-image","fader-image--preview"),e.style.opacity="0",e}async _initNodes(){let e=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&e.appendChild(this._previewImage);let t=document.createElement("div");e.appendChild(t);let i=this._keypoints.map(h=>h.src),{images:s,promise:o,cancel:n}=ut(i);s.forEach(h=>{let c=this._handleImageLoading(h.src);h.addEventListener("load",c),h.addEventListener("error",c)}),this._cancelLastImages=()=>{n(),this._cancelLastImages=void 0};let l=this._operation,a=this._filter;await o,this._isActive&&this._isSame(l,a)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach((h,c)=>{let d=s[c];d.classList.add("fader-image"),h.image=d,this._container.appendChild(d)}),this.appendChild(e),this._flush())}setTransformations(e){if(this._transformations=e,this._previewImage){let t=this._imageSrc(),i=this._handleImageLoading(t);this._previewImage.src=t,this._previewImage.addEventListener("load",i,{once:!0}),this._previewImage.addEventListener("error",i,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:e,filter:t,operation:i,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let n=Xe(i,s).map(a=>this._imageSrc({url:e,filter:t,operation:i,value:a})),{cancel:l}=ut(n);this._cancelBatchPreload=l}_setOriginalSrc(e){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===e){t.style.opacity="1",t.style.transform="scale(1)",this.className=T({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1});return}t.style.opacity="0";let i=this._handleImageLoading(e);t.addEventListener("error",i,{once:!0}),t.src=e,t.addEventListener("load",()=>{i(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=T({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))},{once:!0}),t.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:e,operation:t,value:i,filter:s,fromViewer:o}){if(this._isActive=!0,this._hidden=!1,this._url=e,this._operation=t||"initial",this._value=i,this._filter=s,this._fromViewer=o,typeof i!="number"&&!s){let l=this._imageSrc({operation:t,value:i});this._setOriginalSrc(l),this._container&&this._container.remove();return}this._keypoints=Xe(t,i).map(l=>this._constructKeypoint(t,l)),this._update(t,i),this._initNodes()}deactivate({hide:e=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),e&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=T({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}};var Di=1,$t=class extends y{initCallback(){super.initCallback(),this.addEventListener("wheel",e=>{e.preventDefault();let{deltaY:t,deltaX:i}=e;Math.abs(i)>Di?this.scrollLeft+=i:this.scrollLeft+=t})}};$t.template=" <slot></slot> ";function Mi(r){return`<lr-presence-toggle class="tab-toggle" set="visible: presence.tabToggle.${r}; styles: presence.tabToggleStyles;"><lr-btn-ui theme="boring" ref="tab-toggle-${r}" data-id="${r}" icon="${r}" tabindex="0" set="onclick: on.clickTab;" ></lr-btn-ui></lr-presence-toggle>`}function Ui(r){return`<lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${r}; styles: presence.tabContentStyles"><lr-editor-scroller hidden-scrollbar><div class="controls-list_align"><div class="controls-list_inner" ref="controls-list-${r}"></div></div></lr-editor-scroller></lr-presence-toggle>`}var St=class extends y{constructor(){super();m(this,"_updateInfoTooltip",O(()=>{var n,l;let t=this.$["*editorTransformations"],i=this.$["*currentOperation"],s="",o=!1;if(this.$["*tabId"]===w.FILTERS)if(o=!0,this.$["*currentFilter"]&&((n=t==null?void 0:t.filter)==null?void 0:n.name)===this.$["*currentFilter"]){let a=((l=t==null?void 0:t.filter)==null?void 0:l.amount)||100;s=this.l10n(this.$["*currentFilter"])+" "+a}else s=this.l10n(k);else if(this.$["*tabId"]===w.TUNING&&i){o=!0;let a=(t==null?void 0:t[i])||L[i].zero;s=i+" "+a}o&&(this.$["*operationTooltip"]=s),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",o)},0));this.init$={...this.init$,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":k,"*currentOperation":null,showLoader:!1,filters:Ee,colorOperations:xe,cropOperations:Ae,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabToggles":!0,"presence.tabContent.crop":!1,"presence.tabContent.tuning":!1,"presence.tabContent.filters":!1,"presence.tabToggle.crop":!0,"presence.tabToggle.tuning":!0,"presence.tabToggle.filters":!0,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"presence.tabToggleStyles":{hidden:"tab-toggle--hidden",visible:"tab-toggle--visible"},"presence.tabTogglesStyles":{hidden:"tab-toggles--hidden",visible:"tab-toggles--visible"},"on.cancel":()=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":()=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":()=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":()=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":t=>{let i=t.currentTarget.getAttribute("data-id");i&&this._activateTab(i,{fromViewer:!1})}},this._debouncedShowLoader=O(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===w.TUNING&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(t){let i=new pt;return i.operation=t,i}_createFilterControl(t){let i=new ot;return i.filter=t,i}_createToggleControl(t){let i=new ht;return i.operation=t,i}_renderControlsList(t){let i=this.ref[`controls-list-${t}`],s=document.createDocumentFragment();t===w.CROP?this.$.cropOperations.forEach(o=>{let n=this._createToggleControl(o);s.appendChild(n)}):t===w.FILTERS?[k,...this.$.filters].forEach(o=>{let n=this._createFilterControl(o);s.appendChild(n)}):t===w.TUNING&&this.$.colorOperations.forEach(o=>{let n=this._createOperationControl(o);s.appendChild(n)}),[...s.children].forEach((o,n)=>{n===s.childNodes.length-1&&o.classList.add("controls-list_last-item")}),i.innerHTML="",i.appendChild(s)}_activateTab(t,{fromViewer:i}){this.$["*tabId"]=t,t===w.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:i})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:i}),this.$["*cropperEl"].deactivate());for(let s of E){let o=s===t,n=this.ref[`tab-toggle-${s}`];n.active=o,o?(this._renderControlsList(t),this._syncTabIndicator()):this._unmountTabControls(s),this.$[`presence.tabContent.${s}`]=o}}_unmountTabControls(t){let i=this.ref[`controls-list-${t}`];i&&(i.innerHTML="")}_syncTabIndicator(){let t=this.ref[`tab-toggle-${this.$["*tabId"]}`],i=this.ref["tabs-indicator"];i.style.transform=`translateX(${t.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let t=this.$["*imgContainerEl"].offsetWidth,i=this.proxyUrl(nt(this.$["*originalUrl"],t,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:s}=ut([i]);this._cancelPreload=()=>{s(),this._cancelPreload=void 0}}}_showLoader(t){this.$.showLoader=t}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",t=>{t&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",t=>{var s;let i=(s=t==null?void 0:t.filter)==null?void 0:s.name;this.$["*currentFilter"]!==i&&(this.$["*currentFilter"]=i)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",()=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",t=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(t)}),this.sub("*loadingOperations",t=>{let i=!1;for(let[,s]of t.entries()){if(i)break;for(let[,o]of s.entries())if(o){i=!0;break}}this._debouncedShowLoader(i)}),this.sub("*showSlider",t=>{this.$["presence.subToolbar"]=t,this.$["presence.mainToolbar"]=!t}),this.sub("*tabList",t=>{this.$["presence.tabToggles"]=t.length>1;for(let i of E){this.$[`presence.tabToggle.${i}`]=t.includes(i);let s=this.ref[`tab-toggle-${i}`];s.style.gridColumn=t.indexOf(i)+1}t.includes(this.$["*tabId"])||this._activateTab(t[0],{fromViewer:!1})}),this._updateInfoTooltip()}};St.template=`<lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="info-tooltip_container"><div class="info-tooltip_wrapper"><div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div></div></div><div class="toolbar-container"><lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"><div class="tab-content-row">${E.map(Ui).join("")}</div><div class="controls-row"><lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"></lr-btn-ui><lr-presence-toggle class="tab-toggles" set="visible: presence.tabToggles; styles: presence.tabTogglesStyles"><div ref="tabs-indicator" class="tab-toggles_indicator"></div> ${E.map(Mi).join("")} </lr-presence-toggle><lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"></lr-btn-ui></div></lr-presence-toggle><lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"><div class="slider"><lr-editor-slider ref="slider-el"></lr-editor-slider></div><div class="controls-row"><lr-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"></lr-btn-ui><lr-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"></lr-btn-ui></div></lr-presence-toggle></div>`;var ft=class extends v{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.init$,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return T("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",e=>{this._iconSingle=!this.$.text,this._iconHidden=!e,this.$.iconCss=this._iconCss()}),this.sub("theme",e=>{e!=="custom"&&(this.className=e)}),this.sub("text",e=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(e){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}};ft.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});ft.template=`<lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon><div class="text">{{text}}</div>`;var Ot=class extends v{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",e=>{typeof e=="boolean"&&(e?this._start():this._stop())})}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${e}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}};Ot.template=`<div class="inner"><div class="line" ref="line-el"></div></div>`;var It={transition:"transition",visible:"visible",hidden:"hidden"},Pt=class extends v{constructor(){super(),this._visible=!1,this._visibleStyle=It.visible,this._hiddenStyle=It.hidden,this._externalTransitions=!1,this.defineAccessor("styles",e=>{e&&(this._externalTransitions=!0,this._visibleStyle=e.visible,this._hiddenStyle=e.hidden)}),this.defineAccessor("visible",e=>{typeof e=="boolean"&&(this._visible=e,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",be(this,{[It.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(It.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}};Pt.template=" <slot></slot> ";var Rt=class extends v{constructor(){super();m(this,"init$",{...this.init$,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t),this.$.onInput&&this.$.onInput(t)},"on.sliderChange":()=>{let t=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(t)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",i=>{this.$.disabled=i}),this.defineAccessor("min",i=>{this.$.min=i}),this.defineAccessor("max",i=>{this.$.max=i}),this.defineAccessor("defaultValue",i=>{this.$.defaultValue=i,this.ref["input-el"].value=i,this._updateValue(i)}),this.defineAccessor("zero",i=>{this._zero=i}),this.defineAccessor("onInput",i=>{i&&(this.$.onInput=i)}),this.defineAccessor("onChange",i=>{i&&(this.$.onChange=i)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let i=parseInt(this.ref["input-el"].value,10);this._updateValue(i)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let i=parseInt(this.ref["input-el"].value,10);this._updateValue(i)},0),this.sub("disabled",i=>{let s=this.ref["input-el"];i?s.setAttribute("disabled","disabled"):s.removeAttribute("disabled")});let t=this.ref["input-el"];t.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),t.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(t){this._updateZeroDot(t);let{width:i}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(t-this.$.min)*(i-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${n}px)`})}_updateZeroDot(t){if(!this._zeroDotEl)return;t===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:i}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(i-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${n}px)`})}_updateSteps(){let i=this.ref["steps-el"],{width:s}=i.getBoundingClientRect(),o=Math.ceil(s/2),n=Math.ceil(o/15)-2;if(this._stepsCount===n)return;let l=document.createDocumentFragment(),a=document.createElement("div"),h=document.createElement("div");a.className="minor-step",h.className="border-step",l.appendChild(h);for(let d=0;d<n;d++)l.appendChild(a.cloneNode());l.appendChild(h.cloneNode());for(let d=0;d<n;d++)l.appendChild(a.cloneNode());l.appendChild(h.cloneNode());let c=document.createElement("div");c.className="zero-dot",l.appendChild(c),this._zeroDotEl=c,i.innerHTML="",i.appendChild(l),this._stepsCount=n}destroyCallback(){var t;(t=this._observer)==null||t.disconnect()}};Rt.template=`<div class="steps" ref="steps-el"></div><div ref="thumb-el" class="thumb"></div><input class="input" type="range" ref="input-el" tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;" />`;var Fi="css-src";function Gt(r){return class extends r{constructor(){super(...arguments);m(this,"renderShadow",!0);m(this,"pauseRender",!0);m(this,"requireCtxName",!0)}shadowReadyCallback(){}initCallback(){super.initCallback(),this.setAttribute("hidden",""),yt({element:this,attribute:Fi,onSuccess:t=>{this.attachShadow({mode:"open"});let i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t,i.onload=()=>{window.requestAnimationFrame(()=>{this.render(),window.setTimeout(()=>{this.removeAttribute("hidden"),this.shadowReadyCallback()})})},this.shadowRoot.prepend(i)},onTimeout:()=>{console.error("Attribute `css-src` is required and it is not set. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/")}})}}}var je=class extends Gt(v){};var He=class extends Gt(K){shadowReadyCallback(){this.__shadowReady=!0,this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async initEditor(){this.__shadowReady&&await super.initEditor()}};var mt=class extends v{constructor(){super(...arguments);m(this,"init$",{...this.init$,name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",t=>{if(!t)return;let i=this.getCssData(`--icon-${t}`);i&&(this.$.path=i)}),this.sub("path",t=>{if(!t)return;t.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=t):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${t}"></path>`)}),this.sub("size",t=>{this.$.viewBox=`0 0 ${t} ${t}`})}};mt.template=`<svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>`;mt.bindAttributes({name:"name",size:"size"});function zi(r){for(let e in r){let t=[...e].reduce((i,s)=>(s.toUpperCase()===s&&(s="-"+s.toLowerCase()),i+=s),"");t.startsWith("-")&&(t=t.replace("-","")),t.startsWith("lr-")||(t="lr-"+t),r[e].reg&&r[e].reg(t)}}var Xi="https://ucarecdn.com",ji="https://upload.uploadcare.com",Hi="https://social.uploadcare.com",q={pubkey:"",multiple:!0,multipleMin:0,multipleMax:0,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",store:"auto",cameraMirror:!1,sourceList:"local, url, camera, dropbox, gdrive",cloudImageEditorTabs:wt(E),maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:Xi,baseUrl:ji,socialBaseUrl:Hi,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:1,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",metadata:null};var A=r=>String(r),D=r=>{let e=Number(r);if(Number.isNaN(e))throw new Error(`Invalid number: "${r}"`);return e},C=r=>{if(typeof r=="undefined"||r===null)return!1;if(typeof r=="boolean")return r;if(r==="true"||r==="")return!0;if(r==="false")return!1;throw new Error(`Invalid boolean: "${r}"`)},Bi=r=>r==="auto"?r:C(r),Wi={pubkey:A,multiple:C,multipleMin:D,multipleMax:D,confirmUpload:C,imgOnly:C,accept:A,externalSourcesPreferredTypes:A,store:Bi,cameraMirror:C,sourceList:A,maxLocalFileSizeBytes:D,thumbSize:D,showEmptyList:C,useLocalImageEditor:C,useCloudImageEditor:C,cloudImageEditorTabs:A,removeCopyright:C,cropPreset:A,modalScrollLock:C,modalBackdropStrokes:C,sourceListWrap:C,remoteTabSessionKey:A,cdnCname:A,baseUrl:A,socialBaseUrl:A,secureSignature:A,secureExpire:A,secureDeliveryProxy:A,retryThrottledRequestMaxTimes:D,multipartMinFileSize:D,multipartChunkSize:D,maxConcurrentRequests:D,multipartMaxConcurrentRequests:D,multipartMaxAttempts:D,checkForUrlDuplicates:C,saveUrlForRecurrentUploads:C,groupOutput:C,userAgentIntegration:A},Be=(r,e)=>{if(!(typeof e=="undefined"||e===null))try{return Wi[r](e)}catch(t){return console.error(`Invalid value for config key "${r}".`,t),q[r]}};var Lt=Object.keys(q),Vi=["metadata"],Ki=r=>Vi.includes(r),Nt=Lt.filter(r=>!Ki(r)),Gi={...Object.fromEntries(Nt.map(r=>[W(r),r])),...Object.fromEntries(Nt.map(r=>[r.toLowerCase(),r]))},qi={...Object.fromEntries(Lt.map(r=>[W(r),x(r)])),...Object.fromEntries(Lt.map(r=>[r.toLowerCase(),x(r)]))},kt=class extends v{constructor(){super();m(this,"requireCtxName",!0);this.init$={...this.init$,...Object.fromEntries(Object.entries(q).map(([t,i])=>[x(t),i]))}}initCallback(){super.initCallback();let t=this;for(let i of Nt)this.sub(x(i),s=>{s!==q[i]&&(t[i]=s)},!1);for(let i of Lt){let s="__"+i;t[s]=t[i],Object.defineProperty(this,i,{set:o=>{if(t[s]=o,Nt.includes(i)){let n=[...new Set([W(i),i.toLowerCase()])];for(let l of n)typeof o=="undefined"||o===null?this.removeAttribute(l):this.setAttribute(l,o.toString())}this.$[x(i)]!==o&&(typeof o=="undefined"||o===null?this.$[x(i)]=q[i]:this.$[x(i)]=o)},get:()=>this.$[x(i)]}),typeof t[i]!="undefined"&&t[i]!==null&&(t[i]=t[s])}}attributeChangedCallback(t,i,s){if(i===s)return;let o=Gi[t],n=Be(o,s),l=n!=null?n:q[o],a=this;a[o]=l}};kt.bindAttributes(qi);var Yi=kt;export{He as CloudImageEditor,K as CloudImageEditorBlock,Yi as Config,xt as CropFrame,ht as EditorCropButtonControl,ot as EditorFilterControl,At as EditorImageCropper,Kt as EditorImageFader,pt as EditorOperationControl,$t as EditorScroller,Et as EditorSlider,St as EditorToolbar,mt as Icon,Ot as LineLoaderUi,ft as LrBtnUi,Pt as PresenceToggle,Rt as SliderUi,zi as registerBlocks};