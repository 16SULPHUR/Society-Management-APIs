/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2022 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
"use strict";var LR=(()=>{var oe=Object.defineProperty;var ao=Object.getOwnPropertyDescriptor;var co=Object.getOwnPropertyNames;var ho=Object.prototype.hasOwnProperty;var uo=(r,e,t)=>e in r?oe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var l=(r,e)=>oe(r,"name",{value:e,configurable:!0});var po=(r,e)=>{for(var t in e)oe(r,t,{get:e[t],enumerable:!0})},fo=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of co(e))!ho.call(r,s)&&s!==t&&oe(r,s,{get:()=>e[s],enumerable:!(i=ao(e,s))||i.enumerable});return r};var mo=r=>fo(oe({},"__esModule",{value:!0}),r);var u=(r,e,t)=>(uo(r,typeof e!="symbol"?e+"":e,t),t);var Ta={};po(Ta,{ActivityBlock:()=>b,ActivityHeader:()=>Fi,BaseComponent:()=>St,Block:()=>y,CameraSource:()=>Re,CloudImageEditor:()=>zi,CloudImageEditorActivity:()=>Ni,CloudImageEditorBlock:()=>lt,Config:()=>Rn,ConfirmationDialog:()=>Pe,Copyright:()=>Vi,CropFrame:()=>De,Data:()=>E,DataOutput:()=>vr,DropArea:()=>qt,EditorCropButtonControl:()=>Qt,EditorFilterControl:()=>Ut,EditorImageCropper:()=>je,EditorImageFader:()=>Pi,EditorOperationControl:()=>te,EditorScroller:()=>He,EditorSlider:()=>Ve,EditorToolbar:()=>We,ExternalSource:()=>Ke,FileItem:()=>Zt,FilePreview:()=>Jt,FileUploaderInline:()=>ti,FileUploaderMinimal:()=>Qe,FileUploaderRegular:()=>Je,Icon:()=>jt,Img:()=>Oi,LineLoaderUi:()=>Xe,LrBtnUi:()=>ie,MessageBox:()=>Oe,Modal:()=>Ie,PACKAGE_NAME:()=>_s,PACKAGE_VERSION:()=>ys,PresenceToggle:()=>Ge,ProgressBar:()=>Ne,ProgressBarCommon:()=>Me,Select:()=>Ye,ShadowWrapper:()=>ne,SimpleBtn:()=>Xt,SliderUi:()=>qe,SourceBtn:()=>Kt,SourceList:()=>ki,StartFrom:()=>$e,Tabs:()=>se,UploadCtxProvider:()=>Hn,UploadDetails:()=>Ue,UploadList:()=>ke,UploaderBlock:()=>T,UrlSource:()=>Le,Video:()=>re,connectBlocksFrom:()=>oo,registerBlocks:()=>ji,shadowed:()=>Ze,toKebabCase:()=>it});var go=Object.defineProperty,bo=l((r,e,t)=>e in r?go(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,"__defNormalProp"),Xi=l((r,e,t)=>(bo(r,typeof e!="symbol"?e+"":e,t),t),"__publicField");function _o(r){let e=l(t=>{var i;for(let s in t)((i=t[s])==null?void 0:i.constructor)===Object&&(t[s]=e(t[s]));return{...t}},"clone");return e(r)}l(_o,"cloneObj");var ae,E=(ae=class{constructor(e){e.constructor===Object?this.store=_o(e):(this._storeIsProxy=!0,this.store=e),this.callbackMap=Object.create(null)}static warn(e,t){console.warn(`Symbiote Data: cannot ${e}. Prop name: `+t)}read(e){return!this._storeIsProxy&&!this.store.hasOwnProperty(e)?(E.warn("read",e),null):this.store[e]}has(e){return this._storeIsProxy?this.store[e]!==void 0:this.store.hasOwnProperty(e)}add(e,t,i=!1){!i&&Object.keys(this.store).includes(e)||(this.store[e]=t,this.notify(e))}pub(e,t){if(!this._storeIsProxy&&!this.store.hasOwnProperty(e)){E.warn("publish",e);return}this.store[e]=t,this.notify(e)}multiPub(e){for(let t in e)this.pub(t,e[t])}notify(e){this.callbackMap[e]&&this.callbackMap[e].forEach(t=>{t(this.store[e])})}sub(e,t,i=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(e)?(E.warn("subscribe",e),null):(this.callbackMap[e]||(this.callbackMap[e]=new Set),this.callbackMap[e].add(t),i&&t(this.store[e]),{remove:()=>{this.callbackMap[e].delete(t),this.callbackMap[e].size||delete this.callbackMap[e]},callback:t})}static registerCtx(e,t=Symbol()){let i=E.globalStore.get(t);return i?console.warn('State: context UID "'+t+'" already in use'):(i=new E(e),E.globalStore.set(t,i)),i}static deleteCtx(e){E.globalStore.delete(e)}static getCtx(e,t=!0){return E.globalStore.get(e)||(t&&console.warn('State: wrong context UID - "'+e+'"'),null)}},l(ae,"Data"),ae);E.globalStore=new Map;var C=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),Rr="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",yo=Rr.length-1,ce,fe=(ce=class{static generate(e="XXXXXXXXX-XXX"){let t="";for(let i=0;i<e.length;i++)t+=e[i]==="-"?e[i]:Rr.charAt(Math.random()*yo);return t}},l(ce,"UID"),ce);function Ur(r,e,t){let i=!0,s,n=e.split(".");return n.forEach((o,a)=>{a<n.length-1?r=r[o]:s=o}),r?r[s]=t:i=!1,i}l(Ur,"setNestedProp");function vo(r){return r.split("-").map((e,t)=>e&&t?e[0].toUpperCase()+e.slice(1):e).join("").split("_").map((e,t)=>e&&t?e.toUpperCase():e).join("")}l(vo,"kebabToCamel");function Co(r,e){[...r.querySelectorAll(`[${C.REPEAT_ATTR}]`)].forEach(t=>{var o;let i=t.getAttribute(C.REPEAT_ITEM_TAG_ATTR),s;if(i&&(s=window.customElements.get(i)),!s){s=(o=class extends e.BaseComponent{constructor(){super(),i||(this.style.display="contents")}},l(o,"itemClass"),o);let a=t.innerHTML;s.template=a,s.reg(i)}for(;t.firstChild;)t.firstChild.remove();let n=t.getAttribute(C.REPEAT_ATTR);e.sub(n,a=>{if(!a){for(;t.firstChild;)t.firstChild.remove();return}let c=[...t.children],h,d=l(p=>{p.forEach((g,m)=>{if(c[m])if(c[m].set$)setTimeout(()=>{c[m].set$(g)});else for(let _ in g)c[m][_]=g[_];else{h||(h=new DocumentFragment);let _=new s;Object.assign(_.init$,g),h.appendChild(_)}}),h&&t.appendChild(h);let f=c.slice(p.length,c.length);for(let g of f)g.remove()},"fillItems");if(a.constructor===Array)d(a);else if(a.constructor===Object){let p=[];for(let f in a){let g=a[f];Object.defineProperty(g,"_KEY_",{value:f,enumerable:!0}),p.push(g)}d(p)}else console.warn("Symbiote repeat data type error:"),console.log(a)}),t.removeAttribute(C.REPEAT_ATTR),t.removeAttribute(C.REPEAT_ITEM_TAG_ATTR)})}l(Co,"repeatProcessor");var kr="__default__";function wo(r,e){if(e.shadowRoot)return;let t=[...r.querySelectorAll("slot")];if(!t.length)return;let i={};t.forEach(s=>{let n=s.getAttribute("name")||kr;i[n]={slot:s,fr:document.createDocumentFragment()}}),e.initChildren.forEach(s=>{var n;let o=kr;s instanceof Element&&s.hasAttribute("slot")&&(o=s.getAttribute("slot"),s.removeAttribute("slot")),(n=i[o])==null||n.fr.appendChild(s)}),Object.values(i).forEach(s=>{if(s.fr.childNodes.length)s.slot.parentNode.replaceChild(s.fr,s.slot);else if(s.slot.childNodes.length){let n=document.createDocumentFragment();n.append(...s.slot.childNodes),s.slot.parentNode.replaceChild(n,s.slot)}else s.slot.remove()})}l(wo,"slotProcessor");function To(r,e){[...r.querySelectorAll(`[${C.EL_REF_ATTR}]`)].forEach(t=>{let i=t.getAttribute(C.EL_REF_ATTR);e.ref[i]=t,t.removeAttribute(C.EL_REF_ATTR)})}l(To,"refProcessor");function xo(r,e){[...r.querySelectorAll(`[${C.BIND_ATTR}]`)].forEach(t=>{let s=t.getAttribute(C.BIND_ATTR).split(";");[...t.attributes].forEach(n=>{if(n.name.startsWith("-")&&n.value){let o=vo(n.name.replace("-",""));s.push(o+":"+n.value),t.removeAttribute(n.name)}}),s.forEach(n=>{if(!n)return;let o=n.split(":").map(d=>d.trim()),a=o[0],c;a.indexOf(C.ATTR_BIND_PRFX)===0&&(c=!0,a=a.replace(C.ATTR_BIND_PRFX,""));let h=o[1].split(",").map(d=>d.trim());for(let d of h){let p;d.startsWith("!!")?(p="double",d=d.replace("!!","")):d.startsWith("!")&&(p="single",d=d.replace("!","")),e.sub(d,f=>{p==="double"?f=!!f:p==="single"&&(f=!f),c?(f==null?void 0:f.constructor)===Boolean?f?t.setAttribute(a,""):t.removeAttribute(a):t.setAttribute(a,f):Ur(t,a,f)||(t[C.SET_LATER_KEY]||(t[C.SET_LATER_KEY]=Object.create(null)),t[C.SET_LATER_KEY][a]=f)})}}),t.removeAttribute(C.BIND_ATTR)})}l(xo,"domSetProcessor");var ei="{{",le="}}",Eo="skip-text";function Ao(r){let e,t=[],i=document.createTreeWalker(r,NodeFilter.SHOW_TEXT,{acceptNode:s=>{var n;return!((n=s.parentElement)!=null&&n.hasAttribute(Eo))&&s.textContent.includes(ei)&&s.textContent.includes(le)&&1}});for(;e=i.nextNode();)t.push(e);return t}l(Ao,"getTextNodesWithTokens");var $o=l(function(r,e){Ao(r).forEach(i=>{let s=[],n;for(;i.textContent.includes(le);)i.textContent.startsWith(ei)?(n=i.textContent.indexOf(le)+le.length,i.splitText(n),s.push(i)):(n=i.textContent.indexOf(ei),i.splitText(n)),i=i.nextSibling;s.forEach(o=>{let a=o.textContent.replace(ei,"").replace(le,"");o.textContent="",e.sub(a,c=>{o.textContent=c})})})},"txtNodesProcessor"),So=[Co,wo,To,xo,$o],ii="'",Mt='"',Io=/\\([0-9a-fA-F]{1,6} ?)/g;function Oo(r){return(r[0]===Mt||r[0]===ii)&&(r[r.length-1]===Mt||r[r.length-1]===ii)}l(Oo,"hasLeadingTrailingQuotes");function ko(r){return(r[0]===Mt||r[0]===ii)&&(r=r.slice(1)),(r[r.length-1]===Mt||r[r.length-1]===ii)&&(r=r.slice(0,-1)),r}l(ko,"trimQuotes");function Lo(r){let e="",t="";for(var i=0;i<r.length;i++){let s=r[i+1];r[i]==="\\"&&s==='"'?(e+='\\"',i++):r[i]==='"'&&t!=="\\"?e+='\\"':e+=r[i],t=r[i]}return e}l(Lo,"escapeQuotes");function Ro(r){let e=r;Oo(r)&&(e=ko(e),e=e.replace(Io,(t,i)=>String.fromCodePoint(parseInt(i.trim(),16))),e=e.replaceAll(`\\
`,"\\n"),e=Lo(e),e=Mt+e+Mt);try{return JSON.parse(e)}catch{throw new Error(`Failed to parse CSS property value: ${e}. Original input: ${r}`)}}l(Ro,"parseCssPropertyValue");var Lr=0,Pt=null,ut=null,he,bt=(he=class extends HTMLElement{constructor(){super(),Xi(this,"updateCssData",()=>{var e;this.dropCssDataCache(),(e=this.__boundCssProps)==null||e.forEach(t=>{let i=this.getCssData(this.__extractCssName(t),!0);i!==null&&this.$[t]!==i&&(this.$[t]=i)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return bt}initCallback(){}__initCallback(){var e;this.__initialized||(this.__initialized=!0,(e=this.initCallback)==null||e.call(this))}render(e,t=this.renderShadow){let i;if((t||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let n=this.getAttribute(C.USE_TPL);if(n){let o=this.getRootNode(),a=(o==null?void 0:o.querySelector(n))||document.querySelector(n);a?e=a.content.cloneNode(!0):console.warn(`Symbiote template "${n}" is not found...`)}}if(this.processInnerHtml)for(let n of this.tplProcessors)n(this,this);if(e||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(e==null?void 0:e.constructor)===DocumentFragment)i=e;else if((e==null?void 0:e.constructor)===String){let n=document.createElement("template");n.innerHTML=e,i=n.content.cloneNode(!0)}else this.constructor.__tpl&&(i=this.constructor.__tpl.content.cloneNode(!0));for(let n of this.tplProcessors)n(i,this)}let s=l(()=>{i&&(t&&this.shadowRoot.appendChild(i)||this.appendChild(i)),this.__initCallback()},"addFr");if(this.constructor.__shadowStylesUrl){t=!0;let n=document.createElement("link");n.rel="stylesheet",n.href=this.constructor.__shadowStylesUrl,n.onload=s,this.shadowRoot.prepend(n)}else s()}addTemplateProcessor(e){this.tplProcessors.add(e)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=fe.generate(),this.style.setProperty(C.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(C.CSS_CTX_PROP,!0)}get ctxName(){var e;let t=((e=this.getAttribute(C.CTX_NAME_ATTR))==null?void 0:e.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=t,t}get localCtx(){return this.__localCtx||(this.__localCtx=E.registerCtx({},this)),this.__localCtx}get nodeCtx(){return E.getCtx(this.ctxName,!1)||E.registerCtx({},this.ctxName)}static __parseProp(e,t){let i,s;if(e.startsWith(C.EXT_DATA_CTX_PRFX))i=t.nodeCtx,s=e.replace(C.EXT_DATA_CTX_PRFX,"");else if(e.includes(C.NAMED_DATA_CTX_SPLTR)){let n=e.split(C.NAMED_DATA_CTX_SPLTR);i=E.getCtx(n[0]),s=n[1]}else i=t.localCtx,s=e;return{ctx:i,name:s}}sub(e,t,i=!0){let s=l(o=>{this.isConnected&&t(o)},"subCb"),n=bt.__parseProp(e,this);n.ctx.has(n.name)?this.allSubs.add(n.ctx.sub(n.name,s,i)):window.setTimeout(()=>{this.allSubs.add(n.ctx.sub(n.name,s,i))})}notify(e){let t=bt.__parseProp(e,this);t.ctx.notify(t.name)}has(e){let t=bt.__parseProp(e,this);return t.ctx.has(t.name)}add(e,t,i=!1){let s=bt.__parseProp(e,this);s.ctx.add(s.name,t,i)}add$(e,t=!1){for(let i in e)this.add(i,e[i],t)}get $(){if(!this.__stateProxy){let e=Object.create(null);this.__stateProxy=new Proxy(e,{set:(t,i,s)=>{let n=bt.__parseProp(i,this);return n.ctx.pub(n.name,s),!0},get:(t,i)=>{let s=bt.__parseProp(i,this);return s.ctx.read(s.name)}})}return this.__stateProxy}set$(e,t=!1){for(let i in e){let s=e[i];t||![String,Number,Boolean].includes(s==null?void 0:s.constructor)?this.$[i]=s:this.$[i]!==s&&(this.$[i]=s)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(C.CTX_OWNER_ATTR)&&this.getAttribute(C.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let e=this.constructor.__attrDesc;if(e)for(let t of Object.values(e))Object.keys(this.init$).includes(t)||(this.init$[t]="");for(let t in this.init$)if(t.startsWith(C.EXT_DATA_CTX_PRFX))this.nodeCtx.add(t.replace(C.EXT_DATA_CTX_PRFX,""),this.init$[t],this.__ctxOwner);else if(t.includes(C.NAMED_DATA_CTX_SPLTR)){let i=t.split(C.NAMED_DATA_CTX_SPLTR),s=i[0].trim(),n=i[1].trim();if(s&&n){let o=E.getCtx(s,!1);o||(o=E.registerCtx({},s)),o.add(n,this.init$[t])}}else this.localCtx.add(t,this.init$[t]);for(let t in this.cssInit$)this.bindCssData(t,this.cssInit$[t]);this.__dataCtxInitialized=!0}connectedCallback(){var e;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let t=(e=this.getAttribute(C.CTX_NAME_ATTR))==null?void 0:e.trim();if(t&&this.style.setProperty(C.CSS_CTX_PROP,`'${t}'`),this.__initDataCtx(),this[C.SET_LATER_KEY]){for(let i in this[C.SET_LATER_KEY])Ur(this,i,this[C.SET_LATER_KEY][i]);delete this[C.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let i of So)this.addTemplateProcessor(i);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let i=this.getRootNode();if(!i)return;if(i==null?void 0:i.querySelector(`link[${C.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let n=this.constructor.__rootStylesLink.cloneNode(!0);n.setAttribute(C.ROOT_STYLE_ATTR_NAME,this.constructor.is),n.onload=()=>{this.render()},i.nodeType===Node.DOCUMENT_NODE?i.head.appendChild(n):i.prepend(n)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let e of this.allSubs)e.remove(),this.allSubs.delete(e);for(let e of this.tplProcessors)this.tplProcessors.delete(e);ut==null||ut.delete(this.updateCssData),ut!=null&&ut.size||(Pt==null||Pt.disconnect(),Pt=null,ut=null)},100)))}static reg(e,t=!1){e||(Lr++,e=`${C.AUTO_TAG_PRFX}-${Lr}`),this.__tag=e;let i=window.customElements.get(e);if(i){!t&&i!==this&&console.warn([`Element with tag name "${e}" already registered.`,`You're trying to override it with another class "${this.name}".`,"This is most likely a mistake.","New element will not be registered."].join(` `));return}window.customElements.define(e,t?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(e){this.observedAttributes=Object.keys(e),this.__attrDesc=e}attributeChangedCallback(e,t,i){var s;if(t===i)return;let n=(s=this.constructor.__attrDesc)==null?void 0:s[e];n?this.__dataCtxInitialized?this.$[n]=i:this.init$[n]=i:this[e]=i}getCssData(e,t=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(e)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let i=this.__computedStyle.getPropertyValue(e).trim();try{this.__cssDataCache[e]=Ro(i)}catch{!t&&console.warn(`CSS Data error: ${e}`),this.__cssDataCache[e]=null}}return this.__cssDataCache[e]}__extractCssName(e){return e.split("--").map((t,i)=>i===0?"":t).join("--")}__initStyleAttrObserver(){ut||(ut=new Set),ut.add(this.updateCssData),Pt||(Pt=new MutationObserver(e=>{e[0].type==="attributes"&&ut.forEach(t=>{t()})}),Pt.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(e,t=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(e);let i=this.getCssData(this.__extractCssName(e),!0);i===null&&(i=t),this.add(e,i),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(e,t,i){let s="__"+e;this[s]=this[e],Object.defineProperty(this,e,{set:n=>{this[s]=n,i?window.setTimeout(()=>{t==null||t(n)}):t==null||t(n)},get:()=>this[s]}),this[e]=this[s]}static set shadowStyles(e){let t=new Blob([e],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(t)}static set rootStyles(e){if(!this.__rootStylesLink){let t=new Blob([e],{type:"text/css"}),i=URL.createObjectURL(t),s=document.createElement("link");s.href=i,s.rel="stylesheet",this.__rootStylesLink=s}}},l(he,"_BaseComponent"),he),St=bt;Xi(St,"template");var ue,Wi=(ue=class{static _print(e){console.warn(e)}static setDefaultTitle(e){this.defaultTitle=e}static setRoutingMap(e){Object.assign(this.appMap,e);for(let t in this.appMap)!this.defaultRoute&&this.appMap[t].default===!0?this.defaultRoute=t:!this.errorRoute&&this.appMap[t].error===!0&&(this.errorRoute=t)}static set routingEventName(e){this.__routingEventName=e}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let e={route:null,options:{}};return window.location.search.split(this.separator).forEach(i=>{if(i.includes("?"))e.route=i.replace("?","");else if(i.includes("=")){let s=i.split("=");e.options[s[0]]=decodeURI(s[1])}else e.options[i]=!0}),e}static notify(){let e=this.readAddressBar(),t=this.appMap[e.route];if(t&&t.title&&(document.title=t.title),e.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!t&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!t&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!t){this._print(`Route "${e.route}" not found...`);return}let i=new CustomEvent(Wi.routingEventName,{detail:{route:e.route,options:Object.assign(t||{},e.options)}});window.dispatchEvent(i)}static reflect(e,t={}){let i=this.appMap[e];if(!i){this._print("Wrong route: "+e);return}let s="?"+e;for(let o in t)t[o]===!0?s+=this.separator+o:s+=this.separator+o+`=${t[o]}`;let n=i.title||this.defaultTitle||"";window.history.pushState(null,n,s),document.title=n}static applyRoute(e,t={}){this.reflect(e,t),this.notify()}static setSeparator(e){this._separator=e}static get separator(){return this._separator||"&"}static createRouterData(e,t){this.setRoutingMap(t);let i=E.registerCtx({route:null,options:null,title:null},e);return window.addEventListener(this.routingEventName,s=>{var n;i.multiPub({route:s.detail.route,options:s.detail.options,title:((n=s.detail.options)==null?void 0:n.title)||this.defaultTitle||""})}),Wi.notify(),this.initPopstateListener(),i}static initPopstateListener(){this.__onPopstate||(this.__onPopstate=()=>{this.notify()},window.addEventListener("popstate",this.__onPopstate))}static removePopstateListener(){window.removeEventListener("popstate",this.__onPopstate),this.__onPopstate=null}},l(ue,"AppRouter"),ue);Wi.appMap=Object.create(null);function Gi(r,e){for(let t in e)t.includes("-")?r.style.setProperty(t,e[t]):r.style[t]=e[t]}l(Gi,"applyStyles");function Uo(r,e){for(let t in e)e[t].constructor===Boolean?e[t]?r.setAttribute(t,""):r.removeAttribute(t):r.setAttribute(t,e[t])}l(Uo,"applyAttributes");function me(r={tag:"div"}){let e=document.createElement(r.tag);if(r.attributes&&Uo(e,r.attributes),r.styles&&Gi(e,r.styles),r.properties)for(let t in r.properties)e[t]=r.properties[t];return r.processors&&r.processors.forEach(t=>{t(e)}),r.children&&r.children.forEach(t=>{let i=me(t);e.appendChild(i)}),e}l(me,"create");var Pr="idb-store-ready",Po="symbiote-db",Mo="symbiote-idb-update_",de,No=(de=class{_notifyWhenReady(e=null){window.dispatchEvent(new CustomEvent(Pr,{detail:{dbName:this.name,storeName:this.storeName,event:e}}))}get _updEventName(){return Mo+this.name}_getUpdateEvent(e){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:e}})}_notifySubscribers(e){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,e),window.dispatchEvent(this._getUpdateEvent(e))}constructor(e,t){this.name=e,this.storeName=t,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=i=>{this.db=i.target.result,this.objStore=this.db.createObjectStore(t,{keyPath:"_key"}),this.objStore.transaction.oncomplete=s=>{this._notifyWhenReady(s)}},this.request.onsuccess=i=>{this.db=i.target.result,this._notifyWhenReady(i)},this.request.onerror=i=>{console.error(i)},this._subscriptionsMap={},this._updateHandler=i=>{i.key===this.name&&this._subscriptionsMap[i.newValue]&&this._subscriptionsMap[i.newValue].forEach(async n=>{n(await this.read(i.newValue))})},this._localUpdateHandler=i=>{this._updateHandler(i.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(e){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(e);return new Promise((s,n)=>{i.onsuccess=o=>{var a;(a=o.target.result)!=null&&a._value?s(o.target.result._value):(s(null),console.warn(`IDB: cannot read "${e}"`))},i.onerror=o=>{n(o)}})}write(e,t,i=!1){let s={_key:e,_value:t},o=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(s);return new Promise((a,c)=>{o.onsuccess=h=>{i||this._notifySubscribers(e),a(h.target.result)},o.onerror=h=>{c(h)}})}delete(e,t=!1){let s=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);return new Promise((n,o)=>{s.onsuccess=a=>{t||this._notifySubscribers(e),n(a)},s.onerror=a=>{o(a)}})}getAll(){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((i,s)=>{t.onsuccess=n=>{let o=n.target.result;i(o.map(a=>a._value))},t.onerror=n=>{s(n)}})}subscribe(e,t){this._subscriptionsMap[e]||(this._subscriptionsMap[e]=new Set);let i=this._subscriptionsMap[e];return i.add(t),{remove:()=>{i.delete(t),i.size||delete this._subscriptionsMap[e]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,Mr.clear(this.name)}},l(de,"DbInstance"),de),pe,Mr=(pe=class{static get readyEventName(){return Pr}static open(e=Po,t="store"){let i=e+"/"+t;return this._reg[i]||(this._reg[i]=new No(e,t)),this._reg[i]}static clear(e){window.indexedDB.deleteDatabase(e);for(let t in this._reg)t.split("/")[0]===e&&delete this._reg[t]}},l(pe,"IDB"),pe);Xi(Mr,"_reg",Object.create(null));var I=Object.freeze({UPLOAD_START:"upload-start",REMOVE:"remove",UPLOAD_PROGRESS:"upload-progress",UPLOAD_FINISH:"upload-finish",UPLOAD_ERROR:"upload-error",VALIDATION_ERROR:"validation-error",CLOUD_MODIFICATION:"cloud-modification",DATA_OUTPUT:"data-output",DONE_FLOW:"done-flow",INIT_FLOW:"init-flow"}),Do=Object.freeze({[I.UPLOAD_START]:"LR_UPLOAD_START",[I.REMOVE]:"LR_REMOVE",[I.UPLOAD_PROGRESS]:"LR_UPLOAD_PROGRESS",[I.UPLOAD_FINISH]:"LR_UPLOAD_FINISH",[I.UPLOAD_ERROR]:"LR_UPLOAD_ERROR",[I.VALIDATION_ERROR]:"LR_VALIDATION_ERROR",[I.CLOUD_MODIFICATION]:"LR_CLOUD_MODIFICATION",[I.DATA_OUTPUT]:"LR_DATA_OUTPUT",[I.DONE_FLOW]:"LR_DONE_FLOW",[I.INIT_FLOW]:"LR_INIT_FLOW"}),qi=class qi{constructor(e){u(this,"_timeoutStore",new Map);u(this,"_targets",new Set);this._getCtxName=e}bindTarget(e){this._targets.add(e)}unbindTarget(e){this._targets.delete(e)}_dispatch(e,t){for(let s of this._targets)s.dispatchEvent(new CustomEvent(e,{detail:t}));let i=Do[e];window.dispatchEvent(new CustomEvent(i,{detail:{ctx:this._getCtxName(),type:i,data:t}}))}emit(e,t,{debounce:i}={}){if(typeof i!="number"&&!i){this._dispatch(e,t);return}this._timeoutStore.has(e)&&window.clearTimeout(this._timeoutStore.get(e));let s=typeof i=="number"?i:20,n=window.setTimeout(()=>{this._dispatch(e,t),this._timeoutStore.delete(e)},s);this._timeoutStore.set(e,n)}};l(qi,"EventEmitter");var si=qi;function O(r,e){let t,i=l((...s)=>{clearTimeout(t),t=setTimeout(()=>r(...s),e)},"debounced");return i.cancel=()=>{clearTimeout(t)},i}l(O,"debounce");var Nr="--uploadcare-blocks-window-height",ge=class ge{static registerClient(e){this.clientsRegistry.size===0&&this.attachTracker(),this.clientsRegistry.add(e)}static unregisterClient(e){this.clientsRegistry.delete(e),this.clientsRegistry.size===0&&this.detachTracker()}static attachTracker(){window.addEventListener("resize",this.flush,{passive:!0,capture:!0}),this.flush()}static detachTracker(){window.removeEventListener("resize",this.flush,{capture:!0}),document.documentElement.style.removeProperty(Nr)}};l(ge,"WindowHeightTracker"),u(ge,"clientsRegistry",new Set),u(ge,"flush",O(()=>{document.documentElement.style.setProperty(Nr,`${window.innerHeight}px`)},100));var be=ge;var ri=l((r,e)=>new Intl.PluralRules(r).select(e),"getPluralForm");var Fo=l(r=>r,"DEFAULT_TRANSFORMER"),Ki="{{",Fr="}}",Dr="plural:";function _e(r,e,t={}){var o;let{openToken:i=Ki,closeToken:s=Fr,transform:n=Fo}=t;for(let a in e){let c=(o=e[a])==null?void 0:o.toString();r=r.replaceAll(i+a+s,typeof c=="string"?n(c):c)}return r}l(_e,"applyTemplateData");function Vr(r){let e=[],t=r.indexOf(Ki);for(;t!==-1;){let i=r.indexOf(Fr,t),s=r.substring(t+2,i);if(s.startsWith(Dr)){let n=r.substring(t+2,i).replace(Dr,""),o=n.substring(0,n.indexOf("(")),a=n.substring(n.indexOf("(")+1,n.indexOf(")"));e.push({variable:s,pluralKey:o,countVariable:a})}t=r.indexOf(Ki,i)}return e}l(Vr,"getPluralObjects");var it=l(r=>{var e;return(e=r.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g))==null?void 0:e.map(t=>t.toLowerCase()).join("-")},"toKebabCase");var ni=l(({element:r,attribute:e,onSuccess:t,onTimeout:i,timeout:s=300})=>{let n=r.getAttribute(e);if(n!==null){t(n);return}let o=new MutationObserver(h=>{let d=h[h.length-1];c(d)});o.observe(r,{attributes:!0,attributeFilter:[e]});let a=setTimeout(()=>{o.disconnect(),i()},s),c=l(h=>{let d=r.getAttribute(e);h.type==="attributes"&&h.attributeName===e&&d!==null&&(clearTimeout(a),o.disconnect(),t(d))},"handleMutation")},"waitForAttribute");var Br=new Set;function ye(r){Br.has(r)||(Br.add(r),console.warn(r))}l(ye,"warnOnce");function zr(r){return Object.prototype.toString.call(r)==="[object Object]"}l(zr,"isObject");var Vo=/\W|_/g;function Bo(r){return r.split(Vo).map((e,t)=>e.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+e.slice(1)).join("")}l(Bo,"camelizeString");function jr(r,{ignoreKeys:e}={ignoreKeys:[]}){return Array.isArray(r)?r.map(t=>ft(t,{ignoreKeys:e})):r}l(jr,"camelizeArrayItems");function ft(r,{ignoreKeys:e}={ignoreKeys:[]}){if(Array.isArray(r))return jr(r,{ignoreKeys:e});if(!zr(r))return r;let t={};for(let i of Object.keys(r)){let s=r[i];if(e.includes(i)){t[i]=s;continue}zr(s)?s=ft(s,{ignoreKeys:e}):Array.isArray(s)&&(s=jr(s,{ignoreKeys:e})),t[Bo(i)]=s}return t}l(ft,"camelizeKeys");var zo=l(r=>new Promise(e=>setTimeout(e,r)),"delay");function is({libraryName:r,libraryVersion:e,userAgent:t,publicKey:i="",integration:s=""}){let n="JavaScript";if(typeof t=="string")return t;if(typeof t=="function")return t({publicKey:i,libraryName:r,libraryVersion:e,languageName:n,integration:s});let o=[r,e,i].filter(Boolean).join("/"),a=[n,s].filter(Boolean).join("; ");return`${o} (${a})`}l(is,"getUserAgent$1");var jo={factor:2,time:100};function Ho(r,e=jo){let t=0;function i(s){let n=Math.round(e.time*e.factor**t);return s({attempt:t,retry:l(a=>zo(a!=null?a:n).then(()=>(t+=1,i(s))),"retry")})}return l(i,"runAttempt"),i(r)}l(Ho,"retrier");var ai=class ai extends Error{constructor(t){super();u(this,"originalProgressEvent");this.name="UploadcareNetworkError",this.message="Network error",Object.setPrototypeOf(this,ai.prototype),this.originalProgressEvent=t}};l(ai,"UploadcareNetworkError");var oi=ai,ui=l((r,e)=>{r&&(r.aborted?Promise.resolve().then(e):r.addEventListener("abort",()=>e(),{once:!0}))},"onCancel"),ci=class ci extends Error{constructor(t="Request canceled"){super(t);u(this,"isCancel",!0);Object.setPrototypeOf(this,ci.prototype)}};l(ci,"CancelError");var Nt=ci,Wo=500,Wr=l(({check:r,interval:e=Wo,timeout:t,signal:i})=>new Promise((s,n)=>{let o,a;ui(i,()=>{o&&clearTimeout(o),n(new Nt("Poll cancelled"))}),t&&(a=setTimeout(()=>{o&&clearTimeout(o),n(new Nt("Timed out"))},t));let c=l(()=>{try{Promise.resolve(r(i)).then(h=>{h?(a&&clearTimeout(a),s(h)):o=setTimeout(c,e)}).catch(h=>{a&&clearTimeout(a),n(h)})}catch(h){a&&clearTimeout(a),n(h)}},"tick");o=setTimeout(c,0)}),"poll"),$={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},di="application/octet-stream",Xr="original",_t=l(({method:r,url:e,data:t,headers:i={},signal:s,onProgress:n})=>new Promise((o,a)=>{let c=new XMLHttpRequest,h=(r==null?void 0:r.toUpperCase())||"GET",d=!1;c.open(h,e,!0),i&&Object.entries(i).forEach(p=>{let[f,g]=p;typeof g!="undefined"&&!Array.isArray(g)&&c.setRequestHeader(f,g)}),c.responseType="text",ui(s,()=>{d=!0,c.abort(),a(new Nt)}),c.onload=()=>{if(c.status!=200)a(new Error(`Error ${c.status}: ${c.statusText}`));else{let p={method:h,url:e,data:t,headers:i||void 0,signal:s,onProgress:n},f=c.getAllResponseHeaders().trim().split(/[\r\n]+/),g={};f.forEach(function(S){let A=S.split(": "),x=A.shift(),w=A.join(": ");x&&typeof x!="undefined"&&(g[x]=w)});let m=c.response,_=c.status;o({request:p,data:m,headers:g,status:_})}},c.onerror=p=>{d||a(new oi(p))},n&&typeof n=="function"&&(c.upload.onprogress=p=>{p.lengthComputable?n({isComputable:!0,value:p.loaded/p.total}):n({isComputable:!1})}),t?c.send(t):c.send()}),"request");function Xo(r,...e){return r}l(Xo,"identity");var Go=l(({name:r})=>r?[r]:[],"getFileOptions"),qo=Xo,Ko=l(()=>new FormData,"getFormData"),Gr=l(r=>!1,"isBuffer"),pi=l(r=>typeof Blob!="undefined"&&r instanceof Blob,"isBlob"),fi=l(r=>typeof File!="undefined"&&r instanceof File,"isFile"),mi=l(r=>!!r&&typeof r=="object"&&!Array.isArray(r)&&"uri"in r&&typeof r.uri=="string","isReactNativeAsset"),Dt=l(r=>pi(r)||fi(r)||Gr()||mi(r),"isFileData"),Yo=l(r=>typeof r=="string"||typeof r=="number"||typeof r=="undefined","isSimpleValue"),Zo=l(r=>!!r&&typeof r=="object"&&!Array.isArray(r),"isObjectValue"),Jo=l(r=>!!r&&typeof r=="object"&&"data"in r&&Dt(r.data),"isFileValue");function Qo(r,e,t){if(Jo(t)){let{name:i,contentType:s}=t,n=qo(t.data,i,s!=null?s:di),o=Go({name:i,contentType:s});r.push([e,n,...o])}else if(Zo(t))for(let[i,s]of Object.entries(t))typeof s!="undefined"&&r.push([`${e}[${i}]`,String(s)]);else Yo(t)&&t&&r.push([e,t.toString()])}l(Qo,"collectParams");function tl(r){let e=[];for(let[t,i]of Object.entries(r))Qo(e,t,i);return e}l(tl,"getFormDataParams");function ss(r){let e=Ko(),t=tl(r);for(let i of t){let[s,n,...o]=i;e.append(s,n,...o)}return e}l(ss,"buildFormData");var hi=class hi extends Error{constructor(t,i,s,n,o){super();u(this,"isCancel");u(this,"code");u(this,"request");u(this,"response");u(this,"headers");this.name="UploadClientError",this.message=t,this.code=i,this.request=s,this.response=n,this.headers=o,Object.setPrototypeOf(this,hi.prototype)}};l(hi,"UploadClientError");var F=hi,el=l(r=>{let e=new URLSearchParams;for(let[t,i]of Object.entries(r))i&&typeof i=="object"&&!Array.isArray(i)?Object.entries(i).filter(s=>{var n;return(n=s[1])!=null?n:!1}).forEach(s=>e.set(`${t}[${s[0]}]`,String(s[1]))):Array.isArray(i)?i.forEach(s=>{e.append(`${t}[]`,s)}):typeof i=="string"&&i?e.set(t,i):typeof i=="number"&&e.set(t,i.toString());return e.toString()},"buildSearchParams"),dt=l((r,e,t)=>{let i=new URL(r);return i.pathname=(i.pathname+e).replace("//","/"),t&&(i.search=el(t)),i.toString()},"getUrl"),il="6.8.0",sl="UploadcareUploadClient",rl=il;function It(r){return is({libraryName:sl,libraryVersion:rl,...r})}l(It,"getUserAgent");var nl="RequestThrottledError",Hr=15e3,ol=1e3;function ll(r){let{headers:e}=r||{};if(!e||typeof e["retry-after"]!="string")return Hr;let t=parseInt(e["retry-after"],10);return Number.isFinite(t)?t*1e3:Hr}l(ll,"getTimeoutFromThrottledRequest");function yt(r,e){let{retryThrottledRequestMaxTimes:t,retryNetworkErrorMaxTimes:i}=e;return Ho(({attempt:s,retry:n})=>r().catch(o=>{if("response"in o&&(o==null?void 0:o.code)===nl&&s<t)return n(ll(o));if(o instanceof oi&&s<i)return n((s+1)*ol);throw o}))}l(yt,"retryIfFailed");var qr=l(r=>{let e="";return(pi(r)||fi(r)||mi(r))&&(e=r.type),e||di},"getContentType"),Kr=l(r=>{let e="";return fi(r)&&r.name?e=r.name:pi(r)||Gr()?e="":mi(r)&&r.name&&(e=r.name),e||Xr},"getFileName");function rs(r){return typeof r=="undefined"||r==="auto"?"auto":r?"1":"0"}l(rs,"getStoreValue");function al(r,{publicKey:e,fileName:t,contentType:i,baseURL:s=$.baseURL,secureSignature:n,secureExpire:o,store:a,signal:c,onProgress:h,source:d="local",integration:p,userAgent:f,retryThrottledRequestMaxTimes:g=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=$.retryNetworkErrorMaxTimes,metadata:_}){return yt(()=>_t({method:"POST",url:dt(s,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":It({publicKey:e,integration:p,userAgent:f})},data:ss({file:{data:r,name:t||Kr(r),contentType:i||qr(r)},UPLOADCARE_PUB_KEY:e,UPLOADCARE_STORE:rs(a),signature:n,expire:o,source:d,metadata:_}),signal:c,onProgress:h}).then(({data:S,headers:A,request:x})=>{let w=ft(JSON.parse(S));if("error"in w)throw new F(w.error.content,w.error.errorCode,x,w,A);return w}),{retryNetworkErrorMaxTimes:m,retryThrottledRequestMaxTimes:g})}l(al,"base");var Ji;(function(r){r.Token="token",r.FileInfo="file_info"})(Ji||(Ji={}));function cl(r,{publicKey:e,baseURL:t=$.baseURL,store:i,fileName:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:c,source:h="url",signal:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=$.retryNetworkErrorMaxTimes,metadata:_}){return yt(()=>_t({method:"POST",headers:{"X-UC-User-Agent":It({publicKey:e,integration:p,userAgent:f})},url:dt(t,"/from_url/",{jsonerrors:1,pub_key:e,source_url:r,store:rs(i),filename:s,check_URL_duplicates:n?1:void 0,save_URL_duplicates:o?1:void 0,signature:a,expire:c,source:h,metadata:_}),signal:d}).then(({data:S,headers:A,request:x})=>{let w=ft(JSON.parse(S));if("error"in w)throw new F(w.error.content,w.error.errorCode,x,w,A);return w}),{retryNetworkErrorMaxTimes:m,retryThrottledRequestMaxTimes:g})}l(cl,"fromUrl");var H;(function(r){r.Unknown="unknown",r.Waiting="waiting",r.Progress="progress",r.Error="error",r.Success="success"})(H||(H={}));var hl=l(r=>"status"in r&&r.status===H.Error,"isErrorResponse");function ul(r,{publicKey:e,baseURL:t=$.baseURL,signal:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=$.retryNetworkErrorMaxTimes}={}){return yt(()=>_t({method:"GET",headers:e?{"X-UC-User-Agent":It({publicKey:e,integration:s,userAgent:n})}:void 0,url:dt(t,"/from_url/status/",{jsonerrors:1,token:r}),signal:i}).then(({data:c,headers:h,request:d})=>{let p=ft(JSON.parse(c));if("error"in p&&!hl(p))throw new F(p.error.content,void 0,d,p,h);return p}),{retryNetworkErrorMaxTimes:a,retryThrottledRequestMaxTimes:o})}l(ul,"fromUrlStatus");function dl(r,{publicKey:e,baseURL:t=$.baseURL,jsonpCallback:i,secureSignature:s,secureExpire:n,signal:o,source:a,integration:c,userAgent:h,retryThrottledRequestMaxTimes:d=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:p=$.retryNetworkErrorMaxTimes}){return yt(()=>_t({method:"POST",headers:{"X-UC-User-Agent":It({publicKey:e,integration:c,userAgent:h})},url:dt(t,"/group/",{jsonerrors:1,pub_key:e,files:r,callback:i,signature:s,expire:n,source:a}),signal:o}).then(({data:f,headers:g,request:m})=>{let _=ft(JSON.parse(f));if("error"in _)throw new F(_.error.content,_.error.errorCode,m,_,g);return _}),{retryNetworkErrorMaxTimes:p,retryThrottledRequestMaxTimes:d})}l(dl,"group");function Yr(r,{publicKey:e,baseURL:t=$.baseURL,signal:i,source:s,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:c=$.retryNetworkErrorMaxTimes}){return yt(()=>_t({method:"GET",headers:{"X-UC-User-Agent":It({publicKey:e,integration:n,userAgent:o})},url:dt(t,"/info/",{jsonerrors:1,pub_key:e,file_id:r,source:s}),signal:i}).then(({data:h,headers:d,request:p})=>{let f=ft(JSON.parse(h));if("error"in f)throw new F(f.error.content,f.error.errorCode,p,f,d);return f}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:c})}l(Yr,"info");function pl(r,{publicKey:e,contentType:t,fileName:i,multipartChunkSize:s=$.multipartChunkSize,baseURL:n="",secureSignature:o,secureExpire:a,store:c,signal:h,source:d="local",integration:p,userAgent:f,retryThrottledRequestMaxTimes:g=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=$.retryNetworkErrorMaxTimes,metadata:_}){return yt(()=>_t({method:"POST",url:dt(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":It({publicKey:e,integration:p,userAgent:f})},data:ss({filename:i||Xr,size:r,content_type:t||di,part_size:s,UPLOADCARE_STORE:rs(c),UPLOADCARE_PUB_KEY:e,signature:o,expire:a,source:d,metadata:_}),signal:h}).then(({data:S,headers:A,request:x})=>{let w=ft(JSON.parse(S));if("error"in w)throw new F(w.error.content,w.error.errorCode,x,w,A);return w.parts=Object.keys(w.parts).map(z=>w.parts[z]),w}),{retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m})}l(pl,"multipartStart");function fl(r,e,{contentType:t,signal:i,onProgress:s,retryThrottledRequestMaxTimes:n=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=$.retryNetworkErrorMaxTimes}){return yt(()=>_t({method:"PUT",url:e,data:r,onProgress:s,signal:i,headers:{"Content-Type":t||di}}).then(a=>(s&&s({isComputable:!0,value:1}),a)).then(({status:a})=>({code:a})),{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o})}l(fl,"multipartUpload");function ml(r,{publicKey:e,baseURL:t=$.baseURL,source:i="local",signal:s,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:c=$.retryNetworkErrorMaxTimes}){return yt(()=>_t({method:"POST",url:dt(t,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":It({publicKey:e,integration:n,userAgent:o})},data:ss({uuid:r,UPLOADCARE_PUB_KEY:e,source:i}),signal:s}).then(({data:h,headers:d,request:p})=>{let f=ft(JSON.parse(h));if("error"in f)throw new F(f.error.content,f.error.errorCode,p,f,d);return f}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:c})}l(ml,"multipartComplete");function ns(r,{publicKey:e,baseURL:t,source:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a,signal:c,onProgress:h}){return Wr({check:d=>Yr(r,{publicKey:e,baseURL:t,signal:d,source:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a}).then(p=>p.isReady?p:(h&&h({isComputable:!0,value:1}),!1)),signal:c})}l(ns,"isReadyPoll");function gl(r){return"defaultEffects"in r}l(gl,"isGroupFileInfo");var cs=class cs{constructor(e,{baseCDN:t=$.baseCDN,fileName:i}={}){u(this,"uuid");u(this,"name",null);u(this,"size",null);u(this,"isStored",null);u(this,"isImage",null);u(this,"mimeType",null);u(this,"cdnUrl",null);u(this,"s3Url",null);u(this,"originalFilename",null);u(this,"imageInfo",null);u(this,"videoInfo",null);u(this,"contentInfo",null);u(this,"metadata",null);u(this,"s3Bucket",null);u(this,"defaultEffects",null);let{uuid:s,s3Bucket:n}=e,o=dt(t,`${s}/`),a=n?dt(`https://${n}.s3.amazonaws.com/`,`${s}/${e.filename}`):null;this.uuid=s,this.name=i||e.filename,this.size=e.size,this.isStored=e.isStored,this.isImage=e.isImage,this.mimeType=e.mimeType,this.cdnUrl=o,this.originalFilename=e.originalFilename,this.imageInfo=e.imageInfo,this.videoInfo=e.videoInfo,this.contentInfo=e.contentInfo,this.metadata=e.metadata||null,this.s3Bucket=n||null,this.s3Url=a,gl(e)&&(this.defaultEffects=e.defaultEffects)}};l(cs,"UploadcareFile");var pt=cs,bl=l((r,{publicKey:e,fileName:t,baseURL:i,secureSignature:s,secureExpire:n,store:o,contentType:a,signal:c,onProgress:h,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,baseCDN:_,metadata:S})=>al(r,{publicKey:e,fileName:t,contentType:a,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:c,onProgress:h,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,metadata:S}).then(({file:A})=>ns(A,{publicKey:e,baseURL:i,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,onProgress:h,signal:c})).then(A=>new pt(A,{baseCDN:_})),"uploadDirect"),_l=l((r,{publicKey:e,fileName:t,baseURL:i,signal:s,onProgress:n,source:o,integration:a,userAgent:c,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:d,baseCDN:p})=>Yr(r,{publicKey:e,baseURL:i,signal:s,source:o,integration:a,userAgent:c,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:d}).then(f=>new pt(f,{baseCDN:p,fileName:t})).then(f=>(n&&n({isComputable:!0,value:1}),f)),"uploadFromUploaded"),yl=l((r,{signal:e}={})=>{let t=null,i=null,s=r.map(()=>new AbortController),n=l(o=>()=>{i=o,s.forEach((a,c)=>c!==o&&a.abort())},"createStopRaceCallback");return ui(e,()=>{s.forEach(o=>o.abort())}),Promise.all(r.map((o,a)=>{let c=n(a);return Promise.resolve().then(()=>o({stopRace:c,signal:s[a].signal})).then(h=>(c(),h)).catch(h=>(t=h,null))})).then(o=>{if(i===null)throw t;return o[i]})},"race"),vl=window.WebSocket,hs=class hs{constructor(){u(this,"events",Object.create({}))}emit(e,t){var i;(i=this.events[e])==null||i.forEach(s=>s(t))}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){t?this.events[e]=this.events[e].filter(i=>i!==t):this.events[e]=[]}};l(hs,"Events");var Qi=hs,Cl=l((r,e)=>r==="success"?{status:H.Success,...e}:r==="progress"?{status:H.Progress,...e}:{status:H.Error,...e},"response"),us=class us{constructor(e,t=3e4){u(this,"key");u(this,"disconnectTime");u(this,"ws");u(this,"queue",[]);u(this,"isConnected",!1);u(this,"subscribers",0);u(this,"emmitter",new Qi);u(this,"disconnectTimeoutId",null);this.key=e,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){let e=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new vl(e),this.ws.addEventListener("error",t=>{this.emmitter.emit("error",new Error(t.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(t=>this.send(t.event,t.data)),this.queue=[]}),this.ws.addEventListener("message",t=>{let i=JSON.parse(t.data.toString());switch(i.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(i.channel,Cl(i.event,JSON.parse(i.data)))}})}}disconnect(){let e=l(()=>{var t;(t=this.ws)==null||t.close(),this.ws=void 0,this.isConnected=!1},"actualDisconect");this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{e()},this.disconnectTime):e()}send(e,t){var s;let i=JSON.stringify({event:e,data:t});(s=this.ws)==null||s.send(i)}subscribe(e,t){this.subscribers+=1,this.connect();let i=`task-status-${e}`,s={event:"pusher:subscribe",data:{channel:i}};this.emmitter.on(i,t),this.isConnected?this.send(s.event,s.data):this.queue.push(s)}unsubscribe(e){this.subscribers-=1;let t=`task-status-${e}`,i={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(i.event,i.data):this.queue=this.queue.filter(s=>s.data.channel!==t),this.subscribers===0&&this.disconnect()}onError(e){return this.emmitter.on("error",e),()=>this.emmitter.off("error",e)}};l(us,"Pusher");var ts=us,Yi=null,os=l(r=>{if(!Yi){let e=typeof window=="undefined"?0:3e4;Yi=new ts(r,e)}return Yi},"getPusher"),wl=l(r=>{os(r).connect()},"preconnect");function Tl({token:r,publicKey:e,baseURL:t,integration:i,userAgent:s,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,onProgress:a,signal:c}){return Wr({check:h=>ul(r,{publicKey:e,baseURL:t,integration:i,userAgent:s,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,signal:h}).then(d=>{switch(d.status){case H.Error:return new F(d.error,d.errorCode);case H.Waiting:return!1;case H.Unknown:return new F(`Token "${r}" was not found.`);case H.Progress:return a&&(d.total==="unknown"?a({isComputable:!1}):a({isComputable:!0,value:d.done/d.total})),!1;case H.Success:return a&&a({isComputable:!0,value:d.done/d.total}),d;default:throw new Error("Unknown status")}}),signal:c})}l(Tl,"pollStrategy");var xl=l(({token:r,pusherKey:e,signal:t,onProgress:i})=>new Promise((s,n)=>{let o=os(e),a=o.onError(n),c=l(()=>{a(),o.unsubscribe(r)},"destroy");ui(t,()=>{c(),n(new Nt("pusher cancelled"))}),o.subscribe(r,h=>{switch(h.status){case H.Progress:{i&&(h.total==="unknown"?i({isComputable:!1}):i({isComputable:!0,value:h.done/h.total}));break}case H.Success:{c(),i&&i({isComputable:!0,value:h.done/h.total}),s(h);break}case H.Error:c(),n(new F(h.msg,h.error_code))}})}),"pushStrategy"),El=l((r,{publicKey:e,fileName:t,baseURL:i,baseCDN:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:c,store:h,signal:d,onProgress:p,source:f,integration:g,userAgent:m,retryThrottledRequestMaxTimes:_,pusherKey:S=$.pusherKey,metadata:A})=>Promise.resolve(wl(S)).then(()=>cl(r,{publicKey:e,fileName:t,baseURL:i,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:c,store:h,signal:d,source:f,integration:g,userAgent:m,retryThrottledRequestMaxTimes:_,metadata:A})).catch(x=>{let w=os(S);return w==null||w.disconnect(),Promise.reject(x)}).then(x=>x.type===Ji.FileInfo?x:yl([({signal:w})=>Tl({token:x.token,publicKey:e,baseURL:i,integration:g,userAgent:m,retryThrottledRequestMaxTimes:_,onProgress:p,signal:w}),({signal:w})=>xl({token:x.token,pusherKey:S,signal:w,onProgress:p})],{signal:d})).then(x=>{if(x instanceof F)throw x;return x}).then(x=>ns(x.uuid,{publicKey:e,baseURL:i,integration:g,userAgent:m,retryThrottledRequestMaxTimes:_,onProgress:p,signal:d})).then(x=>new pt(x,{baseCDN:s})),"uploadFromUrl"),Zi=new WeakMap,Al=l(async r=>{if(Zi.has(r))return Zi.get(r);let e=await fetch(r.uri).then(t=>t.blob());return Zi.set(r,e),e},"getBlobFromReactNativeAsset"),Zr=l(async r=>{if(fi(r)||pi(r))return r.size;if(mi(r))return(await Al(r)).size;throw new Error("Unknown file type. Cannot determine file size.")},"getFileSize"),$l=l((r,e=$.multipartMinFileSize)=>r>=e,"isMultipart"),Jr=l(r=>{let e="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",t=new RegExp(e);return!Dt(r)&&t.test(r)},"isUuid"),ls=l(r=>{let e="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",t=new RegExp(e);return!Dt(r)&&t.test(r)},"isUrl"),Sl=l((r,e)=>new Promise((t,i)=>{let s=[],n=!1,o=e.length,a=[...e],c=l(()=>{let h=e.length-a.length,d=a.shift();d&&d().then(p=>{n||(s[h]=p,o-=1,o?c():t(s))}).catch(p=>{n=!0,i(p)})},"run");for(let h=0;h<r;h++)c()}),"runWithConcurrency"),Il=l((r,e,t,i)=>{let s=i*e,n=Math.min(s+i,t);return r.slice(s,n)},"sliceChunk"),Ol=l(async(r,e,t)=>i=>Il(r,i,e,t),"prepareChunks"),kl=l((r,e,{publicKey:t,contentType:i,onProgress:s,signal:n,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:c})=>fl(r,e,{publicKey:t,contentType:i,onProgress:s,signal:n,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:c}),"uploadPart"),Ll=l(async(r,{publicKey:e,fileName:t,fileSize:i,baseURL:s,secureSignature:n,secureExpire:o,store:a,signal:c,onProgress:h,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,contentType:_,multipartChunkSize:S=$.multipartChunkSize,maxConcurrentRequests:A=$.maxConcurrentRequests,baseCDN:x,metadata:w})=>{let z=i!=null?i:await Zr(r),ct,$t=l((P,j)=>{if(!h)return;ct||(ct=Array(P).fill(0));let tt=l(et=>et.reduce((ht,Hi)=>ht+Hi,0),"sum");return et=>{et.isComputable&&(ct[j]=et.value,h({isComputable:!0,value:tt(ct)/P}))}},"createProgressHandler");return _||(_=qr(r)),pl(z,{publicKey:e,contentType:_,fileName:t||Kr(r),baseURL:s,secureSignature:n,secureExpire:o,store:a,signal:c,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,metadata:w}).then(async({uuid:P,parts:j})=>{let tt=await Ol(r,z,S);return Promise.all([P,Sl(A,j.map((et,ht)=>()=>kl(tt(ht),et,{publicKey:e,contentType:_,onProgress:$t(j.length,ht),signal:c,integration:p,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m})))])}).then(([P])=>ml(P,{publicKey:e,baseURL:s,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m})).then(P=>P.isReady?P:ns(P.uuid,{publicKey:e,baseURL:s,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,onProgress:h,signal:c})).then(P=>new pt(P,{baseCDN:x}))},"uploadMultipart");async function as(r,{publicKey:e,fileName:t,baseURL:i=$.baseURL,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,contentType:m,multipartMinFileSize:_,multipartChunkSize:S,maxConcurrentRequests:A,baseCDN:x=$.baseCDN,checkForUrlDuplicates:w,saveUrlForRecurrentUploads:z,pusherKey:ct,metadata:$t}){if(Dt(r)){let P=await Zr(r);return $l(P,_)?Ll(r,{publicKey:e,contentType:m,multipartChunkSize:S,fileSize:P,fileName:t,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:h,integration:d,userAgent:p,maxConcurrentRequests:A,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,baseCDN:x,metadata:$t}):bl(r,{publicKey:e,fileName:t,contentType:m,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,baseCDN:x,metadata:$t})}if(ls(r))return El(r,{publicKey:e,fileName:t,baseURL:i,baseCDN:x,checkForUrlDuplicates:w,saveUrlForRecurrentUploads:z,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,pusherKey:ct,metadata:$t});if(Jr(r))return _l(r,{publicKey:e,fileName:t,baseURL:i,signal:a,onProgress:c,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,baseCDN:x});throw new TypeError(`File uploading from "${r}" is not supported`)}l(as,"uploadFile");var ds=class ds{constructor(e,{baseCDN:t=$.baseCDN}={}){u(this,"uuid");u(this,"filesCount");u(this,"totalSize");u(this,"isStored");u(this,"isImage");u(this,"cdnUrl");u(this,"files");u(this,"createdAt");u(this,"storedAt",null);this.uuid=e.id,this.filesCount=e.filesCount;let i=e.files.filter(Boolean);this.totalSize=Object.values(i).reduce((s,n)=>s+n.size,0),this.isStored=!!e.datetimeStored,this.isImage=!!Object.values(i).filter(s=>s.isImage).length,this.cdnUrl=e.cdnUrl,this.files=i.map(s=>new pt(s,{baseCDN:t})),this.createdAt=e.datetimeCreated,this.storedAt=e.datetimeStored}};l(ds,"UploadcareGroup");var es=ds,Rl=l(r=>{for(let e of r)if(!Dt(e))return!1;return!0},"isFileDataArray"),Ul=l(r=>{for(let e of r)if(!Jr(e))return!1;return!0},"isUuidArray"),Pl=l(r=>{for(let e of r)if(!ls(e))return!1;return!0},"isUrlArray");function Qr(r,{publicKey:e,fileName:t,baseURL:i=$.baseURL,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,contentType:m,multipartChunkSize:_=$.multipartChunkSize,baseCDN:S=$.baseCDN,checkForUrlDuplicates:A,saveUrlForRecurrentUploads:x,jsonpCallback:w}){if(!Rl(r)&&!Pl(r)&&!Ul(r))throw new TypeError(`Group uploading from "${r}" is not supported`);let z,ct=!0,$t=r.length,P=l((j,tt)=>{if(!c)return;z||(z=Array(j).fill(0));let et=l(ht=>ht.reduce((Hi,lo)=>Hi+lo)/j,"normalize");return ht=>{if(!ht.isComputable||!ct){ct=!1,c({isComputable:!1});return}z[tt]=ht.value,c({isComputable:!0,value:et(z)})}},"createProgressHandler");return Promise.all(r.map((j,tt)=>Dt(j)||ls(j)?as(j,{publicKey:e,fileName:t,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:P($t,tt),source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,contentType:m,multipartChunkSize:_,baseCDN:S,checkForUrlDuplicates:A,saveUrlForRecurrentUploads:x}).then(et=>et.uuid):j)).then(j=>dl(j,{publicKey:e,baseURL:i,jsonpCallback:w,secureSignature:s,secureExpire:n,signal:a,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g}).then(tt=>new es(tt,{baseCDN:S})).then(tt=>(c&&c({isComputable:!0,value:1}),tt)))}l(Qr,"uploadFileGroup");var ps=class ps{constructor(e){u(this,"_concurrency",1);u(this,"_pending",[]);u(this,"_running",0);u(this,"_resolvers",new Map);u(this,"_rejectors",new Map);this._concurrency=e}_run(){let e=this._concurrency-this._running;for(let t=0;t<e;t++){let i=this._pending.shift();if(!i)return;let s=this._resolvers.get(i),n=this._rejectors.get(i);if(!s||!n)throw new Error("Unexpected behavior: resolver or rejector is undefined");this._running+=1,i().finally(()=>{this._resolvers.delete(i),this._rejectors.delete(i),this._running-=1,this._run()}).then(o=>s(o)).catch(o=>n(o))}}add(e){return new Promise((t,i)=>{this._resolvers.set(e,t),this._rejectors.set(e,i),this._pending.push(e),this._run()})}get pending(){return this._pending.length}get running(){return this._running}set concurrency(e){this._concurrency=e,this._run()}get concurrency(){return this._concurrency}};l(ps,"Queue");var li=ps;var fs=l(()=>({"*blocksRegistry":new Set,"*eventEmitter":null}),"blockCtx"),ms=l(r=>({...fs(),"*currentActivity":"","*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{r.set$({"*modalActive":!1,"*currentActivity":""})}}),"activityBlockCtx"),gi=l(r=>({...ms(r),"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null,"*uploadMetadata":null,"*uploadQueue":new li(1),"*uploadCollection":null}),"uploaderBlockCtx");function tn(r,e){[...r.querySelectorAll("[l10n]")].forEach(t=>{let i=t.getAttribute("l10n"),s="textContent";if(i.includes(":")){let o=i.split(":");s=o[0],i=o[1]}let n="l10n:"+i;e.__l10nKeys.push(n),e.add(n,i),e.sub(n,o=>{t[s]=e.l10n(o)}),t.removeAttribute("l10n")})}l(tn,"l10nProcessor");var W=l(r=>`*cfg/${r}`,"sharedConfigKey");var gs="lr-",ve=class ve extends St{constructor(){super();u(this,"requireCtxName",!1);u(this,"allowCustomTemplate",!0);u(this,"init$",fs());u(this,"updateCtxCssData",l(()=>{ye("Using CSS variables for configuration is deprecated. Please use `lr-config` instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/");let t=this.$["*blocksRegistry"];for(let i of t)i.isConnected&&i.updateCssData()},"updateCtxCssData"));this.activityType=null,this.addTemplateProcessor(tn),this.__l10nKeys=[]}l10n(t,i={}){if(!t)return"";let s=this.getCssData("--l10n-"+t,!0)||t,n=Vr(s);for(let a of n)i[a.variable]=this.pluralize(a.pluralKey,Number(i[a.countVariable]));return _e(s,i)}pluralize(t,i){let s=this.l10n("locale-name")||"en-US",n=ri(s,i);return this.l10n(`${t}__${n}`)}emit(t,i,s){let n=this.has("*eventEmitter")&&this.$["*eventEmitter"];n&&n.emit(t,i,s)}applyL10nKey(t,i){let s="l10n:"+t;this.$[s]=i,this.__l10nKeys.push(t)}hasBlockInCtx(t){let i=this.$["*blocksRegistry"];for(let s of i)if(t(s))return!0;return!1}setOrAddState(t,i){this.add$({[t]:i},!0)}setActivity(t){if(this.hasBlockInCtx(i=>i.activityType===t)){this.$["*currentActivity"]=t;return}console.warn(`Activity type "${t}" not found in the context`)}connectedCallback(){let t=this.constructor.className;t&&this.classList.toggle(`${gs}${t}`,!0),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?ni({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback(),be.registerClient(this)}disconnectedCallback(){super.disconnectedCallback(),be.unregisterClient(this)}initCallback(){this.$["*blocksRegistry"].add(this),this.$["*eventEmitter"]||(this.$["*eventEmitter"]=new si(()=>this.ctxName))}destroyCallback(){let t=this.$["*blocksRegistry"];t.delete(this),E.deleteCtx(this),t.size===0&&setTimeout(()=>{this.destroyCtxCallback()},0)}destroyCtxCallback(){E.deleteCtx(this.ctxName)}fileSizeFmt(t,i=2){let s=["B","KB","MB","GB","TB"],n=l(h=>this.getCssData("--l10n-unit-"+h.toLowerCase(),!0)||h,"getUnit");if(t===0)return`0 ${n(s[0])}`;let o=1024,a=i<0?0:i,c=Math.floor(Math.log(t)/Math.log(o));return parseFloat((t/o**c).toFixed(a))+" "+n(s[c])}proxyUrl(t){let i=this.cfg.secureDeliveryProxy;return i?_e(i,{previewUrl:t},{transform:s=>window.encodeURIComponent(s)}):t}parseCfgProp(t){return{ctx:this.nodeCtx,name:t.replace("*","")}}get cfg(){if(!this.__cfgProxy){let t=Object.create(null);this.__cfgProxy=new Proxy(t,{set:(i,s,n)=>{if(typeof s!="string")return!1;let o=W(s);return this.$[o]=n,!0},get:(i,s)=>{let n=W(s),o=this.parseCfgProp(n);return o.ctx.has(o.name)?o.ctx.read(o.name):(ye("Using CSS variables for configuration is deprecated. Please use `lr-config` instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.getCssData(`--cfg-${it(s)}`))}})}return this.__cfgProxy}subConfigValue(t,i){let s=this.parseCfgProp(W(t));s.ctx.has(s.name)?this.sub(W(t),i):(this.bindCssData(`--cfg-${it(t)}`),this.sub(`--cfg-${it(t)}`,i))}static reg(t){if(!t){super.reg();return}super.reg(t.startsWith(gs)?t:gs+t)}};l(ve,"Block"),u(ve,"StateConsumerScope",null),u(ve,"className","");var y=ve;var en="active",Ce="___ACTIVITY_IS_ACTIVE___",Z=class Z extends y{constructor(){super(...arguments);u(this,"historyTracked",!1);u(this,"init$",ms(this));u(this,"_debouncedHistoryFlush",O(this._historyFlush.bind(this),10))}_deactivate(){var i;let t=Z._activityRegistry[this.activityKey];this[Ce]=!1,this.removeAttribute(en),(i=t==null?void 0:t.deactivateCallback)==null||i.call(t)}_activate(){var i;let t=Z._activityRegistry[this.activityKey];this.$["*historyBack"]=this.historyBack.bind(this),this[Ce]=!0,this.setAttribute(en,""),(i=t==null?void 0:t.activateCallback)==null||i.call(t),this._debouncedHistoryFlush()}initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",t=>{this.setAttribute("current-activity",t)}),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",t=>{this.activityType!==t&&this[Ce]?this._deactivate():this.activityType===t&&!this[Ce]&&this._activate(),t||(this.$["*history"]=[])}),this.has("*modalActive")&&this.sub("*modalActive",t=>{!t&&this.activityType===this.$["*currentActivity"]&&(this.$["*currentActivity"]=null)}))}_historyFlush(){let t=this.$["*history"];t&&(t.length>10&&(t=t.slice(t.length-11,t.length-1)),this.historyTracked&&t[t.length-1]!==this.activityType&&t.push(this.activityType),this.$["*history"]=t)}_isActivityRegistered(){return this.activityType&&!!Z._activityRegistry[this.activityKey]}get isActivityActive(){return this[Ce]}get couldOpenActivity(){return!0}registerActivity(t,i={}){let{onActivate:s,onDeactivate:n}=i;Z._activityRegistry||(Z._activityRegistry=Object.create(null)),Z._activityRegistry[this.activityKey]={activateCallback:s,deactivateCallback:n}}unregisterActivity(){this.isActivityActive&&this._deactivate(),Z._activityRegistry[this.activityKey]=void 0}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity(),Object.keys(Z._activityRegistry).length===0&&(this.$["*currentActivity"]=null)}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){var i;let t=this.$["*history"];if(t){let s=t.pop();for(;s===this.activityType;)s=t.pop();let n=!!s;if(s){let a=[...this.$["*blocksRegistry"]].find(c=>c.activityType===s);n=(i=a==null?void 0:a.couldOpenActivity)!=null?i:!1}s=n?s:void 0,this.$["*currentActivity"]=s,this.$["*history"]=t,s||this.setOrAddState("*modalActive",!1)}}};l(Z,"ActivityBlock"),u(Z,"_activityRegistry",Object.create(null));var b=Z;b.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});var we=33.333333333333336,v=1,bs=24,sn=6;function Ot(r,e){for(let t in e)r.setAttributeNS(null,t,e[t].toString())}l(Ot,"setSvgNodeAttrs");function J(r,e={}){let t=document.createElementNS("http://www.w3.org/2000/svg",r);return Ot(t,e),t}l(J,"createSvgNode");function rn(r,e,t){let{x:i,y:s,width:n,height:o}=r,a=e.includes("w")?0:1,c=e.includes("n")?0:1,h=[-1,1][a],d=[-1,1][c],p=[i+a*n+1.5*h,s+c*o+1.5*d-24*t*d],f=[i+a*n+1.5*h,s+c*o+1.5*d],g=[i+a*n-24*t*h+1.5*h,s+c*o+1.5*d];return{d:`M ${p[0]} ${p[1]} L ${f[0]} ${f[1]} L ${g[0]} ${g[1]}`,center:f}}l(rn,"cornerPath");function nn(r,e,t){let{x:i,y:s,width:n,height:o}=r,a=["n","s"].includes(e)?.5:{w:0,e:1}[e],c=["w","e"].includes(e)?.5:{n:0,s:1}[e],h=[-1,1][a],d=[-1,1][c],p,f;["n","s"].includes(e)?(p=[i+a*n-34*t/2,s+c*o+1.5*d],f=[i+a*n+34*t/2,s+c*o+1.5*d]):(p=[i+a*n+1.5*h,s+c*o-34*t/2],f=[i+a*n+1.5*h,s+c*o+34*t/2]);let g=`M ${p[0]} ${p[1]} L ${f[0]} ${f[1]}`,m=[f[0]-(f[0]-p[0])/2,f[1]-(f[1]-p[1])/2];return{d:g,center:m}}l(nn,"sidePath");function on(r){return r===""?"move":["e","w"].includes(r)?"ew-resize":["n","s"].includes(r)?"ns-resize":["nw","se"].includes(r)?"nwse-resize":"nesw-resize"}l(on,"thumbCursor");function ln({rect:r,delta:[e,t],imageBox:i}){return Vt({...r,x:r.x+e,y:r.y+t},i)}l(ln,"moveRect");function Vt(r,e){let{x:t}=r,{y:i}=r;return r.x<e.x?t=e.x:r.x+r.width>e.x+e.width&&(t=e.x+e.width-r.width),r.y<e.y?i=e.y:r.y+r.height>e.y+e.height&&(i=e.y+e.height-r.height),{...r,x:t,y:i}}l(Vt,"constraintRect");function Ml({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[,s]=e,{y:n,width:o,height:a}=r;n+=s,a-=s,t&&(o=a*t);let c=r.x+r.width/2-o/2;return n<=i.y&&(n=i.y,a=r.y+r.height-n,t&&(o=a*t,c=r.x+r.width/2-o/2)),c<=i.x&&(c=i.x,n=r.y+r.height-a),c+o>=i.x+i.width&&(c=Math.max(i.x,i.x+i.width-o),o=i.x+i.width-c,t&&(a=o/t),n=r.y+r.height-a),a<v&&(a=v,t&&(o=a*t,c=r.x+r.width/2-o/2),n=r.y+r.height-a),o<v&&(o=v,t&&(a=o/t,c=r.x+r.width/2-o/2),n=r.y+r.height-a),{x:c,y:n,width:o,height:a}}l(Ml,"resizeNorth");function Nl({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s]=e,{x:n,width:o,height:a}=r;n+=s,o-=s,t&&(a=o/t);let c=r.y+r.height/2-a/2;return n<=i.x&&(n=i.x,o=r.x+r.width-n,t&&(a=o/t,c=r.y+r.height/2-a/2)),c<=i.y&&(c=i.y,n=r.x+r.width-o),c+a>=i.y+i.height&&(c=Math.max(i.y,i.y+i.height-a),a=i.y+i.height-c,t&&(o=a*t),n=r.x+r.width-o),a<v&&(a=v,t&&(o=a*t),c=r.y+r.height/2-a/2,n=r.x+r.width-o),o<v&&(o=v,t&&(a=o/t),c=r.y+r.height/2-a/2,n=r.x+r.width-o),{x:n,y:c,width:o,height:a}}l(Nl,"resizeWest");function Dl({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[,s]=e,{y:n,width:o,height:a}=r;a+=s,t&&(o=a*t);let c=r.x+r.width/2-o/2;return n+a>=i.y+i.height&&(a=i.y+i.height-n,t&&(o=a*t),c=r.x+r.width/2-o/2),c<=i.x&&(c=i.x,n=r.y),c+o>=i.x+i.width&&(c=Math.max(i.x,i.x+i.width-o),o=i.x+i.width-c,t&&(a=o/t),n=r.y),a<v&&(a=v,t&&(o=a*t),c=r.x+r.width/2-o/2),o<v&&(o=v,t&&(a=o/t),c=r.x+r.width/2-o/2),{x:c,y:n,width:o,height:a}}l(Dl,"resizeSouth");function Fl({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s]=e,{x:n,width:o,height:a}=r;o+=s,t&&(a=o/t);let c=r.y+r.height/2-a/2;return n+o>=i.x+i.width&&(o=i.x+i.width-n,t&&(a=o/t),c=r.y+r.height/2-a/2),c<=i.y&&(c=i.y,n=r.x),c+a>=i.y+i.height&&(c=Math.max(i.y,i.y+i.height-a),a=i.y+i.height-c,t&&(o=a*t),n=r.x),a<v&&(a=v,t&&(o=a*t),c=r.y+r.height/2-a/2),o<v&&(o=v,t&&(a=o/t),c=r.y+r.height/2-a/2),{x:n,y:c,width:o,height:a}}l(Fl,"resizeEast");function Vl({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s,n]=e,{x:o,y:a,width:c,height:h}=r;return o+s<i.x&&(s=i.x-o),a+n<i.y&&(n=i.y-a),o+=s,c-=s,a+=n,h-=n,t&&Math.abs(c/h)>t?(n=c/t-h,h+=n,a-=n,a<=i.y&&(h=h-(i.y-a),c=h*t,o=r.x+r.width-c,a=i.y)):t&&(s=h*t-c,c=c+s,o-=s,o<=i.x&&(c=c-(i.x-o),h=c/t,o=i.x,a=r.y+r.height-h)),h<v&&(h=v,t&&(c=h*t),o=r.x+r.width-c,a=r.y+r.height-h),c<v&&(c=v,t&&(h=c/t),o=r.x+r.width-c,a=r.y+r.height-h),{x:o,y:a,width:c,height:h}}l(Vl,"resizeNorthWest");function Bl({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s,n]=e,{x:o,y:a,width:c,height:h}=r;return o+c+s>i.x+i.width&&(s=i.x+i.width-o-c),a+n<i.y&&(n=i.y-a),c+=s,a+=n,h-=n,t&&Math.abs(c/h)>t?(n=c/t-h,h+=n,a-=n,a<=i.y&&(h=h-(i.y-a),c=h*t,o=r.x,a=i.y)):t&&(s=h*t-c,c+=s,o+c>=i.x+i.width&&(c=i.x+i.width-o,h=c/t,o=i.x+i.width-c,a=r.y+r.height-h)),h<v&&(h=v,t&&(c=h*t),a=r.y+r.height-h),c<v&&(c=v,t&&(h=c/t),a=r.y+r.height-h),{x:o,y:a,width:c,height:h}}l(Bl,"resizeNorthEast");function zl({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s,n]=e,{x:o,y:a,width:c,height:h}=r;return o+s<i.x&&(s=i.x-o),a+h+n>i.y+i.height&&(n=i.y+i.height-a-h),o+=s,c-=s,h+=n,t&&Math.abs(c/h)>t?(n=c/t-h,h+=n,a+h>=i.y+i.height&&(h=i.y+i.height-a,c=h*t,o=r.x+r.width-c,a=i.y+i.height-h)):t&&(s=h*t-c,c+=s,o-=s,o<=i.x&&(c=c-(i.x-o),h=c/t,o=i.x,a=r.y)),h<v&&(h=v,t&&(c=h*t),o=r.x+r.width-c),c<v&&(c=v,t&&(h=c/t),o=r.x+r.width-c),{x:o,y:a,width:c,height:h}}l(zl,"resizeSouthWest");function jl({rect:r,delta:e,aspectRatio:t,imageBox:i}){let[s,n]=e,{x:o,y:a,width:c,height:h}=r;return o+c+s>i.x+i.width&&(s=i.x+i.width-o-c),a+h+n>i.y+i.height&&(n=i.y+i.height-a-h),c+=s,h+=n,t&&Math.abs(c/h)>t?(n=c/t-h,h+=n,a+h>=i.y+i.height&&(h=i.y+i.height-a,c=h*t,o=r.x,a=i.y+i.height-h)):t&&(s=h*t-c,c+=s,o+c>=i.x+i.width&&(c=i.x+i.width-o,h=c/t,o=i.x+i.width-c,a=r.y)),h<v&&(h=v,t&&(c=h*t)),c<v&&(c=v,t&&(h=c/t)),{x:o,y:a,width:c,height:h}}l(jl,"resizeSouthEast");function an({direction:r,...e}){switch(r){case"n":return Ml(e);case"w":return Nl(e);case"s":return Dl(e);case"e":return Fl(e);case"nw":return Vl(e);case"ne":return Bl(e);case"sw":return zl(e);case"se":return jl(e);default:return e.rect}}l(an,"resizeRect");function cn(r,[e,t]){return r.x<=e&&e<=r.x+r.width&&r.y<=t&&t<=r.y+r.height}l(cn,"rectContainsPoint");function hn(r,e){return r.x>=e.x&&r.y>=e.y&&r.x+r.width<=e.x+e.width&&r.y+r.height<=e.y+e.height}l(hn,"isRectInsideRect");function un(r,e){return Math.abs(r.width/r.height-e)<.1}l(un,"isRectMatchesAspectRatio");function Bt({width:r,height:e},t){let i=t/90%2!==0;return{width:i?e:r,height:i?r:e}}l(Bt,"rotateSize");function dn(r,e,t){let i=r/e,s,n;i>t?(s=Math.round(e*t),n=e):(s=r,n=Math.round(r/t));let o=Math.round((r-s)/2),a=Math.round((e-n)/2);return o+s>r&&(s=r-o),a+n>e&&(n=e-a),{x:o,y:a,width:s,height:n}}l(dn,"calculateMaxCenteredCropFrame");function zt(r){return{x:Math.round(r.x),y:Math.round(r.y),width:Math.round(r.width),height:Math.round(r.height)}}l(zt,"roundRect");function vt(r,e,t){return Math.min(Math.max(r,e),t)}l(vt,"clamp");var _i=l(r=>{if(!r)return[];let[e,t]=r.split(":").map(Number);if(!Number.isFinite(e)||!Number.isFinite(t)){console.error(`Invalid crop preset: ${r}`);return}return[{type:"aspect-ratio",width:e,height:t}]},"parseCropPreset");var Q=Object.freeze({LOCAL:"local",DROP_AREA:"drop-area",URL_TAB:"url-tab",CAMERA:"camera",EXTERNAL:"external",API:"js-api"});var pn=l(r=>r?r.split(",").map(e=>e.trim()):[],"deserealizeCsv"),kt=l(r=>r?r.join(","):"","serializeCsv");var _s="blocks",ys="0.30.8";function fn(r){return is({...r,libraryName:_s,libraryVersion:ys})}l(fn,"customUserAgent");var mn=l(r=>{if(typeof r!="string"||!r)return"";let e=r.trim();return e.startsWith("-/")?e=e.slice(2):e.startsWith("/")&&(e=e.slice(1)),e.endsWith("/")&&(e=e.slice(0,e.length-1)),e},"normalizeCdnOperation"),yi=l((...r)=>r.filter(e=>typeof e=="string"&&e).map(e=>mn(e)).join("/-/"),"joinCdnOperations"),M=l((...r)=>{let e=yi(...r);return e?`-/${e}/`:""},"createCdnUrlModifiers");function gn(r){let e=new URL(r),t=e.pathname+e.search+e.hash,i=t.lastIndexOf("http"),s=t.lastIndexOf("/"),n="";return i>=0?n=t.slice(i):s>=0&&(n=t.slice(s+1)),n}l(gn,"extractFilename");function bn(r){let e=new URL(r),{pathname:t}=e,i=t.indexOf("/"),s=t.indexOf("/",i+1);return t.substring(i+1,s)}l(bn,"extractUuid");function _n(r){let e=yn(r),t=new URL(e),i=t.pathname.indexOf("/-/");return i===-1?[]:t.pathname.substring(i).split("/-/").filter(Boolean).map(n=>mn(n))}l(_n,"extractOperations");function yn(r){let e=new URL(r),t=gn(r),i=vn(t)?Cn(t).pathname:t;return e.pathname=e.pathname.replace(i,""),e.search="",e.hash="",e.toString()}l(yn,"trimFilename");function vn(r){return r.startsWith("http")}l(vn,"isFileUrl");function Cn(r){let e=new URL(r);return{pathname:e.origin+e.pathname||"",search:e.search||"",hash:e.hash||""}}l(Cn,"splitFileUrl");var L=l((r,e,t)=>{let i=new URL(yn(r));if(t=t||gn(r),i.pathname.startsWith("//")&&(i.pathname=i.pathname.replace("//","/")),vn(t)){let s=Cn(t);i.pathname=i.pathname+(e||"")+(s.pathname||""),i.search=s.search,i.hash=s.hash}else i.pathname=i.pathname+(e||"")+(t||"");return i.toString()},"createCdnUrl"),Ct=l((r,e)=>{let t=new URL(r);return t.pathname=e+"/",t.toString()},"createOriginalUrl");var N=l((r,e=",")=>r.trim().split(e).map(t=>t.trim()).filter(t=>t.length>0),"stringToArray");var Te=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],vs=l(r=>r?r.filter(e=>typeof e=="string").map(e=>N(e)).flat():[],"mergeFileTypes"),Cs=l((r,e)=>e.some(t=>t.endsWith("*")?(t=t.replace("*",""),r.startsWith(t)):r===t),"matchMimeType"),wn=l((r,e)=>e.some(t=>t.startsWith(".")?r.toLowerCase().endsWith(t.toLowerCase()):!1),"matchExtension"),xe=l(r=>{let e=r==null?void 0:r.type;return e?Cs(e,Te):!1},"fileIsImage");var rt=1e3,Lt=Object.freeze({AUTO:"auto",BYTE:"byte",KB:"kb",MB:"mb",GB:"gb",TB:"tb",PB:"pb"}),Ee=l(r=>Math.ceil(r*100)/100,"round"),Tn=l((r,e=Lt.AUTO)=>{let t=e===Lt.AUTO;if(e===Lt.BYTE||t&&r<rt**1){let i=ri("en-US",r),s={one:"byte",other:"bytes"}[i];return`${r} ${s}`}return e===Lt.KB||t&&r<rt**2?`${Ee(r/rt**1)} KB`:e===Lt.MB||t&&r<rt**3?`${Ee(r/rt**2)} MB`:e===Lt.GB||t&&r<rt**4?`${Ee(r/rt**3)} GB`:e===Lt.TB||t&&r<rt**5?`${Ee(r/rt**4)} TB`:`${Ee(r/rt**5)} PB`},"prettyBytes");var xn="[Typed State] Wrong property name: ",Hl="[Typed State] Wrong property type: ",ws=class ws{constructor(e,t){this.__typedSchema=e,this.__ctxId=t||fe.generate(),this.__schema=Object.keys(e).reduce((i,s)=>(i[s]=e[s].value,i),{}),this.__data=E.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(e,t){if(!this.__typedSchema.hasOwnProperty(e)){console.warn(xn+e);return}let i=this.__typedSchema[e];if((t==null?void 0:t.constructor)===i.type||t instanceof i.type||i.nullable&&t===null){this.__data.pub(e,t);return}console.warn(Hl+e)}setMultipleValues(e){for(let t in e)this.setValue(t,e[t])}getValue(e){if(!this.__typedSchema.hasOwnProperty(e)){console.warn(xn+e);return}return this.__data.read(e)}subscribe(e,t){return this.__data.sub(e,t)}remove(){E.deleteCtx(this.__ctxId)}};l(ws,"TypedData");var vi=ws;var Ts=class Ts{constructor(e){this.__typedSchema=e.typedSchema,this.__ctxId=e.ctxName||fe.generate(),this.__data=E.registerCtx({},this.__ctxId),this.__watchList=e.watchList||[],this.__subsMap=Object.create(null),this.__propertyObservers=new Set,this.__collectionObservers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let t=Object.create(null);this.__notifyObservers=(i,s)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[i]||(t[i]=new Set),t[i].add(s),this.__observeTimeout=window.setTimeout(()=>{Object.keys(t).length!==0&&(this.__propertyObservers.forEach(n=>{n({...t})}),t=Object.create(null))})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{let e=new Set(this.__added),t=new Set(this.__removed);this.__added.clear(),this.__removed.clear();for(let i of this.__collectionObservers)i==null||i([...this.__items],e,t)})}observeCollection(e){return this.__collectionObservers.add(e),this.notify(),()=>{this.unobserveCollection(e)}}unobserveCollection(e){var t;(t=this.__collectionObservers)==null||t.delete(e)}add(e){let t=new vi(this.__typedSchema);for(let i in e)t.setValue(i,e[i]);return this.__data.add(t.uid,t),this.__added.add(t),this.__watchList.forEach(i=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(i,()=>{this.__notifyObservers(i,t.uid)}))}),this.__items.add(t.uid),this.notify(),t}read(e){return this.__data.read(e)}readProp(e,t){return this.read(e).getValue(t)}publishProp(e,t,i){this.read(e).setValue(t,i)}remove(e){this.__removed.add(this.__data.read(e)),this.__items.delete(e),this.notify(),this.__data.pub(e,null),delete this.__subsMap[e]}clearAll(){this.__items.forEach(e=>{this.remove(e)})}observeProperties(e){return this.__propertyObservers.add(e),()=>{this.unobserveProperties(e)}}unobserveProperties(e){var t;(t=this.__propertyObservers)==null||t.delete(e)}findItems(e){let t=[];return this.__items.forEach(i=>{let s=this.read(i);e(s)&&t.push(i)}),t}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){E.deleteCtx(this.__ctxId),this.__propertyObservers=null,this.__collectionObservers=null;for(let e in this.__subsMap)this.__subsMap[e].forEach(t=>{t.remove()}),delete this.__subsMap[e]}};l(Ts,"TypedCollection");var Ci=Ts;var En=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null,nullable:!0},fileSize:{type:Number,value:null,nullable:!0},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null,nullable:!0},uploadError:{type:Error,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},validationMultipleLimitMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:pt,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0},silentUpload:{type:Boolean,value:!1},source:{type:String,value:!1,nullable:!0},fullPath:{type:String,value:null,nullable:!0}});var Ae=class Ae extends b{constructor(){super(...arguments);u(this,"couldBeCtxOwner",!1);u(this,"isCtxOwner",!1);u(this,"init$",gi(this));u(this,"__initialUploadMetadata",null);u(this,"_validators",[this._validateMultipleLimit.bind(this),this._validateIsImage.bind(this),this._validateFileType.bind(this),this._validateMaxSizeLimit.bind(this)]);u(this,"_debouncedRunValidators",O(this._runValidators.bind(this),100));u(this,"_flushOutputItems",O(()=>{let t=this.getOutputData();t.length===this.uploadCollection.size&&(this.emit(I.DATA_OUTPUT,t),this.$["*outputData"]=t)},100));u(this,"_handleCollectonUpdate",l((t,i,s)=>{var n;this._runValidators();for(let o of s)(n=o==null?void 0:o.getValue("abortController"))==null||n.abort(),o==null||o.setValue("abortController",null),URL.revokeObjectURL(o==null?void 0:o.getValue("thumbUrl"));this.$["*uploadList"]=t.map(o=>({uid:o})),this._flushOutputItems()},"_handleCollectonUpdate"));u(this,"_handleCollectionPropertiesUpdate",l(t=>{this._flushOutputItems();let i=this.uploadCollection,s=[...new Set(Object.values(t).map(n=>[...n]).flat())].map(n=>i.read(n)).filter(Boolean);for(let n of s)this._runValidatorsForEntry(n);if(t.uploadProgress){let n=0,o=i.findItems(c=>!c.getValue("uploadError"));o.forEach(c=>{n+=i.readProp(c,"uploadProgress")});let a=Math.round(n/o.length);this.$["*commonProgress"]=a,this.emit(I.UPLOAD_PROGRESS,a,{debounce:!0})}if(t.fileInfo){this.cfg.cropPreset&&this.setInitialCrop();let n=i.findItems(a=>!!a.getValue("fileInfo")),o=i.findItems(a=>!!a.getValue("uploadError")||!!a.getValue("validationErrorMsg"));if(i.size-o.length===n.length){let a=this.getOutputData(c=>!!c.getValue("fileInfo")&&!c.getValue("silentUpload"));a.length>0&&this.emit(I.UPLOAD_FINISH,a,{debounce:!0})}}t.uploadError&&i.findItems(o=>!!o.getValue("uploadError")).forEach(o=>{this.emit(I.UPLOAD_ERROR,i.readProp(o,"uploadError"))}),t.validationErrorMsg&&i.findItems(o=>!!o.getValue("validationErrorMsg")).forEach(o=>{this.emit(I.VALIDATION_ERROR,i.readProp(o,"validationErrorMsg"))}),t.cdnUrlModifiers&&i.findItems(o=>!!o.getValue("cdnUrlModifiers")).forEach(o=>{this.emit(I.CLOUD_MODIFICATION,i.readProp(o,"cdnUrlModifiers"))})},"_handleCollectionPropertiesUpdate"))}setUploadMetadata(t){ye("setUploadMetadata is deprecated. Use `metadata` instance property on `lr-config` block instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.connectedOnce?this.$["*uploadMetadata"]=t:this.__initialUploadMetadata=t}get hasCtxOwner(){return this.hasBlockInCtx(t=>t instanceof Ae?t.isCtxOwner&&t.isConnected&&t!==this:!1)}initCallback(){if(super.initCallback(),!this.$["*uploadCollection"]){let t=new Ci({typedSchema:En,watchList:["uploadProgress","fileInfo","uploadError","validationErrorMsg","validationMultipleLimitMsg","cdnUrlModifiers"]});this.$["*uploadCollection"]=t}!this.hasCtxOwner&&this.couldBeCtxOwner&&this.initCtxOwner()}destroyCtxCallback(){var t,i;(t=this._unobserveCollectionProperties)==null||t.call(this),(i=this._unobserveCollection)==null||i.call(this),this.uploadCollection.destroy(),this.$["*uploadCollection"]=null,super.destroyCtxCallback()}initCtxOwner(){this.isCtxOwner=!0,this._unobserveCollection=this.uploadCollection.observeCollection(this._handleCollectonUpdate),this._unobserveCollectionProperties=this.uploadCollection.observeProperties(this._handleCollectionPropertiesUpdate),this.subConfigValue("maxLocalFileSizeBytes",()=>this._debouncedRunValidators()),this.subConfigValue("multipleMin",()=>this._debouncedRunValidators()),this.subConfigValue("multipleMax",()=>this._debouncedRunValidators()),this.subConfigValue("multiple",()=>this._debouncedRunValidators()),this.subConfigValue("imgOnly",()=>this._debouncedRunValidators()),this.subConfigValue("accept",()=>this._debouncedRunValidators()),this.subConfigValue("maxConcurrentRequests",t=>{this.$["*uploadQueue"].concurrency=Number(t)||1}),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata)}addFileFromUrl(t,{silent:i,fileName:s,source:n}={}){this.uploadCollection.add({externalUrl:t,fileName:s!=null?s:null,silentUpload:i!=null?i:!1,source:n!=null?n:Q.API})}addFileFromUuid(t,{silent:i,fileName:s,source:n}={}){this.uploadCollection.add({uuid:t,fileName:s!=null?s:null,silentUpload:i!=null?i:!1,source:n!=null?n:Q.API})}addFileFromObject(t,{silent:i,fileName:s,source:n,fullPath:o}={}){this.uploadCollection.add({file:t,isImage:xe(t),mimeType:t.type,fileName:s!=null?s:t.name,fileSize:t.size,silentUpload:i!=null?i:!1,source:n!=null?n:Q.API,fullPath:o!=null?o:null})}addFiles(t){console.warn("`addFiles` method is deprecated. Please use `addFileFromObject`, `addFileFromUrl` or `addFileFromUuid` instead."),t.forEach(i=>{this.uploadCollection.add({file:i,isImage:xe(i),mimeType:i.type,fileName:i.name,fileSize:i.size})})}uploadAll(){this.$["*uploadTrigger"]={}}openSystemDialog(t={}){var s;let i=kt(vs([(s=this.cfg.accept)!=null?s:"",...this.cfg.imgOnly?Te:[]]));this.cfg.accept&&this.cfg.imgOnly&&console.warn("There could be a mistake.\nBoth `accept` and `imgOnly` parameters are set.\nThe value of `accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=this.cfg.multiple,t.captureCamera?(this.fileInput.capture="",this.fileInput.accept=kt(Te)):this.fileInput.accept=i,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{[...this.fileInput.files].forEach(n=>this.addFileFromObject(n,{source:Q.LOCAL})),this.$["*currentActivity"]=b.activities.UPLOAD_LIST,this.setOrAddState("*modalActive",!0),this.fileInput.value="",this.fileInput=null}}get sourceList(){let t=[];return this.cfg.sourceList&&(t=N(this.cfg.sourceList)),t}initFlow(t=!1){var i;if(this.uploadCollection.size>0&&!t)this.set$({"*currentActivity":b.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0);else if(((i=this.sourceList)==null?void 0:i.length)===1){let s=this.sourceList[0];s==="local"?(this.$["*currentActivity"]=b.activities.UPLOAD_LIST,this==null||this.openSystemDialog()):(Object.values(Ae.extSrcList).includes(s)?this.set$({"*currentActivityParams":{externalSourceType:s},"*currentActivity":b.activities.EXTERNAL}):this.$["*currentActivity"]=s,this.setOrAddState("*modalActive",!0))}else this.set$({"*currentActivity":b.activities.START_FROM}),this.setOrAddState("*modalActive",!0);this.emit(I.INIT_FLOW)}doneFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setOrAddState("*modalActive",!1),this.emit(I.DONE_FLOW)}get uploadCollection(){return this.$["*uploadCollection"]}_validateFileType(t){let i=this.cfg.imgOnly,s=this.cfg.accept,n=vs([...i?Te:[],s]);if(!n.length)return;let o=t.getValue("mimeType"),a=t.getValue("fileName");if(!o||!a)return;let c=Cs(o,n),h=wn(a,n);if(!c&&!h)return this.l10n("file-type-not-allowed")}_validateMaxSizeLimit(t){let i=this.cfg.maxLocalFileSizeBytes,s=t.getValue("fileSize");if(i&&s&&s>i)return this.l10n("files-max-size-limit-error",{maxFileSize:Tn(i)})}_validateMultipleLimit(t){let i=this.uploadCollection.items(),s=i.indexOf(t.uid),n=this.cfg.multiple?this.cfg.multipleMin:1,o=this.cfg.multiple?this.cfg.multipleMax:1;if(n&&i.length<n)return this.l10n("files-count-minimum",{count:n});if(o&&s>=o)return this.l10n("files-count-allowed",{count:o})}_validateIsImage(t){let i=this.cfg.imgOnly,s=t.getValue("isImage");if(!(!i||s)&&!(!t.getValue("fileInfo")&&t.getValue("externalUrl"))&&!(!t.getValue("fileInfo")&&!t.getValue("mimeType")))return this.l10n("images-only-accepted")}_runValidatorsForEntry(t){for(let i of this._validators){let s=i(t);if(s){t.setValue("validationErrorMsg",s);return}}t.setValue("validationErrorMsg",null)}_runValidators(){for(let t of this.uploadCollection.items())setTimeout(()=>{let i=this.uploadCollection.read(t);i&&this._runValidatorsForEntry(i)})}setInitialCrop(){let t=_i(this.cfg.cropPreset);if(t){let[i]=t,s=this.uploadCollection.findItems(n=>{var o;return n.getValue("fileInfo")&&n.getValue("isImage")&&!((o=n.getValue("cdnUrlModifiers"))!=null&&o.includes("/crop/"))}).map(n=>this.uploadCollection.read(n));for(let n of s){let o=n.getValue("fileInfo"),{width:a,height:c}=o.imageInfo,h=i.width/i.height,d=dn(a,c,h),p=M(`crop/${d.width}x${d.height}/${d.x},${d.y}`,"preview");n.setMultipleValues({cdnUrlModifiers:p,cdnUrl:L(n.getValue("cdnUrl"),p)}),this.uploadCollection.size===1&&this.cfg.useCloudImageEditor&&this.hasBlockInCtx(f=>f.activityType===b.activities.CLOUD_IMG_EDIT)&&(this.$["*focusedEntry"]=n,this.$["*currentActivity"]=b.activities.CLOUD_IMG_EDIT)}}}async getMetadataFor(t){var s;let i=(s=this.cfg.metadata)!=null?s:this.$["*uploadMetadata"];if(typeof i=="function"){let n=this.getOutputItem(t);return await i(n)}return i}getUploadClientOptions(){return{store:this.cfg.store,publicKey:this.cfg.pubkey,baseCDN:this.cfg.cdnCname,baseURL:this.cfg.baseUrl,userAgent:fn,integration:this.cfg.userAgentIntegration,secureSignature:this.cfg.secureSignature,secureExpire:this.cfg.secureExpire,retryThrottledRequestMaxTimes:this.cfg.retryThrottledRequestMaxTimes,multipartMinFileSize:this.cfg.multipartMinFileSize,multipartChunkSize:this.cfg.multipartChunkSize,maxConcurrentRequests:this.cfg.multipartMaxConcurrentRequests,multipartMaxAttempts:this.cfg.multipartMaxAttempts,checkForUrlDuplicates:!!this.cfg.checkForUrlDuplicates,saveUrlForRecurrentUploads:!!this.cfg.saveUrlForRecurrentUploads}}getOutputItem(t){var o,a;let i=E.getCtx(t).store,s=i.fileInfo||{name:i.fileName,originalFilename:i.fileName,size:i.fileSize,isImage:i.isImage,mimeType:i.mimeType};return{...s,file:i.file,externalUrl:i.externalUrl,cdnUrlModifiers:i.cdnUrlModifiers,cdnUrl:(a=(o=i.cdnUrl)!=null?o:s.cdnUrl)!=null?a:null,validationErrorMessage:i.validationErrorMsg,uploadError:i.uploadError,isUploaded:!!i.uuid&&!!i.fileInfo,isValid:!i.validationErrorMsg&&!i.uploadError,fullPath:i.fullPath,uploadProgress:i.uploadProgress}}getOutputData(t){return(t?this.uploadCollection.findItems(t):this.uploadCollection.items()).map(n=>this.getOutputItem(n))}};l(Ae,"UploaderBlock");var T=Ae;T.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});T.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...T.extSrcList});var K={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};function Wl(r,e){if(typeof e=="number")return K[r]!==e?`${r}/${e}`:"";if(typeof e=="boolean")return e&&K[r]!==e?`${r}`:"";if(r==="filter"){if(!e||K[r]===e.amount)return"";let{name:t,amount:i}=e;return`${r}/${t}/${i}`}if(r==="crop"){if(!e)return"";let{dimensions:t,coords:i}=e;return`${r}/${t.join("x")}/${i.join(",")}`}return""}l(Wl,"transformationToStr");var $n=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function wt(r){return yi(...$n.filter(e=>typeof r[e]!="undefined"&&r[e]!==null).map(e=>{let t=r[e];return Wl(e,t)}).filter(e=>!!e))}l(wt,"transformationsToOperations");var wi=yi("format/auto","progressive/yes"),mt=l(([r])=>typeof r!="undefined"?Number(r):void 0,"asNumber"),An=l(()=>!0,"asBoolean"),Xl=l(([r,e])=>({name:r,amount:typeof e!="undefined"?Number(e):100}),"asFilter"),Gl=l(([r,e])=>({dimensions:N(r,"x").map(Number),coords:N(e).map(Number)}),"asCrop"),ql={enhance:mt,brightness:mt,exposure:mt,gamma:mt,contrast:mt,saturation:mt,vibrance:mt,warmth:mt,filter:Xl,mirror:An,flip:An,rotate:mt,crop:Gl};function Sn(r){let e={};for(let t of r){let[i,...s]=t.split("/");if(!$n.includes(i))continue;let n=ql[i],o=n(s);e[i]=o}return e}l(Sn,"operationsToTransformations");var R=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),X=[R.CROP,R.TUNING,R.FILTERS],In=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],On=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],kn=["rotate","mirror","flip"],nt=Object.freeze({brightness:{zero:K.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:K.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:K.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:K.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:K.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:K.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:K.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:K.enhance,range:[0,100],keypointsNumber:1},filter:{zero:K.filter,range:[0,100],keypointsNumber:1}});var Kl="https://ucarecdn.com",Yl="https://upload.uploadcare.com",Zl="https://social.uploadcare.com",Tt={pubkey:"",multiple:!0,multipleMin:0,multipleMax:0,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",store:"auto",cameraMirror:!1,sourceList:"local, url, camera, dropbox, gdrive",cloudImageEditorTabs:kt(X),maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:Kl,baseUrl:Yl,socialBaseUrl:Zl,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:1,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",metadata:null};var G=l(r=>String(r),"asString"),ot=l(r=>{let e=Number(r);if(Number.isNaN(e))throw new Error(`Invalid number: "${r}"`);return e},"asNumber"),k=l(r=>{if(typeof r=="undefined"||r===null)return!1;if(typeof r=="boolean")return r;if(r==="true"||r==="")return!0;if(r==="false")return!1;throw new Error(`Invalid boolean: "${r}"`)},"asBoolean"),Jl=l(r=>r==="auto"?r:k(r),"asStore"),Ql={pubkey:G,multiple:k,multipleMin:ot,multipleMax:ot,confirmUpload:k,imgOnly:k,accept:G,externalSourcesPreferredTypes:G,store:Jl,cameraMirror:k,sourceList:G,maxLocalFileSizeBytes:ot,thumbSize:ot,showEmptyList:k,useLocalImageEditor:k,useCloudImageEditor:k,cloudImageEditorTabs:G,removeCopyright:k,cropPreset:G,modalScrollLock:k,modalBackdropStrokes:k,sourceListWrap:k,remoteTabSessionKey:G,cdnCname:G,baseUrl:G,socialBaseUrl:G,secureSignature:G,secureExpire:G,secureDeliveryProxy:G,retryThrottledRequestMaxTimes:ot,multipartMinFileSize:ot,multipartChunkSize:ot,maxConcurrentRequests:ot,multipartMaxConcurrentRequests:ot,multipartMaxAttempts:ot,checkForUrlDuplicates:k,saveUrlForRecurrentUploads:k,groupOutput:k,userAgentIntegration:G},Ln=l((r,e)=>{if(!(typeof e=="undefined"||e===null))try{return Ql[r](e)}catch(t){return console.error(`Invalid value for config key "${r}".`,t),Tt[r]}},"normalizeConfigValue");var Ti=Object.keys(Tt),ta=["metadata"],ea=l(r=>ta.includes(r),"isComplexKey"),xi=Ti.filter(r=>!ea(r)),ia={...Object.fromEntries(xi.map(r=>[it(r),r])),...Object.fromEntries(xi.map(r=>[r.toLowerCase(),r]))},sa={...Object.fromEntries(Ti.map(r=>[it(r),W(r)])),...Object.fromEntries(Ti.map(r=>[r.toLowerCase(),W(r)]))},xs=class xs extends y{constructor(){super();u(this,"requireCtxName",!0);this.init$={...this.init$,...Object.fromEntries(Object.entries(Tt).map(([t,i])=>[W(t),i]))}}initCallback(){super.initCallback();let t=this;for(let i of xi)this.sub(W(i),s=>{s!==Tt[i]&&(t[i]=s)},!1);for(let i of Ti){let s="__"+i;t[s]=t[i],Object.defineProperty(this,i,{set:n=>{if(t[s]=n,xi.includes(i)){let o=[...new Set([it(i),i.toLowerCase()])];for(let a of o)typeof n=="undefined"||n===null?this.removeAttribute(a):this.setAttribute(a,n.toString())}this.$[W(i)]!==n&&(typeof n=="undefined"||n===null?this.$[W(i)]=Tt[i]:this.$[W(i)]=n)},get:()=>this.$[W(i)]}),typeof t[i]!="undefined"&&t[i]!==null&&(t[i]=t[s])}}attributeChangedCallback(t,i,s){if(i===s)return;let n=ia[t],o=Ln(n,s),a=o!=null?o:Tt[n],c=this;c[n]=a}};l(xs,"ConfigClass");var Ei=xs;Ei.bindAttributes(sa);var Rn=Ei;var Es=class Es extends y{constructor(){super(...arguments);u(this,"init$",{...this.init$,name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",t=>{if(!t)return;let i=this.getCssData(`--icon-${t}`);i&&(this.$.path=i)}),this.sub("path",t=>{if(!t)return;t.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=t):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${t}"></path>`)}),this.sub("size",t=>{this.$.viewBox=`0 0 ${t} ${t}`})}};l(Es,"Icon");var jt=Es;jt.template=`<svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>`;jt.bindAttributes({name:"name",size:"size"});var ra="https://ucarecdn.com",Ht=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:ra},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{},"cdn-operations":{},progressive:{},quality:{},"is-background-for":{}});var Un=l(r=>[...new Set(r)],"uniqueArray");var Pn=l(r=>Object.entries(r).filter(([e,t])=>t!==void 0&&t!=="").map(([e,t])=>e==="cdn-operations"?t:`${e}/${t}`),"parseObjectToString");var Wt="--lr-img-",As="unresolved";var $s=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),Ss=3e3,Is=5e3;var Nn=Object.create(null),Mn;for(let r in Ht)Nn[Wt+r]=((Mn=Ht[r])==null?void 0:Mn.default)||"";var Os=class Os extends St{constructor(){super(...arguments);u(this,"cssInit$",Nn)}$$(t){return this.$[Wt+t]}set$$(t){for(let i in t)this.$[Wt+i]=t[i]}sub$$(t,i){this.sub(Wt+t,s=>{s===null||s===""||i(s)})}initIntersection(t,i){let s={root:null,rootMargin:"0px"};this._isnObserver=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&(i(),this._isnObserver.unobserve(t))})},s),this._isnObserver.observe(t),this._observed||(this._observed=new Set),this._observed.add(t)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach(t=>{this._isnObserver.unobserve(t)}),this._isnObserver=null),E.deleteCtx(this)}static get observedAttributes(){return Object.keys(Ht)}attributeChangedCallback(t,i,s){window.setTimeout(()=>{this.$[Wt+t]=s})}};l(Os,"ImgConfig");var Ai=Os;var ks=class ks extends Ai{_fmtAbs(e){return!e.includes("//")&&!$s&&(e=new URL(e,document.baseURI).href),e}_validateSize(e){if(e.trim()!==""){let t=e.match(/\d+/)[0],i=e.match(/[a-zA-Z]+/)[0],s=parseInt(t,10);if(Number(s)>Is&&this.hasFormatJPG)return Is+i;if(Number(s)>Ss&&!this.hasFormatJPG)return Ss+i}return e}_getCdnModifiers(e,t){let i={format:this.$$("format"),quality:this.$$("quality"),resize:this._validateSize(e),blur:t,"cdn-operations":this.$$("cdn-operations")};return M(...Pn(i))}_getUrlBase(e=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if($s&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let t=this._getCdnModifiers(e);if(this.$$("src").startsWith(this.$$("cdn-cname")))return L(this.$$("src"),t);if(this.$$("cdn-cname")&&this.$$("uuid"))return this._proxyUrl(L(Ct(this.$$("cdn-cname"),this.$$("uuid")),t));if(this.$$("uuid"))return this._proxyUrl(L(Ct(this.$$("cdn-cname"),this.$$("uuid")),t));if(this.$$("proxy-cname"))return this._proxyUrl(L(this.$$("proxy-cname"),t,this._fmtAbs(this.$$("src"))));if(this.$$("pubkey"))return this._proxyUrl(L(`https://${this.$$("pubkey")}.ucr.io/`,t,this._fmtAbs(this.$$("src"))))}_proxyUrl(e){return this.$$("secure-delivery-proxy")?_e(this.$$("secure-delivery-proxy"),{previewUrl:e},{transform:i=>window.encodeURIComponent(i)}):e}_getElSize(e,t=1,i=!0){let s=e.getBoundingClientRect(),n=t*Math.round(s.width),o=i?"":t*Math.round(s.height);return n||o?`${n||""}x${o||""}`:null}_setupEventProxy(e){let t=l(s=>{s.stopPropagation();let n=new Event(s.type,s);this.dispatchEvent(n)},"proxifyEvent"),i=["load","error"];for(let s of i)e.addEventListener(s,t)}get img(){return this._img||(this._img=new Image,this._setupEventProxy(this.img),this._img.setAttribute(As,""),this.img.onload=()=>{this.img.removeAttribute(As)},this.initAttributes(),this.appendChild(this._img)),this._img}get bgSelector(){return this.$$("is-background-for")}initAttributes(){[...this.attributes].forEach(e=>{Ht[e.name]||this.img.setAttribute(e.name,e.value)})}get breakpoints(){if(this.$$("breakpoints")){let e=N(this.$$("breakpoints"));return Un(e.map(t=>parseInt(t,10)))}else return null}get hasFormatJPG(){return this.$$("format").toLowerCase()==="jpeg"}renderBg(e){let t=new Set;t.add(`url("${this._getUrlBase(this._getElSize(e))}") 1x`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,2))}") ${2}x`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,3))}") ${3}x`);let i=`image-set(${[...t].join(", ")})`;e.style.setProperty("background-image",i),e.style.setProperty("background-image","-webkit-"+i)}getSrcset(){let e=new Set;return this.breakpoints?this.breakpoints.forEach(t=>{e.add(this._getUrlBase(t+"x")+` ${this._validateSize(t+"w")}`),this.$$("hi-res-support")&&e.add(this._getUrlBase(t*2+"x")+` ${this._validateSize(t*2+"w")}`),this.$$("ultra-res-support")&&e.add(this._getUrlBase(t*3+"x")+` ${this._validateSize(t*3+"w")}`)}):(e.add(this._getUrlBase(this._getElSize(this.img))+" 1x"),this.$$("hi-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,2))+" 2x"),this.$$("ultra-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,3))+" 3x")),[...e].join()}getSrc(){return this._getUrlBase()}init(){this.bgSelector?[...document.querySelectorAll(this.bgSelector)].forEach(e=>{this.$$("intersection")?this.initIntersection(e,()=>{this.renderBg(e)}):this.renderBg(e)}):this.$$("intersection")?this.initIntersection(this.img,()=>{this.img.srcset=this.getSrcset(),this.img.src=this.getSrc()}):(this.img.srcset=this.getSrcset(),this.img.src=this.getSrc())}};l(ks,"ImgBase");var Ii=ks;var Ls=class Ls extends Ii{initCallback(){super.initCallback(),this.sub$$("src",()=>{this.init()}),this.sub$$("uuid",()=>{this.init()}),this.sub$$("lazy",e=>{this.$$("is-background-for")||(this.img.loading=e?"lazy":"eager")})}};l(Ls,"Img");var Oi=Ls;var Rs=class Rs extends T{constructor(){super();u(this,"couldBeCtxOwner",!0);this.init$={...this.init$,"*simpleButtonText":"",withDropZone:!0,onClick:()=>{this.initFlow()}}}initCallback(){super.initCallback(),this.defineAccessor("dropzone",t=>{typeof t!="undefined"&&(this.$.withDropZone=k(t))}),this.subConfigValue("multiple",t=>{this.$["*simpleButtonText"]=t?this.l10n("upload-files"):this.l10n("upload-file")})}};l(Rs,"SimpleBtn");var Xt=Rs;Xt.template=`<lr-drop-area set="@disabled: !withDropZone"><button type="button" set="onclick: onClick"><lr-icon name="upload"></lr-icon><span>{{*simpleButtonText}}</span><slot></slot><div class="visual-drop-area"></div></button></lr-drop-area>`;Xt.bindAttributes({dropzone:null});var Us=class Us extends b{constructor(){super(...arguments);u(this,"historyTracked",!0);u(this,"activityType","start-from")}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}};l(Us,"StartFrom");var $e=Us;$e.template='<div class="content"><slot></slot></div>';function na(r){return new Promise(e=>{typeof window.FileReader!="function"&&e(!1);try{let t=new FileReader;t.onerror=()=>{e(!0)};let i=l(s=>{s.type!=="loadend"&&t.abort(),e(!1)},"onLoad");t.onloadend=i,t.onprogress=i,t.readAsDataURL(r)}catch{e(!1)}})}l(na,"checkIsDirectory");function oa(r,e){return new Promise(t=>{let i=0,s=[],n=l(a=>{a||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),t(null)),a.isFile?(i++,a.file(c=>{i--;let h=new File([c],c.name,{type:c.type||e});s.push({type:"file",file:h,fullPath:a.fullPath}),i===0&&t(s)})):a.isDirectory&&o(a.createReader())},"readEntry"),o=l(a=>{i++,a.readEntries(c=>{i--;for(let h of c)n(h);i===0&&t(s)})},"readReaderContent");n(r)})}l(oa,"readEntryContentAsync");function Dn(r){let e=[],t=[];for(let i=0;i<r.items.length;i++){let s=r.items[i];if(s)if(s.kind==="file"){let n=s.type;if(typeof s.webkitGetAsEntry=="function"||typeof s.getAsEntry=="function"){let a=typeof s.webkitGetAsEntry=="function"?s.webkitGetAsEntry():s.getAsEntry();t.push(oa(a,n).then(c=>{c&&e.push(...c)}));continue}let o=s.getAsFile();o&&t.push(na(o).then(a=>{a||e.push({type:"file",file:o})}))}else s.kind==="string"&&s.type.match("^text/uri-list")&&t.push(new Promise(n=>{s.getAsString(o=>{e.push({type:"url",url:o}),n(void 0)})}))}return Promise.all(t).then(()=>e)}l(Dn,"getDropItems");var V={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3},Fn=["focus"],la=100,Ps=new Map;function aa(r,e){let t=Math.max(Math.min(r[0],e.x+e.width),e.x),i=Math.max(Math.min(r[1],e.y+e.height),e.y);return Math.sqrt((r[0]-t)*(r[0]-t)+(r[1]-i)*(r[1]-i))}l(aa,"distance");function Ms(r){let e=0,t=document.body,i=new Set,s=l(m=>i.add(m),"handleSwitch"),n=V.INACTIVE,o=l(m=>{r.shouldIgnore()&&m!==V.INACTIVE||(n!==m&&i.forEach(_=>_(m)),n=m)},"setState"),a=l(()=>e>0,"isDragging");s(m=>r.onChange(m));let c=l(()=>{e=0,o(V.INACTIVE)},"onResetEvent"),h=l(()=>{e+=1,n===V.INACTIVE&&o(V.ACTIVE)},"onDragEnter"),d=l(()=>{e-=1,a()||o(V.INACTIVE)},"onDragLeave"),p=l(m=>{m.preventDefault(),e=0,o(V.INACTIVE)},"onDrop"),f=l(m=>{if(r.shouldIgnore())return;a()||(e+=1);let _=[m.x,m.y],S=r.element.getBoundingClientRect(),A=Math.floor(aa(_,S)),x=A<la,w=m.composedPath().includes(r.element);Ps.set(r.element,A);let z=Math.min(...Ps.values())===A;w&&z?(m.preventDefault(),o(V.OVER)):o(x&&z?V.NEAR:V.ACTIVE)},"onDragOver"),g=l(async m=>{if(r.shouldIgnore())return;m.preventDefault();let _=await Dn(m.dataTransfer);r.onItems(_),o(V.INACTIVE)},"onElementDrop");return t.addEventListener("drop",p),t.addEventListener("dragleave",d),t.addEventListener("dragenter",h),t.addEventListener("dragover",f),r.element.addEventListener("drop",g),Fn.forEach(m=>{window.addEventListener(m,c)}),()=>{Ps.delete(r.element),t.removeEventListener("drop",p),t.removeEventListener("dragleave",d),t.removeEventListener("dragenter",h),t.removeEventListener("dragover",f),r.element.removeEventListener("drop",g),Fn.forEach(m=>{window.removeEventListener(m,c)})}}l(Ms,"addDropzone");var Vn="lr-drop-area",Gt=`${Vn}/registry`,Ns=class Ns extends T{constructor(){super(),this.init$={...this.init$,state:V.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isEnabled:!0,isVisible:!0,text:this.l10n("drop-files-here"),[Gt]:null}}isActive(){if(!this.$.isEnabled)return!1;let e=this.getBoundingClientRect(),t=e.width>0&&e.height>0,i=e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth),s=window.getComputedStyle(this),n=s.visibility!=="hidden"&&s.display!=="none";return t&&n&&i}initCallback(){super.initCallback(),this.$[Gt]||(this.$[Gt]=new Set),this.$[Gt].add(this),this.defineAccessor("disabled",t=>{this.set$({isEnabled:!k(t)})}),this.defineAccessor("clickable",t=>{this.set$({isClickable:k(t)})}),this.defineAccessor("with-icon",t=>{this.set$({withIcon:k(t)})}),this.defineAccessor("fullscreen",t=>{this.set$({isFullscreen:k(t)})}),this.defineAccessor("text",t=>{typeof t=="string"?this.set$({text:this.l10n(t)||t}):this.set$({text:this.l10n("drop-files-here")})}),this._destroyDropzone=Ms({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:t=>{this.$.state=t},onItems:t=>{t.length&&(t.forEach(i=>{i.type==="url"?this.addFileFromUrl(i.url,{source:Q.DROP_AREA}):i.type==="file"&&this.addFileFromObject(i.file,{source:Q.DROP_AREA,fullPath:i.fullPath})}),this.uploadCollection.size&&(this.set$({"*currentActivity":b.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0)))}});let e=this.ref["content-wrapper"];e&&(this._destroyContentWrapperDropzone=Ms({element:e,onChange:t=>{var s;let i=(s=Object.entries(V).find(([,n])=>n===t))==null?void 0:s[0].toLowerCase();i&&e.setAttribute("drag-state",i)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",t=>{var s;let i=(s=Object.entries(V).find(([,n])=>n===t))==null?void 0:s[0].toLowerCase();i&&this.setAttribute("drag-state",i)}),this.subConfigValue("sourceList",t=>{let i=N(t);this.$.isEnabled=i.includes(T.sourceTypes.LOCAL),this.$.isVisible=this.$.isEnabled||!this.querySelector("[data-default-slot]")}),this.sub("isVisible",t=>{this.toggleAttribute("hidden",!t)}),this.sub("isClickable",t=>{this.toggleAttribute("clickable",t)}),this.$.isClickable&&(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return!this.$.isEnabled||!this._couldHandleFiles()?!0:this.$.isFullscreen?[...this.$[Gt]].filter(i=>i!==this).filter(i=>i.isActive()).length>0:!1}_couldHandleFiles(){let e=this.cfg.multiple,t=this.cfg.multipleMax,i=this.uploadCollection.size;return!(e&&t&&i>=t||!e&&i>0)}destroyCallback(){var t,i;super.destroyCallback();let e=this.$[Gt];e&&(e.delete(this),e.size===0&&E.deleteCtx(Vn)),(t=this._destroyDropzone)==null||t.call(this),(i=this._destroyContentWrapperDropzone)==null||i.call(this),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}};l(Ns,"DropArea");var qt=Ns;qt.template=`<slot><div data-default-slot hidden></div><div ref="content-wrapper" class="content-wrapper" set="@hidden: !isVisible"><div class="icon-container" set="@hidden: !withIcon"><lr-icon name="default"></lr-icon><lr-icon name="arrow-down"></lr-icon></div><span class="text">{{text}}</span></div></slot>`;qt.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null});var ca="src-type-",Ds=class Ds extends T{constructor(){super(...arguments);u(this,"couldBeCtxOwner",!0);u(this,"_registeredTypes",{});u(this,"init$",{...this.init$,iconName:"default"})}initTypes(){this.registerType({type:T.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:T.sourceTypes.URL,activity:b.activities.URL,textKey:"from-url"}),this.registerType({type:T.sourceTypes.CAMERA,activity:b.activities.CAMERA,onClick:()=>{var i=document.createElement("input").capture!==void 0;return i&&this.openSystemDialog({captureCamera:!0}),!i}}),this.registerType({type:"draw",activity:b.activities.DRAW,icon:"edit-draw"});for(let t of Object.values(T.extSrcList))this.registerType({type:t,activity:b.activities.EXTERNAL,activityParams:{externalSourceType:t}})}initCallback(){super.initCallback(),this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",t=>{t&&this.applyType(t)})}registerType(t){this._registeredTypes[t.type]=t}getType(t){return this._registeredTypes[t]}applyType(t){let i=this._registeredTypes[t];if(!i){console.warn("Unsupported source type: "+t);return}let{textKey:s=t,icon:n=t,activity:o,onClick:a,activityParams:c={}}=i;this.applyL10nKey("src-type",`${ca}${s}`),this.$.iconName=n,this.onclick=h=>{(a?a(h):!!o)&&this.set$({"*currentActivityParams":c,"*currentActivity":o})}}};l(Ds,"SourceBtn");var Kt=Ds;Kt.template=`<lr-icon set="@name: iconName"></lr-icon><div class="txt" l10n="src-type"></div>`;Kt.bindAttributes({type:null});var Fs=class Fs extends y{initCallback(){super.initCallback(),this.subConfigValue("sourceList",e=>{let t=N(e),i="";t.forEach(s=>{i+=`<lr-source-btn type="${s}"></lr-source-btn>`}),this.cfg.sourceListWrap?this.innerHTML=i:this.outerHTML=i})}};l(Fs,"SourceList");var ki=Fs;function Bn(r){let e=new Blob([r],{type:"image/svg+xml"});return URL.createObjectURL(e)}l(Bn,"createSvgBlobUrl");function zn(r="#fff",e="rgba(0, 0, 0, .1)"){return Bn(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="20" height="20" fill="${r}" /><rect x="0" y="0" width="10" height="10" fill="${e}" /><rect x="10" y="10" width="10" height="10" fill="${e}" /></svg>`)}l(zn,"checkerboardCssBg");function Se(r="hsl(209, 21%, 65%)",e=32,t=32){return Bn(`<svg width="${e}" height="${t}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" fill="${r}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/></svg>`)}l(Se,"fileCssBg");function jn(r,e=40){if(r.type==="image/svg+xml")return URL.createObjectURL(r);let t=document.createElement("canvas"),i=t.getContext("2d"),s=new Image,n=new Promise((o,a)=>{s.onload=()=>{let c=s.height/s.width;c>1?(t.width=e,t.height=e*c):(t.height=e,t.width=e/c),i.fillStyle="rgb(240, 240, 240)",i.fillRect(0,0,t.width,t.height),i.drawImage(s,0,0,t.width,t.height),t.toBlob(h=>{if(!h){a();return}let d=URL.createObjectURL(h);o(d)})},s.onerror=c=>{a(c)}});return s.src=URL.createObjectURL(r),n}l(jn,"generateThumb");var B=Object.freeze({FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3),LIMIT_OVERFLOW:Symbol(4)}),Yt=class Yt extends T{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"pauseRender",!0);u(this,"_entrySubs",new Set);u(this,"_entry",null);u(this,"_isIntersecting",!1);u(this,"_debouncedGenerateThumb",O(this._generateThumbnail.bind(this),100));u(this,"_debouncedCalculateState",O(this._calculateState.bind(this),100));u(this,"_renderedOnce",!1);this.init$={...this.init$,uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,progressVisible:!1,progressUnknown:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,isLimitOverflow:!1,state:B.IDLE,"*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this._entry}),this.hasBlockInCtx(t=>t.activityType===b.activities.DETAILS)?this.$["*currentActivity"]=b.activities.DETAILS:this.$["*currentActivity"]=b.activities.CLOUD_IMG_EDIT},onRemove:()=>{let t=this._entry.getValue("uuid");if(t){let i=this.getOutputData(s=>s.getValue("uuid")===t);this.emit(I.REMOVE,i,{debounce:!0})}this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}}}_reset(){for(let t of this._entrySubs)t.remove();this._debouncedGenerateThumb.cancel(),this._debouncedCalculateState.cancel(),this._entrySubs=new Set,this._entry=null}_observerCallback(t){let[i]=t;this._isIntersecting=i.isIntersecting,i.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),i.intersectionRatio===0?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){if(!this._entry)return;let t=this._entry,i=B.IDLE;t.getValue("uploadError")||t.getValue("validationErrorMsg")?i=B.FAILED:t.getValue("validationMultipleLimitMsg")?i=B.LIMIT_OVERFLOW:t.getValue("isUploading")?i=B.UPLOADING:t.getValue("fileInfo")&&(i=B.FINISHED),this.$.state=i}async _generateThumbnail(){var i;if(!this._entry)return;let t=this._entry;if(t.getValue("fileInfo")&&t.getValue("isImage")){let s=this.cfg.thumbSize,n=this.proxyUrl(L(Ct(this.cfg.cdnCname,this._entry.getValue("uuid")),M(t.getValue("cdnUrlModifiers"),`scale_crop/${s}x${s}/center`))),o=t.getValue("thumbUrl");o!==n&&(t.setValue("thumbUrl",n),o!=null&&o.startsWith("blob:")&&URL.revokeObjectURL(o));return}if(!t.getValue("thumbUrl"))if((i=t.getValue("file"))!=null&&i.type.includes("image"))try{let s=await jn(t.getValue("file"),this.cfg.thumbSize);t.setValue("thumbUrl",s)}catch{let n=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",Se(n))}else{let s=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",Se(s))}}_subEntry(t,i){let s=this._entry.subscribe(t,n=>{this.isConnected&&i(n)});this._entrySubs.add(s)}_handleEntryId(t){var s;this._reset();let i=(s=this.uploadCollection)==null?void 0:s.read(t);this._entry=i,i&&(this._subEntry("uploadProgress",n=>{this.$.progressValue=n}),this._subEntry("fileName",n=>{this.$.itemName=n||i.getValue("externalUrl")||this.l10n("file-no-name"),this._debouncedCalculateState()}),this._subEntry("externalUrl",n=>{this.$.itemName=i.getValue("fileName")||n||this.l10n("file-no-name")}),this._subEntry("uuid",n=>{this._debouncedCalculateState(),n&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",n=>{this.$.thumbUrl=n?`url(${n})`:""}),this._subEntry("validationMultipleLimitMsg",()=>this._debouncedCalculateState()),this._subEntry("validationErrorMsg",()=>this._debouncedCalculateState()),this._subEntry("uploadError",()=>this._debouncedCalculateState()),this._subEntry("isUploading",()=>this._debouncedCalculateState()),this._subEntry("fileSize",()=>this._debouncedCalculateState()),this._subEntry("mimeType",()=>this._debouncedCalculateState()),this._subEntry("isImage",()=>this._debouncedCalculateState()),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",t=>{this._handleEntryId(t)}),this.sub("state",t=>{this._handleState(t)}),this.subConfigValue("useCloudImageEditor",()=>this._debouncedCalculateState()),this.onclick=()=>{Yt.activeInstances.forEach(t=>{t===this?t.setAttribute("focused",""):t.removeAttribute("focused")})},this.$["*uploadTrigger"]=null,this.sub("*uploadTrigger",t=>{t&&setTimeout(()=>this.isConnected&&this.upload())}),Yt.activeInstances.add(this)}_handleState(t){var i,s,n;this.set$({isFailed:t===B.FAILED,isLimitOverflow:t===B.LIMIT_OVERFLOW,isUploading:t===B.UPLOADING,isFinished:t===B.FINISHED,progressVisible:t===B.UPLOADING,isEditable:this.cfg.useCloudImageEditor&&((i=this._entry)==null?void 0:i.getValue("isImage"))&&((s=this._entry)==null?void 0:s.getValue("cdnUrl")),errorText:((n=this._entry.getValue("uploadError"))==null?void 0:n.message)||this._entry.getValue("validationErrorMsg")||this._entry.getValue("validationMultipleLimitMsg")}),t===B.FAILED||t===B.LIMIT_OVERFLOW?this.$.badgeIcon="badge-error":t===B.FINISHED&&(this.$.badgeIcon="badge-success"),t===B.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0}destroyCallback(){super.destroyCallback(),Yt.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){var t;super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),(t=this._observer)==null||t.disconnect()}async upload(){var n,o,a;let t=this._entry;if(!this.uploadCollection.read(t.uid)||t.getValue("fileInfo")||t.getValue("isUploading")||t.getValue("uploadError")||t.getValue("validationErrorMsg")||t.getValue("validationMultipleLimitMsg"))return;let i=this.cfg.multiple?this.cfg.multipleMax:1;if(i&&this.uploadCollection.size>i)return;let s=this.getOutputData(c=>!c.getValue("fileInfo"));this.emit(I.UPLOAD_START,s,{debounce:!0}),this._debouncedCalculateState(),t.setValue("isUploading",!0),t.setValue("uploadError",null),t.setValue("validationErrorMsg",null),t.setValue("validationMultipleLimitMsg",null),!t.getValue("file")&&t.getValue("externalUrl")&&(this.$.progressUnknown=!0);try{let c=new AbortController;t.setValue("abortController",c);let h=l(async()=>{let p=this.getUploadClientOptions();return as(t.getValue("file")||t.getValue("externalUrl")||t.getValue("uuid"),{...p,fileName:t.getValue("fileName"),source:t.getValue("source"),onProgress:f=>{if(f.isComputable){let g=f.value*100;t.setValue("uploadProgress",g)}this.$.progressUnknown=!f.isComputable},signal:c.signal,metadata:await this.getMetadataFor(t.uid)})},"uploadTask"),d=await this.$["*uploadQueue"].add(h);t.setMultipleValues({fileInfo:d,isUploading:!1,fileName:d.originalFilename,fileSize:d.size,isImage:d.isImage,mimeType:(a=(o=(n=d.contentInfo)==null?void 0:n.mime)==null?void 0:o.mime)!=null?a:d.mimeType,uuid:d.uuid,cdnUrl:d.cdnUrl}),t===this._entry&&this._debouncedCalculateState()}catch(c){console.warn("Upload error",c),t.setMultipleValues({abortController:null,isUploading:!1,uploadProgress:0}),t===this._entry&&this._debouncedCalculateState(),c instanceof F?c.isCancel||t.setValue("uploadError",c):t.setValue("uploadError",new Error("Unexpected error"))}}};l(Yt,"FileItem");var Zt=Yt;Zt.template=`<div class="inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @limit-overflow: isLimitOverflow; @focused: isFocused" ><div class="thumb" set="style.backgroundImage: thumbUrl"><div class="badge"><lr-icon set="@name: badgeIcon"></lr-icon></div></div><div class="file-name-wrapper"><span class="file-name" set="@title: itemName">{{itemName}}</span><span class="file-error" set="@hidden: !errorText">{{errorText}}</span></div><div class="file-actions"><button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable"><lr-icon name="edit-file"></lr-icon></button><button type="button" class="remove-btn mini-btn" set="onclick: onRemove;"><lr-icon name="remove-file"></lr-icon></button><button type="button" class="upload-btn mini-btn" set="onclick: onUpload;"><lr-icon name="upload"></lr-icon></button></div><lr-progress-bar class="progress-bar" set="value: progressValue; visible: progressVisible; unknown: progressUnknown" ></lr-progress-bar></div>`;Zt.activeInstances=new Set;var Li=class Li extends y{constructor(){super();u(this,"_handleBackdropClick",l(()=>{this._closeDialog()},"_handleBackdropClick"));u(this,"_closeDialog",l(()=>{this.setOrAddState("*modalActive",!1)},"_closeDialog"));u(this,"_handleDialogClose",l(()=>{this._closeDialog()},"_handleDialogClose"));u(this,"_handleDialogMouseDown",l(t=>{this._mouseDownTarget=t.target},"_handleDialogMouseDown"));u(this,"_handleDialogMouseUp",l(t=>{t.target===this.ref.dialog&&t.target===this._mouseDownTarget&&this._closeDialog()},"_handleDialogMouseUp"));this.init$={...this.init$,"*modalActive":!1,isOpen:!1,closeClicked:this._handleDialogClose}}show(){this.ref.dialog.showModal?this.ref.dialog.showModal():this.ref.dialog.setAttribute("open","")}hide(){this.ref.dialog.close?this.ref.dialog.close():this.ref.dialog.removeAttribute("open")}initCallback(){if(super.initCallback(),typeof HTMLDialogElement=="function")this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.addEventListener("mouseup",this._handleDialogMouseUp);else{this.setAttribute("dialog-fallback","");let t=document.createElement("div");t.className="backdrop",this.appendChild(t),t.addEventListener("click",this._handleBackdropClick)}this.sub("*modalActive",t=>{this.$.isOpen!==t&&(this.$.isOpen=t),t&&this.cfg.modalScrollLock?document.body.style.overflow="hidden":document.body.style.overflow=""}),this.subConfigValue("modalBackdropStrokes",t=>{t?this.setAttribute("strokes",""):this.removeAttribute("strokes")}),this.sub("isOpen",t=>{t?this.show():this.hide()})}destroyCallback(){super.destroyCallback(),document.body.style.overflow="",this._mouseDownTarget=void 0,this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.removeEventListener("mouseup",this._handleDialogMouseUp)}};l(Li,"Modal"),u(Li,"StateConsumerScope","modal");var Ie=Li;Ie.template=`<dialog ref="dialog"><slot></slot></dialog>`;var Vs=class Vs{constructor(){u(this,"caption","");u(this,"text","");u(this,"iconName","");u(this,"isError",!1)}};l(Vs,"UiMessage");var Ri=Vs,Bs=class Bs extends y{constructor(){super(...arguments);u(this,"init$",{...this.init$,iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}})}initCallback(){super.initCallback(),this.sub("*message",t=>{t?(this.setAttribute("active",""),this.set$({captionTxt:t.caption||"",msgTxt:t.text||"",iconName:t.isError?"error":"info"}),t.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")})}};l(Bs,"MessageBox");var Oe=Bs;Oe.template=`<div class="heading"><lr-icon set="@name: iconName"></lr-icon><div class="caption">{{captionTxt}}</div><button type="button" set="onclick: onClose"><lr-icon name="close"></lr-icon></button></div><div class="msg">{{msgTxt}}</div>`;var zs=class zs extends T{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"historyTracked",!0);u(this,"activityType",b.activities.UPLOAD_LIST);u(this,"_debouncedHandleCollectionUpdate",O(()=>{this.isConnected&&(this._updateUploadsState(),this._updateCountLimitMessage(),!this.couldOpenActivity&&this.$["*currentActivity"]===this.activityType&&this.historyBack())},0));this.init$={...this.init$,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.uploadAll(),this._updateUploadsState()},onDone:()=>{this.doneFlow()},onCancel:()=>{let t=this.getOutputData(i=>!!i.getValue("fileInfo"));this.emit(I.REMOVE,t,{debounce:!0}),this.uploadCollection.clearAll()}}}_validateFilesCount(){var d,p;let t=!!this.cfg.multiple,i=t?(d=this.cfg.multipleMin)!=null?d:0:1,s=t?(p=this.cfg.multipleMax)!=null?p:0:1,n=this.uploadCollection.size,o=i?n<i:!1,a=s?n>s:!1;return{passed:!o&&!a,tooFew:o,tooMany:a,min:i,max:s,exact:s===n}}_updateCountLimitMessage(){let t=this.uploadCollection.size,i=this._validateFilesCount();if(t&&!i.passed){let s=new Ri,n=i.tooFew?"files-count-limit-error-too-few":"files-count-limit-error-too-many";s.caption=this.l10n("files-count-limit-error-title"),s.text=this.l10n(n,{min:i.min,max:i.max,total:t}),s.isError=!0,this.set$({"*message":s})}else this.set$({"*message":null})}_updateUploadsState(){let t=this.uploadCollection.items(),s={total:t.length,succeed:0,uploading:0,failed:0,limitOverflow:0};for(let g of t){let m=this.uploadCollection.read(g);m.getValue("fileInfo")&&!m.getValue("validationErrorMsg")&&(s.succeed+=1),m.getValue("isUploading")&&(s.uploading+=1),(m.getValue("validationErrorMsg")||m.getValue("uploadError"))&&(s.failed+=1),m.getValue("validationMultipleLimitMsg")&&(s.limitOverflow+=1)}let{passed:n,tooMany:o,exact:a}=this._validateFilesCount(),c=s.failed===0&&s.limitOverflow===0,h=!1,d=!1,p=!1;s.total-s.succeed-s.uploading-s.failed>0&&n?h=!0:(d=!0,p=s.total===s.succeed&&n&&c),this.set$({doneBtnVisible:d,doneBtnEnabled:p,uploadBtnVisible:h,addMoreBtnEnabled:s.total===0||!o&&!a,addMoreBtnVisible:!a||this.cfg.multiple,headerText:this._getHeaderText(s)})}_getHeaderText(t){let i=l(s=>{let n=t[s];return this.l10n(`header-${s}`,{count:n})},"localizedText");return t.uploading>0?i("uploading"):t.failed>0?i("failed"):t.succeed>0?i("succeed"):i("total")}get couldOpenActivity(){return this.cfg.showEmptyList||this.uploadCollection.size>0}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.subConfigValue("multiple",this._debouncedHandleCollectionUpdate),this.subConfigValue("multipleMin",this._debouncedHandleCollectionUpdate),this.subConfigValue("multipleMax",this._debouncedHandleCollectionUpdate),this.sub("*currentActivity",t=>{!this.couldOpenActivity&&t===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observeProperties(this._debouncedHandleCollectionUpdate),this.sub("*uploadList",t=>{this._debouncedHandleCollectionUpdate(),this.set$({hasFiles:t.length>0}),this.cfg.confirmUpload||this.add$({"*uploadTrigger":{}},!0)})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._debouncedHandleCollectionUpdate)}};l(zs,"UploadList");var ke=zs;ke.template=`<lr-activity-header><span class="header-text">{{headerText}}</span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="no-files" set="@hidden: hasFiles"><slot name="empty"><span l10n="no-files"></span></slot></div><div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item"></div><div class="toolbar"><button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button><div class="toolbar-spacer"></div><button type="button" class="add-more-btn secondary-btn" set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible" ><lr-icon name="add"></lr-icon><span l10n="add-more"></span></button><button type="button" class="upload-btn primary-btn" set="@hidden: !uploadBtnVisible; onclick: onUpload;" l10n="upload" ></button><button type="button" class="done-btn primary-btn" set="@hidden: !doneBtnVisible; onclick: onDone; @disabled: !doneBtnEnabled" l10n="done" ></button></div><lr-drop-area ghost></lr-drop-area>`;var js=class js extends T{constructor(){super(...arguments);u(this,"couldBeCtxOwner",!0);u(this,"activityType",b.activities.URL);u(this,"init$",{...this.init$,importDisabled:!0,onUpload:t=>{t.preventDefault();let i=this.ref.input.value;this.addFileFromUrl(i,{source:Q.URL_TAB}),this.$["*currentActivity"]=b.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:t=>{let i=t.target.value;this.set$({importDisabled:!i})}})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.ref.input.value="",this.ref.input.focus()}})}};l(js,"UrlSource");var Le=js;Le.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div><lr-icon name="url"></lr-icon><span l10n="caption-from-url"></span></div><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><form class="content"><input placeholder="https://" class="url-input" type="text" ref="input" set="oninput: onInput" /><button type="submit" class="url-upload-btn primary-btn" set="onclick: onUpload; @disabled: importDisabled" ></button></form>`;var Hs=l(()=>typeof navigator.permissions!="undefined","canUsePermissionsApi");var Ws=class Ws extends T{constructor(){super(...arguments);u(this,"couldBeCtxOwner",!0);u(this,"activityType",b.activities.CAMERA);u(this,"_unsubPermissions",null);u(this,"init$",{...this.init$,video:null,videoTransformCss:null,shotBtnDisabled:!0,videoHidden:!0,messageHidden:!0,requestBtnHidden:Hs(),l10nMessage:null,originalErrorMessage:null,cameraSelectOptions:null,cameraSelectHidden:!0,onCameraSelectChange:t=>{this._selectedCameraId=t.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}});u(this,"_onActivate",l(()=>{Hs()&&this._subscribePermissions(),this._capture()},"_onActivate"));u(this,"_onDeactivate",l(()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()},"_onDeactivate"));u(this,"_handlePermissionsChange",l(()=>{this._capture()},"_handlePermissionsChange"));u(this,"_setPermissionsState",O(t=>{this.$.originalErrorMessage=null,this.classList.toggle("initialized",t==="granted"),t==="granted"?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):t==="prompt"?(this.$.l10nMessage=this.l10n("camera-permissions-prompt"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage=this.l10n("camera-permissions-denied"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())},300))}async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(t){console.log("Failed to use permissions API. Fallback to manual request mode.",t),this._capture()}}async _capture(){let t={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._selectedCameraId&&(t.video.deviceId={exact:this._selectedCameraId}),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let i=await navigator.mediaDevices.getUserMedia(t);i.addEventListener("inactive",()=>{this._setPermissionsState("denied")}),this.$.video=i,this._capturing=!0,this._setPermissionsState("granted")}catch(i){this._setPermissionsState("denied"),this.$.originalErrorMessage=i.message}}_stopCapture(){var t;this._capturing&&((t=this.$.video)==null||t.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let t=Date.now(),i=`camera-${t}.png`;this._canvas.toBlob(s=>{let n=new File([s],i,{lastModified:t,type:"image/png"});this.addFileFromObject(n,{source:Q.CAMERA}),this.set$({"*currentActivity":b.activities.UPLOAD_LIST})})}async initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.subConfigValue("cameraMirror",t=>{this.$.videoTransformCss=t?"scaleX(-1)":null});try{let i=(await navigator.mediaDevices.enumerateDevices()).filter(s=>s.kind==="videoinput").map((s,n)=>({text:s.label.trim()||`${this.l10n("caption-camera")} ${n+1}`,value:s.deviceId}));i.length>1&&(this.$.cameraSelectOptions=i,this.$.cameraSelectHidden=!1)}catch{}}};l(Ws,"CameraSource");var Re=Ws;Re.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div set="@hidden: !cameraSelectHidden"><lr-icon name="camera"></lr-icon><span l10n="caption-camera"></span></div><lr-select class="camera-select" set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange" ></lr-select><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><video autoplay playsinline set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden" ref="video" ></video><div class="message-box" set="@hidden: messageHidden"><span>{{l10nMessage}}</span><span>{{originalErrorMessage}}</span><button type="button" set="onclick: onRequestPermissions; @hidden: requestBtnHidden" l10n="camera-permissions-request" ></button></div><button type="button" class="shot-btn" set="onclick: onShot; @disabled: shotBtnDisabled"><lr-icon name="camera"></lr-icon></button></div>`;var Gs=class Gs extends T{constructor(){super(...arguments);u(this,"requireCtxName",!0)}initCallback(){super.initCallback(),this.$["*eventEmitter"].bindTarget(this)}destroyCallback(){super.destroyCallback(),this.$["*eventEmitter"].unbindTarget(this)}};l(Gs,"UploadCtxProviderClass");var Xs=Gs,Hn=Xs;var qs=class qs extends T{constructor(){super(...arguments);u(this,"activityType",b.activities.DETAILS);u(this,"pauseRender",!0);u(this,"init$",{...this.init$,checkerboard:!1,fileSize:null,fileName:"",cdnUrl:"",errorTxt:"",cloudEditBtnHidden:!0,onNameInput:null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.uid),this.historyBack()},onCloudEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=b.activities.CLOUD_IMG_EDIT)}})}showNonImageThumb(){let t=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),i=Se(t,108,108);this.ref.filePreview.setImageUrl(i),this.set$({checkerboard:!1})}initCallback(){super.initCallback(),this.render(),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,{onDeactivate:()=>{this.ref.filePreview.clear()}}),this.sub("*focusedEntry",t=>{if(!t)return;this._entrySubs?this._entrySubs.forEach(n=>{this._entrySubs.delete(n),n.remove()}):this._entrySubs=new Set,this.entry=t;let i=t.getValue("file");if(i){this._file=i;let n=xe(this._file);n&&!t.getValue("cdnUrl")&&(this.ref.filePreview.setImageFile(this._file),this.set$({checkerboard:!0})),n||this.showNonImageThumb()}let s=l((n,o)=>{this._entrySubs.add(this.entry.subscribe(n,o))},"tmpSub");s("fileName",n=>{this.$.fileName=n,this.$.onNameInput=()=>{let o=this.ref.file_name_input.value;Object.defineProperty(this._file,"name",{writable:!0,value:o}),this.entry.setValue("fileName",o)}}),s("fileSize",n=>{this.$.fileSize=Number.isFinite(n)?this.fileSizeFmt(n):this.l10n("file-size-unknown")}),s("uploadError",n=>{this.$.errorTxt=n==null?void 0:n.message}),s("externalUrl",n=>{n&&(this.entry.getValue("uuid")||this.showNonImageThumb())}),s("cdnUrl",n=>{let o=this.cfg.useCloudImageEditor&&n&&this.entry.getValue("isImage");if(n&&this.ref.filePreview.clear(),this.set$({cdnUrl:n,cloudEditBtnHidden:!o}),n&&this.entry.getValue("isImage")){let a=L(n,M("format/auto","preview"));this.ref.filePreview.setImageUrl(this.proxyUrl(a))}})})}};l(qs,"UploadDetails");var Ue=qs;Ue.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><span l10n="caption-edit-file"></span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><lr-tabs tab-list="tab-view, tab-details"><div tab-ctx="tab-details" class="details"><div class="info-block"><div class="info-block_name" l10n="file-name"></div><input name="name-input" ref="file_name_input" set="value: fileName; oninput: onNameInput; @disabled: !!cdnUrl" type="text" /></div><div class="info-block"><div class="info-block_name" l10n="file-size"></div><div>{{fileSize}}</div></div><div class="info-block"><div class="info-block_name" l10n="cdn-url"></div><a class="cdn-link" target="_blank" set="@href: cdnUrl; @disabled: !cdnUrl">{{cdnUrl}}</a></div><div>{{errorTxt}}</div></div><lr-file-preview tab-ctx="tab-view" set="@checkerboard: checkerboard;" ref="filePreview"></lr-file-preview></lr-tabs><div class="toolbar" set="@edit-disabled: cloudEditBtnHidden"><button type="button" class="edit-btn secondary-btn" set="onclick: onCloudEdit; @hidden: cloudEditBtnHidden;"><lr-icon name="edit"></lr-icon><span l10n="edit-image"></span></button><button type="button" class="remove-btn secondary-btn" set="onclick: onRemove"><lr-icon name="remove"></lr-icon><span l10n="remove-from-list"></span></button><div></div><button type="button" class="back-btn primary-btn" set="onclick: onBack"><span l10n="ok"></span></button></div></div>`;var Ys=class Ys{constructor(){u(this,"captionL10nStr","confirm-your-action");u(this,"messageL10Str","are-you-sure");u(this,"confirmL10nStr","yes");u(this,"denyL10nStr","no")}confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}};l(Ys,"UiConfirmation");var Ks=Ys,Zs=class Zs extends b{constructor(){super(...arguments);u(this,"activityType",b.activities.CONFIRMATION);u(this,"_defaults",new Ks);u(this,"init$",{...this.init$,activityCaption:"",messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)})}initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",t=>{t&&this.set$({"*currentActivity":b.activities.CONFIRMATION,activityCaption:this.l10n(t.captionL10nStr),messageTxt:this.l10n(t.messageL10Str),confirmBtnTxt:this.l10n(t.confirmL10nStr),denyBtnTxt:this.l10n(t.denyL10nStr),onDeny:()=>{t.denyAction()},onConfirm:()=>{t.confirmAction()}})})}};l(Zs,"ConfirmationDialog");var Pe=Zs;Pe.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><span>{{activityCaption}}</span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="message">{{messageTxt}}</div><div class="toolbar"><button type="button" class="deny-btn secondary-btn" set="onclick: onDeny">{{denyBtnTxt}}</button><button type="button" class="confirm-btn primary-btn" set="onclick: onConfirm">{{confirmBtnTxt}}</button></div>`;var Js=class Js extends T{constructor(){super(...arguments);u(this,"init$",{...this.init$,visible:!1,unknown:!1,value:0,"*commonProgress":0})}initCallback(){super.initCallback(),this._unobserveCollection=this.uploadCollection.observeProperties(()=>{let t=this.uploadCollection.items().some(i=>this.uploadCollection.read(i).getValue("isUploading"));this.$.visible=t}),this.sub("visible",t=>{t?this.setAttribute("active",""):this.removeAttribute("active")}),this.sub("*commonProgress",t=>{this.$.value=t})}destroyCallback(){var t;super.destroyCallback(),(t=this._unobserveCollection)==null||t.call(this)}};l(Js,"ProgressBarCommon");var Me=Js;Me.template=`<lr-progress-bar set="visible: visible; unknown: unknown; value: value"></lr-progress-bar>`;var Qs=class Qs extends y{constructor(){super(...arguments);u(this,"_value",0);u(this,"_unknownMode",!1);u(this,"init$",{...this.init$,width:0,opacity:0})}initCallback(){super.initCallback(),this.defineAccessor("value",t=>{t!==void 0&&(this._value=t,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))}),this.defineAccessor("visible",t=>{this.ref.line.classList.toggle("progress--hidden",!t)}),this.defineAccessor("unknown",t=>{this._unknownMode=t,this.ref.line.classList.toggle("progress--unknown",t)})}};l(Qs,"ProgressBar");var Ne=Qs;Ne.template='<div ref="line" class="progress"></div>';var Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";var tr=class tr extends y{constructor(){super();u(this,"init$",{...this.init$,checkerboard:!1,src:Y})}initCallback(){super.initCallback(),this.sub("checkerboard",()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${zn()})`:"unset"})}destroyCallback(){super.destroyCallback(),URL.revokeObjectURL(this._lastObjectUrl)}setImage(t){this.$.src=t.src}setImageFile(t){let i=URL.createObjectURL(t);this.$.src=i,this._lastObjectUrl=i}setImageUrl(t){this.$.src=t}clear(){URL.revokeObjectURL(this._lastObjectUrl),this.$.src=Y}};l(tr,"FilePreview");var Jt=tr;Jt.template='<lr-img class="img-view" ref="img" set="@src: src; style.aa: src;" />';Jt.bindAttributes({checkerboard:"checkerboard"});var Wn="--cfg-ctx-name",er=class er extends y{get cfgCssCtxName(){return this.getCssData(Wn,!0)}get cfgCtxName(){var t;let e=((t=this.getAttribute("ctx-name"))==null?void 0:t.trim())||this.cfgCssCtxName||this.__cachedCfgCtxName;return this.__cachedCfgCtxName=e,e}connectedCallback(){var e;if(!this.connectedOnce){let t=(e=this.getAttribute("ctx-name"))==null?void 0:e.trim();t&&this.style.setProperty(Wn,`'${t}'`)}super.connectedCallback()}parseCfgProp(e){return{...super.parseCfgProp(e),ctx:E.getCtx(this.cfgCtxName)}}};l(er,"CloudImageEditorBase");var U=er;function Xn(...r){return r.reduce((e,t)=>{if(typeof t=="string")return e[t]=!0,e;for(let i of Object.keys(t))e[i]=t[i];return e},{})}l(Xn,"normalize");function D(...r){let e=Xn(...r);return Object.keys(e).reduce((t,i)=>(e[i]&&t.push(i),t),[]).join(" ")}l(D,"classNames");function Gn(r,...e){let t=Xn(...e);for(let i of Object.keys(t))r.classList.toggle(i,t[i])}l(Gn,"applyClassNames");var qn=l(r=>{if(!r)return X;let e=pn(r).filter(t=>X.includes(t));return e.length===0?X:e},"parseTabs");function Kn(r){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},"*cropPresetList":[],"*tabList":X,"*tabId":R.CROP,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:Y,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,cropPreset:"",tabs:kt(X),"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let e=r.querySelectorAll("img");for(let t of e){let i=t.src;t.src=Y,t.src=i}r.$["*networkProblems"]=!1},"*on.apply":e=>{if(!e)return;let t=r.$["*originalUrl"],i=M(wt(e),"preview"),s=L(t,i),n={originalUrl:t,cdnUrlModifiers:i,cdnUrl:s,transformations:e};r.dispatchEvent(new CustomEvent("apply",{detail:n,bubbles:!0,composed:!0})),r.remove()},"*on.cancel":()=>{r.remove(),r.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}l(Kn,"initState");var Yn=`<div class="wrapper wrapper_desktop"><lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;"><div class="network_problems_content"><div class="network_problems_icon"><lr-icon size="20" name="sad"></lr-icon></div><div class="network_problems_text">Network error</div></div><div class="network_problems_footer"><lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui></div></lr-presence-toggle><div class="viewport"><div class="file_type_outer"><div class="file_type">{{fileType}}</div></div><div class="image_container" ref="img-container-el"><img src="${Y}" class="image image_visible_from_editor" ref="img-el" /><lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper><lr-editor-image-fader ref="fader-el"></lr-editor-image-fader></div><div class="info_pan">{{msg}}</div></div><div class="toolbar"><lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="toolbar_content toolbar_content__editor"><lr-editor-toolbar></lr-editor-toolbar></div></div></div>`;var Ui=class Ui extends U{constructor(){super();u(this,"_debouncedShowLoader",O(this._showLoader.bind(this),300));this.init$={...this.init$,...Kn(this)}}get ctxName(){return this.autoCtxName}_showLoader(t){this.$.showLoader=t}_waitForSize(){return new Promise((i,s)=>{let n=setTimeout(()=>{s(new Error("[cloud-image-editor] timeout waiting for non-zero container size"))},3e3),o=new ResizeObserver(([a])=>{a.contentRect.width>0&&a.contentRect.height>0&&(i(),clearTimeout(n),o.disconnect())});o.observe(this)})}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async updateImage(){if(this.isConnected){if(await this._waitForSize(),this.$["*tabId"]===R.CROP?this.$["*cropperEl"].deactivate({reset:!0}):this.$["*faderEl"].deactivate(),this.$["*editorTransformations"]={},this.$.cdnUrl){let t=bn(this.$.cdnUrl);this.$["*originalUrl"]=Ct(this.$.cdnUrl,t);let i=_n(this.$.cdnUrl),s=Sn(i);this.$["*editorTransformations"]=s}else if(this.$.uuid)this.$["*originalUrl"]=Ct(this.cfg.cdnCname,this.$.uuid);else throw new Error("No UUID nor CDN URL provided");try{let t=L(this.$["*originalUrl"],M("json")),i=await fetch(t).then(o=>o.json()),{width:s,height:n}=i;this.$["*imageSize"]={width:s,height:n},this.$["*tabId"]===R.CROP?this.$["*cropperEl"].activate(this.$["*imageSize"]):this.$["*faderEl"].activate({url:this.$["*originalUrl"]})}catch(t){t&&console.error("Failed to load image info",t)}}}async initEditor(){try{await this._waitForSize()}catch(t){this.isConnected&&console.error(t.message);return}this.ref["img-el"].addEventListener("load",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==Y&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",t=>{let i=this.ref["img-el"];i.src!==t&&(this._imgLoading=!0,i.src=t||Y)}),this.sub("cropPreset",t=>{this.$["*cropPresetList"]=_i(t)}),this.sub("tabs",t=>{this.$["*tabList"]=qn(t)}),this.sub("*tabId",t=>{this.ref["img-el"].className=D("image",{image_hidden_to_cropper:t===R.CROP,image_hidden_effects:t!==R.CROP})}),this.classList.add("editor_ON"),this.sub("*networkProblems",t=>{this.$["presence.networkProblems"]=t,this.$["presence.modalCaption"]=!t}),this.sub("*editorTransformations",t=>{if(Object.keys(t).length===0)return;let i=this.$["*originalUrl"],s=M(wt(t),"preview"),n=L(i,s),o={originalUrl:i,cdnUrlModifiers:s,cdnUrl:n,transformations:t};this.dispatchEvent(new CustomEvent("change",{detail:o,bubbles:!0,composed:!0}))},!1),this.sub("uuid",t=>t&&this.updateImage()),this.sub("cdnUrl",t=>t&&this.updateImage())}};l(Ui,"CloudImageEditorBlock"),u(Ui,"className","cloud-image-editor");var lt=Ui;lt.template=Yn;lt.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl","crop-preset":"cropPreset",tabs:"tabs"});var ir=class ir extends U{constructor(){super(),this.init$={...this.init$,dragging:!1},this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if(e===""&&t.height<=v&&t.width<=v)return!0;let i=t.height<=v&&(e.includes("n")||e.includes("s")),s=t.width<=v&&(e.includes("e")||e.includes("w"));return i||s}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:n}=e,o=this.ref["svg-el"],a=J("mask",{id:"backdrop-mask"}),c=J("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),h=J("rect",{x:t,y:i,width:s,height:n,fill:"black"});a.appendChild(c),a.appendChild(h);let d=J("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});o.appendChild(d),o.appendChild(a),this._backdropMask=a,this._backdropMaskInner=h}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask&&(this._backdropMask.style.display="block")}))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:n}=e;this._backdropMaskInner&&Ot(this._backdropMaskInner,{x:t,y:i,width:s,height:n})}_updateFrame(){let e=this.$["*cropBox"];if(!(!e||!this._frameGuides||!this._frameThumbs)){for(let t of Object.values(this._frameThumbs)){let{direction:i,pathNode:s,interactionNode:n,groupNode:o}=t,a=i==="",c=i.length===2,{x:h,y:d,width:p,height:f}=e;if(a){let m={x:h+p/3,y:d+f/3,width:p/3,height:f/3};Ot(n,m)}else{let m=vt(Math.min(p,f)/(24*2+34)/2,0,1),{d:_,center:S}=c?rn(e,i,m):nn(e,i,m),A=Math.max(bs*vt(Math.min(p,f)/bs/3,0,1),sn);Ot(n,{x:S[0]-A,y:S[1]-A,width:A*2,height:A*2}),Ot(s,{d:_})}let g=this._shouldThumbBeDisabled(i);o.setAttribute("class",D("thumb",{"thumb--hidden":g,"thumb--visible":!g}))}Ot(this._frameGuides,{x:e.x-1*.5,y:e.y-1*.5,width:e.width+1,height:e.height+1})}}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let i=0;i<3;i++){let s=`${["n","","s"][t]}${["w","","e"][i]}`,n=J("g");n.classList.add("thumb"),n.setAttribute("with-effects","");let o=J("rect",{fill:"transparent"}),a=J("path",{stroke:"currentColor",fill:"none","stroke-width":3});n.appendChild(a),n.appendChild(o),e[s]={direction:s,pathNode:a,interactionNode:o,groupNode:n},o.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return e}_createGuides(){let e=J("svg"),t=J("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});e.appendChild(t);for(let i=1;i<=2;i++){let s=J("line",{x1:`${we*i}%`,y1:"0%",x2:`${we*i}%`,y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(s)}for(let i=1;i<=2;i++){let s=J("line",{x1:"0%",y1:`${we*i}%`,x2:"100%",y2:`${we*i}%`,stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(s)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),i=this._createGuides();t.appendChild(i);let s=this._createThumbs();for(let{groupNode:n}of Object.values(s))t.appendChild(n);e.appendChild(t),this._frameThumbs=s,this._frameGuides=i}_handlePointerDown(e,t){if(!this._frameThumbs)return;let i=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let s=this.$["*cropBox"],{x:n,y:o}=this.ref["svg-el"].getBoundingClientRect(),a=t.x-n,c=t.y-o;this.$.dragging=!0,this._draggingThumb=i,this._dragStartPoint=[a,c],this._dragStartCrop={...s}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging||!this._dragStartPoint||!this._draggingThumb)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:i,y:s}=t.getBoundingClientRect(),n=e.x-i,o=e.y-s,a=n-this._dragStartPoint[0],c=o-this._dragStartPoint[1],{direction:h}=this._draggingThumb,d=this._calcCropBox(h,[a,c]);d&&(this.$["*cropBox"]=d)}_calcCropBox(e,t){var h,d;let[i,s]=t,n=this.$["*imageBox"],o=(h=this._dragStartCrop)!=null?h:this.$["*cropBox"],a=(d=this.$["*cropPresetList"])==null?void 0:d[0],c=a?a.width/a.height:void 0;if(e===""?o=ln({rect:o,delta:[i,s],imageBox:n}):o=an({rect:o,delta:[i,s],direction:e,aspectRatio:c,imageBox:n}),!Object.values(o).every(p=>Number.isFinite(p)&&p>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:o});return}return Vt(zt(o),this.$["*imageBox"])}_handleSvgPointerMove_(e){if(!this._frameThumbs)return;let t=Object.values(this._frameThumbs).find(i=>{if(this._shouldThumbBeDisabled(i.direction))return!1;let n=i.interactionNode.getBoundingClientRect(),o={x:n.x,y:n.y,width:n.width,height:n.height};return cn(o,[e.x,e.y])});this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;this.ref["svg-el"].style.cursor=e?on(e.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){this._frameThumbs&&Object.values(this._frameThumbs).map(({groupNode:t})=>t).forEach(t=>{t.setAttribute("class",D("thumb",{"thumb--hidden":!e,"thumb--visible":e}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",e=>{e&&(this._guidesHidden=e.height<=v||e.width<=v,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",e=>{this._frameGuides&&this._frameGuides.setAttribute("class",D({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}};l(ir,"CropFrame");var De=ir;De.template='<svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg>';var sr=class sr extends U{constructor(){super(...arguments);u(this,"init$",{...this.init$,active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",t=>{this._titleEl&&(this._titleEl.style.display=t?"block":"none")}),this.sub("active",t=>{this.className=D({active:t,not_active:!t})}),this.sub("on.click",t=>{this.onclick=t})}};l(sr,"EditorButtonControl");var gt=sr;gt.template=`<div class="before"></div><lr-icon size="20" set="@name: icon;"></lr-icon><div class="title" ref="title-el">{{title}}</div>`;function ua(r){let e=r+90;return e=e>=360?0:e,e}l(ua,"nextAngle");function da(r,e){return r==="rotate"?ua(e):["mirror","flip"].includes(r)?!e:null}l(da,"nextValue");var rr=class rr extends gt{initCallback(){super.initCallback(),this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e)}),this.$["on.click"]=e=>{let t=this.$["*cropperEl"].getValue(this._operation),i=da(this._operation,t);this.$["*cropperEl"].setValue(this._operation,i)}}};l(rr,"EditorCropButtonControl");var Qt=rr;var Fe={FILTER:"filter",COLOR_OPERATION:"color_operation"},at="original",nr=class nr extends U{constructor(){super(...arguments);u(this,"init$",{...this.init$,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":t=>{this.$["*faderEl"].set(t),this.$.value=t}})}setOperation(t,i){this._controlType=t==="filter"?Fe.FILTER:Fe.COLOR_OPERATION,this._operation=t,this._iconName=t,this._title=t.toUpperCase(),this._filter=i,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===at?void 0:this.$.value,filter:this._filter===at?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:t,zero:i}=nt[this._operation],[s,n]=t;this.$.min=s,this.$.max=n,this.$.zero=i;let o=this.$["*editorTransformations"][this._operation];if(this._controlType===Fe.FILTER){let a=n;if(o){let{name:c,amount:h}=o;a=c===this._filter?h:n}this.$.value=a,this.$.defaultValue=a}if(this._controlType===Fe.COLOR_OPERATION){let a=typeof o!="undefined"?o:i;this.$.value=a,this.$.defaultValue=a}}apply(){let t;this._controlType===Fe.FILTER?this._filter===at?t=null:t={name:this._filter,amount:this.$.value}:t=this.$.value;let i={...this.$["*editorTransformations"],[this._operation]:t};this.$["*editorTransformations"]=i}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",t=>{this._originalUrl=t}),this.sub("value",t=>{let i=`${this._filter||this._operation} ${t}`;this.$["*operationTooltip"]=i})}};l(nr,"EditorSlider");var Ve=nr;Ve.template=`<lr-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;" ></lr-slider-ui>`;function Be(r){let e=new Image;return{promise:new Promise((s,n)=>{e.src=r,e.onload=s,e.onerror=n}),image:e,cancel:l(()=>{e.naturalWidth===0&&(e.src=Y)},"cancel")}}l(Be,"preloadImage");function ze(r){let e=[];for(let n of r){let o=Be(n);e.push(o)}let t=e.map(n=>n.image);return{promise:Promise.allSettled(e.map(n=>n.promise)),images:t,cancel:l(()=>{e.forEach(n=>{n.cancel()})},"cancel")}}l(ze,"batchPreloadImages");var or=class or extends gt{constructor(){super(...arguments);u(this,"init$",{...this.init$,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let t=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),i=window.devicePixelRatio,s=Math.ceil(i*t),n=i>=2?"lightest":"normal",o=100,a={...this.$["*editorTransformations"]};return a[this._operation]=this._filter!==at?{name:this._filter,amount:o}:void 0,L(this._originalUrl,M(wi,wt(a),`quality/${n}`,`scale_crop/${s}x${s}/center`))}_observerCallback(t,i){if(t[0].isIntersecting){let n=this.proxyUrl(this._previewSrc()),o=this.ref["preview-el"],{promise:a,cancel:c}=Be(n);this._cancelPreload=c,a.catch(h=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:h})}).finally(()=>{o.style.backgroundImage=`url(${n})`,o.setAttribute("loaded",""),i.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=i=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",i=>{this._operation="filter",this._filter=i,this.$.isOriginal=i===at,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let t=this.$["*originalUrl"];this._originalUrl=t,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",i=>{this.$.active=i&&i===this._filter}),this.sub("isOriginal",i=>{this.$.iconSize=i?40:20}),this.sub("active",i=>{if(this.$.isOriginal)return;let s=this.ref["icon-el"];s.style.opacity=i?"1":"0";let n=this.ref["preview-el"];i?n.style.opacity="0":n.style.backgroundImage&&(n.style.opacity="1")}),this.sub("*networkProblems",i=>{if(!i){let s=this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"];n.style.backgroundImage&&(n.style.backgroundImage="none",n.style.backgroundImage=`url(${s})`)}})}destroyCallback(){var t;super.destroyCallback(),(t=this._observer)==null||t.disconnect(),this._cancelPreload&&this._cancelPreload()}};l(or,"EditorFilterControl");var Ut=or;Ut.template=`<div class="before"></div><div class="preview" ref="preview-el"></div><lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>`;var lr=class lr extends gt{constructor(){super(...arguments);u(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",t=>{t&&(this._operation=t,this.$.icon=t,this.$.title=this.l10n(t))}),this.sub("*editorTransformations",t=>{if(!this._operation)return;let{zero:i}=nt[this._operation],s=t[this._operation],n=typeof s!="undefined"?s!==i:!1;this.$.active=n})}};l(lr,"EditorOperationControl");var te=lr;var Zn=l((r,e)=>{let t,i,s;return(...n)=>{t?(clearTimeout(i),i=setTimeout(()=>{Date.now()-s>=e&&(r(...n),s=Date.now())},Math.max(e-(Date.now()-s),0))):(r(...n),s=Date.now(),t=!0)}},"throttle");function Jn(r,e){let t={};for(let i of e){let s=r[i];(r.hasOwnProperty(i)||s!==void 0)&&(t[i]=s)}return t}l(Jn,"pick");function ee(r,e,t){let s=window.devicePixelRatio,n=Math.min(Math.ceil(e*s),3e3),o=s>=2?"lightest":"normal";return L(r,M(wi,wt(t),`quality/${o}`,`stretch/off/-/resize/${n}x`))}l(ee,"viewerImageSrc");function pa(r){return r?[({dimensions:t,coords:i})=>[...t,...i].every(s=>Number.isInteger(s)&&Number.isFinite(s)),({dimensions:t,coords:i})=>t.every(s=>s>0)&&i.every(s=>s>=0)].every(t=>t(r)):!0}l(pa,"validateCrop");var ar=class ar extends U{constructor(){super(),this.init$={...this.init$,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}},this._commitDebounced=O(this._commit.bind(this),300),this._handleResizeThrottled=Zn(this._handleResize.bind(this),100),this._imageSize={width:0,height:0}}_handleResize(){!this.isConnected||!this._isActive||(this._initCanvas(),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let e=this.$["*editorTransformations"],t=Jn(e,Object.keys(this.$["*operations"])),i={...this.$["*operations"],...t};this.$["*operations"]=i}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),i=this.offsetWidth,s=this.offsetHeight,n=window.devicePixelRatio;e.style.width=`${i}px`,e.style.height=`${s}px`,e.width=i*n,e.height=s*n,t==null||t.scale(n,n),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],i=this.$["*operations"],{rotate:s}=i,n={width:this.offsetWidth,height:this.offsetHeight},o=Bt({width:e.naturalWidth,height:e.naturalHeight},s),a;if(o.width>n.width-t*2||o.height>n.height-t*2){let c=o.width/o.height,h=n.width/n.height;if(c>h){let d=n.width-t*2,p=d/c,f=0+t,g=t+(n.height-t*2)/2-p/2;a={x:f,y:g,width:d,height:p}}else{let d=n.height-t*2,p=d*c,f=t+(n.width-t*2)/2-p/2,g=0+t;a={x:f,y:g,width:p,height:d}}}else{let{width:c,height:h}=o,d=t+(n.width-t*2)/2-c/2,p=t+(n.height-t*2)/2-h/2;a={x:d,y:p,width:c,height:h}}this.$["*imageBox"]=zt(a)}_alignCrop(){var p;let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,n=this.$["*editorTransformations"].crop,{width:o,x:a,y:c}=this.$["*imageBox"];if(n){let{dimensions:[f,g],coords:[m,_]}=n,{width:S}=Bt(this._imageSize,s),A=o/S;e=Vt(zt({x:a+m*A,y:c+_*A,width:f*A,height:g*A}),this.$["*imageBox"])}let h=(p=this.$["*cropPresetList"])==null?void 0:p[0],d=h?h.width/h.height:void 0;if(!hn(e,t)||d&&!un(e,d)){let f=t.width/t.height,g=t.width,m=t.height;d&&(f>d?g=Math.min(t.height*d,t.width):m=Math.min(t.width/d,t.height)),e={x:t.x+t.width/2-g/2,y:t.y+t.height/2-m/2,width:g,height:m}}this.$["*cropBox"]=Vt(zt(e),this.$["*imageBox"])}_drawImage(){let e=this._ctx;if(!e)return;let t=this.$.image,i=this.$["*imageBox"],s=this.$["*operations"],{mirror:n,flip:o,rotate:a}=s,c=Bt({width:i.width,height:i.height},a);e.save(),e.translate(i.x+i.width/2,i.y+i.height/2),e.rotate(a*Math.PI*-1/180),e.scale(n?-1:1,o?-1:1),e.drawImage(t,-c.width/2,-c.height/2,c.width,c.height),e.restore()}_draw(){if(!this._isActive||!this.$.image||!this._canvas||!this._ctx)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=D({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1})}))}_getCropDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:n,height:o}=t,{width:a,height:c}=Bt(this._imageSize,s),{width:h,height:d}=e,p=n/a,f=o/c;return[vt(Math.round(h/p),1,a),vt(Math.round(d/f),1,c)]}_getCropTransformation(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:n,height:o,x:a,y:c}=t,{width:h,height:d}=Bt(this._imageSize,s),{x:p,y:f}=e,g=n/h,m=o/d,_=this._getCropDimensions(),S={dimensions:_,coords:[vt(Math.round((p-a)/g),0,h-_[0]),vt(Math.round((f-c)/m),0,d-_[1])]};if(!pa(S)){console.error("Cropper is trying to create invalid crop object",{payload:S});return}if(!(_[0]===h&&_[1]===d))return S}_commit(){if(!this.isConnected)return;let e=this.$["*operations"],{rotate:t,mirror:i,flip:s}=e,n=this._getCropTransformation(),a={...this.$["*editorTransformations"],crop:n,rotate:t,mirror:i,flip:s};this.$["*editorTransformations"]=a}setValue(e,t){console.log(`Apply cropper operation [${e}=${t}]`),this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}={}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset);try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._animateIn({fromViewer:t})}catch(i){console.error("Failed to activate cropper",{error:i})}this._observer=new ResizeObserver(([i])=>{i.contentRect.width>0&&i.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeThrottled()}),this._observer.observe(this)}}deactivate({reset:e=!1}={}){var t;this._isActive&&(!e&&this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=D({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}),(t=this._observer)==null||t.disconnect())}_transitionToCrop(){let e=this._getCropDimensions(),t=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,i=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,s=Math.min(t,i),n=this.$["*cropBox"].x+this.$["*cropBox"].width/2,o=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${s}) translate(${(this.offsetWidth/2-n)/s}px, ${(this.offsetHeight/2-o)/s}px)`,this.style.transformOrigin=`${n}px ${o}px`}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,t=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${e}px ${t}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let i=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let s=this.proxyUrl(ee(e,i,t)),{promise:n,cancel:o,image:a}=Be(s),c=this._handleImageLoading(s);return a.addEventListener("load",c,{once:!0}),a.addEventListener("error",c,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=o,n.then(()=>a).catch(h=>(console.error("Failed to load image",{error:h}),this.$["*networkProblems"]=!0,Promise.resolve(a)))}_handleImageLoading(e){let t="crop",i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{var s;(s=i==null?void 0:i.get(t))!=null&&s.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}initCallback(){super.initCallback(),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",()=>{this.$.image&&this._commitDebounced()}),this.sub("*cropPresetList",()=>{this._alignCrop()}),setTimeout(()=>{this.sub("*networkProblems",e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect()}};l(ar,"EditorImageCropper");var je=ar;je.template=`<canvas class="canvas" ref="canvas-el"></canvas><lr-crop-frame ref="frame-el"></lr-crop-frame>`;function cr(r,e,t){let i=Array(t);t--;for(let s=t;s>=0;s--)i[s]=Math.ceil((s*e+(t-s)*r)/t);return i}l(cr,"linspace");function fa(r){return r.reduce((e,t,i)=>i<r.length-1?[...e,[t,r[i+1]]]:e,[])}l(fa,"splitBySections");function ma(r,e,t){let i=fa(r).find(([s,n])=>s<=e&&e<=n);return r.map(s=>{let n=Math.abs(i[0]-i[1]),o=Math.abs(e-i[0])/n;return i[0]===s?e>t?1:1-o:i[1]===s?e>=t?o:1:0})}l(ma,"calculateOpacities");function ga(r,e){return r.map((t,i)=>t<e?r.length-i:i)}l(ga,"calculateZIndices");function Qn(r,e){let t=nt[r].keypointsNumber,{range:i,zero:s}=nt[r];return[...new Set([...cr(i[0],s,t+1),...cr(s,i[1],t+1),s,e])].sort((n,o)=>n-o)}l(Qn,"keypointsRange");var hr=class hr extends U{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=O(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(e){let t=this._operation,i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{var s;(s=i==null?void 0:i.get(t))!=null&&s.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let e of this._keypoints){let{image:t}=e;t&&(t.style.opacity=e.opacity.toString(),t.style.zIndex=e.zIndex.toString())}})}_imageSrc({url:e=this._url,filter:t=this._filter,operation:i,value:s}={}){let n={...this._transformations};i&&(n[i]=t?{name:t,amount:s}:s);let o=this.offsetWidth;return this.proxyUrl(ee(e,o,n))}_constructKeypoint(e,t){return{src:this._imageSrc({operation:e,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(e,t){return this._operation===e&&this._filter===t}_addKeypoint(e,t,i){let s=l(()=>!this._isSame(e,t)||this._value!==i||!!this._keypoints.find(c=>c.value===i),"shouldSkip");if(s())return;let n=this._constructKeypoint(e,i),o=new Image;o.src=n.src;let a=this._handleImageLoading(n.src);o.addEventListener("load",a,{once:!0}),o.addEventListener("error",a,{once:!0}),n.image=o,o.classList.add("fader-image"),o.addEventListener("load",()=>{if(s())return;let c=this._keypoints,h=c.findIndex(p=>p.value>i),d=h<c.length?c[h].image:null;!this._container||d&&!this._container.contains(d)||(c.splice(h,0,n),this._container.insertBefore(o,d),this._update(e,i))},{once:!0}),o.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(e){e=typeof e=="string"?parseInt(e,10):e,this._update(this._operation,e),this._addKeypointDebounced(this._operation,this._filter,e)}_update(e,t){this._operation=e,this._value=t;let{zero:i}=nt[e],s=this._keypoints.map(a=>a.value),n=ma(s,t,i),o=ga(s,i);for(let[a,c]of Object.entries(this._keypoints))c.opacity=n[a],c.zIndex=o[a];this._flush()}_createPreviewImage(){let e=new Image;return e.classList.add("fader-image","fader-image--preview"),e.style.opacity="0",e}async _initNodes(){let e=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&e.appendChild(this._previewImage);let t=document.createElement("div");e.appendChild(t);let i=this._keypoints.map(h=>h.src),{images:s,promise:n,cancel:o}=ze(i);s.forEach(h=>{let d=this._handleImageLoading(h.src);h.addEventListener("load",d),h.addEventListener("error",d)}),this._cancelLastImages=()=>{o(),this._cancelLastImages=void 0};let a=this._operation,c=this._filter;await n,this._isActive&&this._isSame(a,c)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach((h,d)=>{let p=s[d];p.classList.add("fader-image"),h.image=p,this._container.appendChild(p)}),this.appendChild(e),this._flush())}setTransformations(e){if(this._transformations=e,this._previewImage){let t=this._imageSrc(),i=this._handleImageLoading(t);this._previewImage.src=t,this._previewImage.addEventListener("load",i,{once:!0}),this._previewImage.addEventListener("error",i,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:e,filter:t,operation:i,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let o=Qn(i,s).map(c=>this._imageSrc({url:e,filter:t,operation:i,value:c})),{cancel:a}=ze(o);this._cancelBatchPreload=a}_setOriginalSrc(e){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===e){t.style.opacity="1",t.style.transform="scale(1)",this.className=D({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1});return}t.style.opacity="0";let i=this._handleImageLoading(e);t.addEventListener("error",i,{once:!0}),t.src=e,t.addEventListener("load",()=>{i(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=D({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))},{once:!0}),t.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:e,operation:t,value:i,filter:s,fromViewer:n}){if(this._isActive=!0,this._hidden=!1,this._url=e,this._operation=t||"initial",this._value=i,this._filter=s,this._fromViewer=n,typeof i!="number"&&!s){let a=this._imageSrc({operation:t,value:i});this._setOriginalSrc(a),this._container&&this._container.remove();return}this._keypoints=Qn(t,i).map(a=>this._constructKeypoint(t,a)),this._update(t,i),this._initNodes()}deactivate({hide:e=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),e&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=D({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}};l(hr,"EditorImageFader");var Pi=hr;var ba=1,ur=class ur extends U{initCallback(){super.initCallback(),this.addEventListener("wheel",e=>{e.preventDefault();let{deltaY:t,deltaX:i}=e;Math.abs(i)>ba?this.scrollLeft+=i:this.scrollLeft+=t})}};l(ur,"EditorScroller");var He=ur;He.template=" <slot></slot> ";function _a(r){return`<lr-presence-toggle class="tab-toggle" set="visible: presence.tabToggle.${r}; styles: presence.tabToggleStyles;"><lr-btn-ui theme="boring" ref="tab-toggle-${r}" data-id="${r}" icon="${r}" tabindex="0" set="onclick: on.clickTab;" ></lr-btn-ui></lr-presence-toggle>`}l(_a,"renderTabToggle");function ya(r){return`<lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${r}; styles: presence.tabContentStyles"><lr-editor-scroller hidden-scrollbar><div class="controls-list_align"><div class="controls-list_inner" ref="controls-list-${r}"></div></div></lr-editor-scroller></lr-presence-toggle>`}l(ya,"renderTabContent");var dr=class dr extends U{constructor(){super();u(this,"_updateInfoTooltip",O(()=>{var o,a;let t=this.$["*editorTransformations"],i=this.$["*currentOperation"],s="",n=!1;if(this.$["*tabId"]===R.FILTERS)if(n=!0,this.$["*currentFilter"]&&((o=t==null?void 0:t.filter)==null?void 0:o.name)===this.$["*currentFilter"]){let c=((a=t==null?void 0:t.filter)==null?void 0:a.amount)||100;s=this.l10n(this.$["*currentFilter"])+" "+c}else s=this.l10n(at);else if(this.$["*tabId"]===R.TUNING&&i){n=!0;let c=(t==null?void 0:t[i])||nt[i].zero;s=i+" "+c}n&&(this.$["*operationTooltip"]=s),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",n)},0));this.init$={...this.init$,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":at,"*currentOperation":null,showLoader:!1,filters:On,colorOperations:In,cropOperations:kn,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabToggles":!0,"presence.tabContent.crop":!1,"presence.tabContent.tuning":!1,"presence.tabContent.filters":!1,"presence.tabToggle.crop":!0,"presence.tabToggle.tuning":!0,"presence.tabToggle.filters":!0,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"presence.tabToggleStyles":{hidden:"tab-toggle--hidden",visible:"tab-toggle--visible"},"presence.tabTogglesStyles":{hidden:"tab-toggles--hidden",visible:"tab-toggles--visible"},"on.cancel":()=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":()=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":()=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":()=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":t=>{let i=t.currentTarget.getAttribute("data-id");i&&this._activateTab(i,{fromViewer:!1})}},this._debouncedShowLoader=O(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===R.TUNING&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(t){let i=new te;return i.operation=t,i}_createFilterControl(t){let i=new Ut;return i.filter=t,i}_createToggleControl(t){let i=new Qt;return i.operation=t,i}_renderControlsList(t){let i=this.ref[`controls-list-${t}`],s=document.createDocumentFragment();t===R.CROP?this.$.cropOperations.forEach(n=>{let o=this._createToggleControl(n);s.appendChild(o)}):t===R.FILTERS?[at,...this.$.filters].forEach(n=>{let o=this._createFilterControl(n);s.appendChild(o)}):t===R.TUNING&&this.$.colorOperations.forEach(n=>{let o=this._createOperationControl(n);s.appendChild(o)}),[...s.children].forEach((n,o)=>{o===s.childNodes.length-1&&n.classList.add("controls-list_last-item")}),i.innerHTML="",i.appendChild(s)}_activateTab(t,{fromViewer:i}){this.$["*tabId"]=t,t===R.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:i})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:i}),this.$["*cropperEl"].deactivate());for(let s of X){let n=s===t,o=this.ref[`tab-toggle-${s}`];o.active=n,n?(this._renderControlsList(t),this._syncTabIndicator()):this._unmountTabControls(s),this.$[`presence.tabContent.${s}`]=n}}_unmountTabControls(t){let i=this.ref[`controls-list-${t}`];i&&(i.innerHTML="")}_syncTabIndicator(){let t=this.ref[`tab-toggle-${this.$["*tabId"]}`],i=this.ref["tabs-indicator"];i.style.transform=`translateX(${t.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let t=this.$["*imgContainerEl"].offsetWidth,i=this.proxyUrl(ee(this.$["*originalUrl"],t,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:s}=ze([i]);this._cancelPreload=()=>{s(),this._cancelPreload=void 0}}}_showLoader(t){this.$.showLoader=t}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",t=>{t&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",t=>{var s;let i=(s=t==null?void 0:t.filter)==null?void 0:s.name;this.$["*currentFilter"]!==i&&(this.$["*currentFilter"]=i)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",()=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",t=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(t)}),this.sub("*loadingOperations",t=>{let i=!1;for(let[,s]of t.entries()){if(i)break;for(let[,n]of s.entries())if(n){i=!0;break}}this._debouncedShowLoader(i)}),this.sub("*showSlider",t=>{this.$["presence.subToolbar"]=t,this.$["presence.mainToolbar"]=!t}),this.sub("*tabList",t=>{this.$["presence.tabToggles"]=t.length>1;for(let i of X){this.$[`presence.tabToggle.${i}`]=t.includes(i);let s=this.ref[`tab-toggle-${i}`];s.style.gridColumn=t.indexOf(i)+1}t.includes(this.$["*tabId"])||this._activateTab(t[0],{fromViewer:!1})}),this._updateInfoTooltip()}};l(dr,"EditorToolbar");var We=dr;We.template=`<lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="info-tooltip_container"><div class="info-tooltip_wrapper"><div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div></div></div><div class="toolbar-container"><lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"><div class="tab-content-row">${X.map(ya).join("")}</div><div class="controls-row"><lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"></lr-btn-ui><lr-presence-toggle class="tab-toggles" set="visible: presence.tabToggles; styles: presence.tabTogglesStyles"><div ref="tabs-indicator" class="tab-toggles_indicator"></div> ${X.map(_a).join("")} </lr-presence-toggle><lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"></lr-btn-ui></div></lr-presence-toggle><lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"><div class="slider"><lr-editor-slider ref="slider-el"></lr-editor-slider></div><div class="controls-row"><lr-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"></lr-btn-ui><lr-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"></lr-btn-ui></div></lr-presence-toggle></div>`;var pr=class pr extends y{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.init$,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return D("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",e=>{this._iconSingle=!this.$.text,this._iconHidden=!e,this.$.iconCss=this._iconCss()}),this.sub("theme",e=>{e!=="custom"&&(this.className=e)}),this.sub("text",e=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(e){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}};l(pr,"LrBtnUi");var ie=pr;ie.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});ie.template=`<lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon><div class="text">{{text}}</div>`;var fr=class fr extends y{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",e=>{typeof e=="boolean"&&(e?this._start():this._stop())})}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${e}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}};l(fr,"LineLoaderUi");var Xe=fr;Xe.template=`<div class="inner"><div class="line" ref="line-el"></div></div>`;var Mi={transition:"transition",visible:"visible",hidden:"hidden"},mr=class mr extends y{constructor(){super(),this._visible=!1,this._visibleStyle=Mi.visible,this._hiddenStyle=Mi.hidden,this._externalTransitions=!1,this.defineAccessor("styles",e=>{e&&(this._externalTransitions=!0,this._visibleStyle=e.visible,this._hiddenStyle=e.hidden)}),this.defineAccessor("visible",e=>{typeof e=="boolean"&&(this._visible=e,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",Gn(this,{[Mi.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(Mi.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}};l(mr,"PresenceToggle");var Ge=mr;Ge.template=" <slot></slot> ";var gr=class gr extends y{constructor(){super();u(this,"init$",{...this.init$,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t),this.$.onInput&&this.$.onInput(t)},"on.sliderChange":()=>{let t=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(t)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",i=>{this.$.disabled=i}),this.defineAccessor("min",i=>{this.$.min=i}),this.defineAccessor("max",i=>{this.$.max=i}),this.defineAccessor("defaultValue",i=>{this.$.defaultValue=i,this.ref["input-el"].value=i,this._updateValue(i)}),this.defineAccessor("zero",i=>{this._zero=i}),this.defineAccessor("onInput",i=>{i&&(this.$.onInput=i)}),this.defineAccessor("onChange",i=>{i&&(this.$.onChange=i)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let i=parseInt(this.ref["input-el"].value,10);this._updateValue(i)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let i=parseInt(this.ref["input-el"].value,10);this._updateValue(i)},0),this.sub("disabled",i=>{let s=this.ref["input-el"];i?s.setAttribute("disabled","disabled"):s.removeAttribute("disabled")});let t=this.ref["input-el"];t.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),t.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(t){this._updateZeroDot(t);let{width:i}=this.getBoundingClientRect(),o=100/(this.$.max-this.$.min)*(t-this.$.min)*(i-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${o}px)`})}_updateZeroDot(t){if(!this._zeroDotEl)return;t===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:i}=this.getBoundingClientRect(),o=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(i-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${o}px)`})}_updateSteps(){let i=this.ref["steps-el"],{width:s}=i.getBoundingClientRect(),n=Math.ceil(s/2),o=Math.ceil(n/15)-2;if(this._stepsCount===o)return;let a=document.createDocumentFragment(),c=document.createElement("div"),h=document.createElement("div");c.className="minor-step",h.className="border-step",a.appendChild(h);for(let p=0;p<o;p++)a.appendChild(c.cloneNode());a.appendChild(h.cloneNode());for(let p=0;p<o;p++)a.appendChild(c.cloneNode());a.appendChild(h.cloneNode());let d=document.createElement("div");d.className="zero-dot",a.appendChild(d),this._zeroDotEl=d,i.innerHTML="",i.appendChild(a),this._stepsCount=o}destroyCallback(){var t;(t=this._observer)==null||t.disconnect()}};l(gr,"SliderUi");var qe=gr;qe.template=`<div class="steps" ref="steps-el"></div><div ref="thumb-el" class="thumb"></div><input class="input" type="range" ref="input-el" tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;" />`;var br=class br extends T{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"activityType",b.activities.CLOUD_IMG_EDIT);this.init$={...this.init$,cdnUrl:null}}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.sub("*focusedEntry",t=>{t&&(this.entry=t,this.entry.subscribe("cdnUrl",i=>{i&&(this.$.cdnUrl=i)}))}),this.subConfigValue("cropPreset",t=>{this._instance&&this._instance.getAttribute("crop-preset")!==t&&this._instance.setAttribute("crop-preset",t)}),this.subConfigValue("cloudImageEditorTabs",t=>{this._instance&&this._instance.getAttribute("tabs")!==t&&this._instance.setAttribute("tabs",t)})}handleApply(t){if(!this.entry)return;let i=t.detail;this.entry.setMultipleValues({cdnUrl:i.cdnUrl,cdnUrlModifiers:i.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let t=new lt,i=this.$.cdnUrl,s=this.cfg.cropPreset,n=this.cfg.cloudImageEditorTabs;t.setAttribute("ctx-name",this.ctxName),t.setAttribute("cdn-url",i),s&&t.setAttribute("crop-preset",s),n&&t.setAttribute("tabs",n),t.addEventListener("apply",o=>this.handleApply(o)),t.addEventListener("cancel",()=>this.handleCancel()),this.innerHTML="",this.appendChild(t),this._mounted=!0,this._instance=t}unmountEditor(){this._instance=void 0,this.innerHTML=""}};l(br,"CloudImageEditorActivity");var Ni=br;var va=l(function(r){return r.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},"escapeRegExp"),to=l(function(r,e="i"){let t=r.split("*").map(va);return new RegExp("^"+t.join(".+")+"$",e)},"wildcardRegexp");var Ca=l(r=>Object.keys(r).reduce((t,i)=>{let s=r[i],n=Object.keys(s).reduce((o,a)=>{let c=s[a];return o+`${a}: ${c};`},"");return t+`${i}{${n}}`},""),"styleToCss");function eo({textColor:r,backgroundColor:e,linkColor:t,linkColorHover:i,shadeColor:s}){let n=`solid 1px ${s}`;return Ca({body:{color:r,"background-color":e},".side-bar":{background:"inherit","border-right":n},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:s},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":n},".list-table-body .list-items":{"border-bottom":n},".bread-crumbs a":{color:t},".bread-crumbs a:hover":{color:i},".main-content.loading":{background:`${e} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{"background-color":s},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:t},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:i},".side-bar-menu a":{color:t},".side-bar-menu a:hover":{color:i},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:i},".source-vk .side-bar-menu a":{color:t},".source-vk .side-bar-menu a:hover":{color:i,background:"none"}})}l(eo,"buildStyles");var xt={};window.addEventListener("message",r=>{let e;try{e=JSON.parse(r.data)}catch{return}if((e==null?void 0:e.type)in xt){let t=xt[e.type];for(let[i,s]of t)r.source===i&&s(e)}});var io=l(function(r,e,t){r in xt||(xt[r]=[]),xt[r].push([e,t])},"registerMessage"),so=l(function(r,e){r in xt&&(xt[r]=xt[r].filter(t=>t[0]!==e))},"unregisterMessage");function ro(r){let e=[];for(let[t,i]of Object.entries(r))i==null||typeof i=="string"&&i.length===0||e.push(`${t}=${encodeURIComponent(i)}`);return e.join("&")}l(ro,"queryString");var _r=class _r extends T{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"activityType",b.activities.EXTERNAL);u(this,"_iframe",null);u(this,"updateCssData",l(()=>{this.isActivityActive&&(this._inheritedUpdateCssData(),this.applyStyles())},"updateCssData"));u(this,"_inheritedUpdateCssData",this.updateCssData);this.init$={...this.init$,activityIcon:"",activityCaption:"",selectedList:[],counter:0,onDone:()=>{for(let t of this.$.selectedList){let i=this.extractUrlFromMessage(t),{filename:s}=t,{externalSourceType:n}=this.activityParams;this.addFileFromUrl(i,{fileName:s,source:n})}this.$["*currentActivity"]=b.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()}}}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:t}=this.activityParams;this.set$({activityCaption:`${t==null?void 0:t[0].toUpperCase()}${t==null?void 0:t.slice(1)}`,activityIcon:t}),this.mountIframe()}}),this.sub("*currentActivity",t=>{t!==this.activityType&&this.unmountIframe()}),this.sub("selectedList",t=>{this.$.counter=t.length})}extractUrlFromMessage(t){if(t.alternatives){let i=N(this.cfg.externalSourcesPreferredTypes);for(let s of i){let n=to(s);for(let[o,a]of Object.entries(t.alternatives))if(n.test(o))return a}}return t.url}sendMessage(t){var i,s;(s=(i=this._iframe)==null?void 0:i.contentWindow)==null||s.postMessage(JSON.stringify(t),"*")}async handleFileSelected(t){this.$.selectedList=[...this.$.selectedList,t]}handleIframeLoad(){this.applyStyles()}getCssValue(t){return window.getComputedStyle(this).getPropertyValue(t).trim()}applyStyles(){let t={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:eo(t)})}remoteUrl(){var a,c;let t=this.cfg.pubkey,i="false",{externalSourceType:s}=this.activityParams,n={lang:((c=(a=this.getCssData("--l10n-locale-name"))==null?void 0:a.split("-"))==null?void 0:c[0])||"en",public_key:t,images_only:i,pass_window_open:!1,session_key:this.cfg.remoteTabSessionKey},o=new URL(this.cfg.socialBaseUrl);return o.pathname=`/window3/${s}`,o.search=ro(n),o.toString()}mountIframe(){let t=me({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});t.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(t),io("file-selected",t.contentWindow,this.handleFileSelected.bind(this)),this._iframe=t,this.$.selectedList=[]}unmountIframe(){this._iframe&&so("file-selected",this._iframe.contentWindow),this.ref.iframeWrapper.innerHTML="",this._iframe=null,this.$.selectedList=[],this.$.counter=0}};l(_r,"ExternalSource");var Ke=_r;Ke.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div><lr-icon set="@name: activityIcon"></lr-icon><span>{{activityCaption}}</span></div><button type="button" class="mini-btn close-btn" set="onclick: *historyBack"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><div ref="iframeWrapper" class="iframe-wrapper"></div><div class="toolbar"><button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button><div></div><div class="selected-counter"><span l10n="selected-count"></span>{{counter}}</div><button type="button" class="done-btn primary-btn" set="onclick: onDone; @disabled: !counter"><lr-icon name="check"></lr-icon></button></div></div>`;var yr=class yr extends y{setCurrentTab(e){if(!e)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach(i=>{i.getAttribute("tab-ctx")===e?i.removeAttribute("hidden"):i.setAttribute("hidden","")});for(let i in this._tabMap)i===e?this._tabMap[i].setAttribute("current",""):this._tabMap[i].removeAttribute("current")}initCallback(){super.initCallback(),this._tabMap={},this.defineAccessor("tab-list",e=>{if(!e)return;N(e).forEach(i=>{let s=me({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(i)}}});s.textContent=this.l10n(i),this.ref.row.appendChild(s),this._tabMap[i]=s})}),this.defineAccessor("default",e=>{this.setCurrentTab(e)}),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}};l(yr,"Tabs");var se=yr;se.bindAttributes({"tab-list":null,default:null});se.template=`<div ref="row" class="tabs-row"></div><div ref="context" class="tabs-context"><slot></slot></div>`;var Cr=class Cr extends T{constructor(){super();u(this,"processInnerHtml",!0);u(this,"requireCtxName",!0);this.init$={...this.init$,output:null}}get dict(){return vr.dict}get validationInput(){return this._validationInputElement}initCallback(){if(super.initCallback(),this.hasAttribute(this.dict.FORM_INPUT_ATTR)){this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer);let t=document.createElement("input");t.type="text",t.name="__UPLOADCARE_VALIDATION_INPUT__",t.required=this.hasAttribute(this.dict.INPUT_REQUIRED),t.tabIndex=-1,Gi(t,{opacity:0,height:0,width:0}),this.appendChild(t),this._validationInputElement=t}this.sub("output",t=>{var i,s;if(this.hasAttribute(this.dict.FIRE_EVENT_ATTR)&&this.dispatchEvent(new CustomEvent(this.dict.EVENT_NAME,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:t}})),this.hasAttribute(this.dict.FORM_INPUT_ATTR)&&this._dynamicInputsContainer){this._dynamicInputsContainer.innerHTML="";let n=[],o=[];Array.isArray(t)?(n=t.map(a=>a.cdnUrl),o=t):t!=null&&t.files&&(n=t.groupData?[t.groupData.cdnUrl]:[],o=t.files);for(let a of n){let c=document.createElement("input");c.type="hidden",c.name=this.getAttribute(this.dict.INPUT_NAME_ATTR)||this.ctxName,c.value=a!=null?a:"",this._dynamicInputsContainer.appendChild(c)}if(this._validationInputElement){this._validationInputElement.value=n.length?"__VALUE__":"";let a=o.find(p=>!p.isValid),c=(s=a==null?void 0:a.validationErrorMessage)!=null?s:(i=a==null?void 0:a.uploadError)==null?void 0:i.message,h=this.$["*message"];h=h!=null&&h.isError?`${h.caption}. ${h.text}`:void 0;let d=c!=null?c:h;d?this._validationInputElement.setCustomValidity(d):this._validationInputElement.setCustomValidity("")}}this.hasAttribute(this.dict.CONSOLE_ATTR)&&console.log(t)},!1),this.sub(this.dict.SRC_CTX_KEY,async t=>{if(!t||!t.length){this.$.output=null;return}if(this.cfg.groupOutput||this.hasAttribute(this.dict.GROUP_ATTR)){if(!t.every(a=>a.isUploaded&&a.isValid)){this.$.output={groupData:void 0,files:t};return}let s=this.getUploadClientOptions(),n=t.map(a=>a.uuid+(a.cdnUrlModifiers?`/${a.cdnUrlModifiers}`:"")),o=await Qr(n,s);this.$.output={groupData:o,files:t}}else this.$.output=t},!1)}};l(Cr,"DataOutputClass");var Di=Cr;Di.dict=Object.freeze({SRC_CTX_KEY:"*outputData",EVENT_NAME:"lr-data-output",FIRE_EVENT_ATTR:"use-event",CONSOLE_ATTR:"use-console",GROUP_ATTR:"use-group",FORM_INPUT_ATTR:"use-input",INPUT_NAME_ATTR:"input-name",INPUT_REQUIRED:"input-required"});var vr=Di;var wr=class wr extends b{};l(wr,"ActivityHeader");var Fi=wr;var Tr=class Tr extends y{constructor(){super(...arguments);u(this,"init$",{...this.init$,currentText:"",options:[],selectHtml:"",onSelect:t=>{var i;t.preventDefault(),t.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=((i=this.$.options.find(s=>s.value==this.value))==null?void 0:i.text)||"",this.dispatchEvent(new Event("change"))}})}initCallback(){super.initCallback(),this.sub("options",t=>{var s;this.$.currentText=((s=t==null?void 0:t[0])==null?void 0:s.text)||"";let i="";t==null||t.forEach(n=>{i+=`<option value="${n.value}">${n.text}</option>`}),this.$.selectHtml=i})}};l(Tr,"Select");var Ye=Tr;Ye.template=`<button> {{currentText}} <lr-icon name="select"></lr-icon><select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select></button>`;var q={PLAY:"play",PAUSE:"pause",FS_ON:"fullscreen-on",FS_OFF:"fullscreen-off",VOL_ON:"unmute",VOL_OFF:"mute",CAP_ON:"captions",CAP_OFF:"captions-off"},no={requestFullscreen:r=>{r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen&&r.webkitRequestFullscreen()},exitFullscreen:()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}},Et=class Et extends y{constructor(){super(...arguments);u(this,"init$",{...this.init$,src:"",ppIcon:q.PLAY,fsIcon:q.FS_ON,volIcon:q.VOL_ON,capIcon:q.CAP_OFF,totalTime:"00:00",currentTime:"00:00",progressCssWidth:"0",hasSubtitles:!1,volumeDisabled:!1,volumeValue:0,onPP:()=>{this.togglePlay()},onFs:()=>{this.toggleFullscreen()},onCap:()=>{this.toggleCaptions()},onMute:()=>{this.toggleSound()},onVolChange:t=>{let i=parseFloat(t.currentTarget.$.value);this.setVolume(i)},progressClicked:t=>{let i=this.progress.getBoundingClientRect();this._video.currentTime=this._video.duration*(t.offsetX/i.width)}})}togglePlay(){this._video.paused||this._video.ended?this._video.play():this._video.pause()}toggleFullscreen(){(document.fullscreenElement||document.webkitFullscreenElement)===this?no.exitFullscreen():no.requestFullscreen(this)}toggleCaptions(){this.$.capIcon===q.CAP_OFF?(this.$.capIcon=q.CAP_ON,this._video.textTracks[0].mode="showing",window.localStorage.setItem(Et.is+":captions","1")):(this.$.capIcon=q.CAP_OFF,this._video.textTracks[0].mode="hidden",window.localStorage.removeItem(Et.is+":captions"))}toggleSound(){this.$.volIcon===q.VOL_ON?(this.$.volIcon=q.VOL_OFF,this.$.volumeDisabled=!0,this._video.muted=!0):(this.$.volIcon=q.VOL_ON,this.$.volumeDisabled=!1,this._video.muted=!1)}setVolume(t){window.localStorage.setItem(Et.is+":volume",t);let i=t?t/100:0;this._video.volume=i}get progress(){return this.ref.progress}_getUrl(t){return t.includes("/")?t:`https://ucarecdn.com/${t}/`}_desc2attrs(t){let i=[];for(let s in t){let n=s==="src"?this._getUrl(t[s]):t[s];i.push(`${s}="${n}"`)}return i.join(" ")}_timeFmt(t){let i=new Date(Math.round(t)*1e3);return[i.getMinutes(),i.getSeconds()].map(s=>s<10?"0"+s:s).join(":")}_initTracks(){[...this._video.textTracks].forEach(t=>{t.mode="hidden"}),window.localStorage.getItem(Et.is+":captions")&&this.toggleCaptions()}_castAttributes(){let t=["autoplay","loop","muted"];[...this.attributes].forEach(i=>{t.includes(i.name)&&this._video.setAttribute(i.name,i.value)})}initCallback(){super.initCallback(),this._video=this.ref.video,this._castAttributes(),this._video.addEventListener("play",()=>{this.$.ppIcon=q.PAUSE,this.setAttribute("playback","")}),this._video.addEventListener("pause",()=>{this.$.ppIcon=q.PLAY,this.removeAttribute("playback")}),this.addEventListener("fullscreenchange",i=>{console.log(i),document.fullscreenElement===this?this.$.fsIcon=q.FS_OFF:this.$.fsIcon=q.FS_ON}),this.sub("src",i=>{if(!i)return;let s=this._getUrl(i);this._video.src=s}),this.sub("video",async i=>{if(!i)return;let s=await(await window.fetch(this._getUrl(i))).json();s.poster&&(this._video.poster=this._getUrl(s.poster));let n="";s==null||s.sources.forEach(o=>{n+=`<source ${this._desc2attrs(o)} />`}),s.tracks&&(s.tracks.forEach(o=>{n+=`<track ${this._desc2attrs(o)} />`}),this.$.hasSubtitles=!0),this._video.innerHTML+=n,this._initTracks(),console.log(s)}),this._video.addEventListener("loadedmetadata",i=>{this.$.currentTime=this._timeFmt(this._video.currentTime),this.$.totalTime=this._timeFmt(this._video.duration)}),this._video.addEventListener("timeupdate",i=>{let s=Math.round(100*(this._video.currentTime/this._video.duration));this.$.progressCssWidth=s+"%",this.$.currentTime=this._timeFmt(this._video.currentTime)});let t=window.localStorage.getItem(Et.is+":volume");if(t){let i=parseFloat(t);this.setVolume(i),this.$.volumeValue=i}}};l(Et,"Video");var re=Et;re.template=`<div class="video-wrapper"><video ref="video" preload="metadata" crossorigin="anonymous"></video></div><div class="toolbar"><div class="progress" ref="progress" set -onclick="progressClicked"><div class="bar" set -style.width="progressCssWidth"></div></div><div class="tb-block"><button set -onclick="onPP"><lr-icon set -@name="ppIcon"></lr-icon></button><div class="timer">{{currentTime}} / {{totalTime}}</div></div><div class="tb-block"><button set -onclick="onCap" -@hidden="!hasSubtitles"><lr-icon set -@name="capIcon"></lr-icon></button><button set -onclick="onMute"><lr-icon set -@name="volIcon"></lr-icon></button><lr-range type="range" set -onchange="onVolChange" -@disabled="volumeDisabled" -value="volumeValue"></lr-range><button set -onclick="onFs"><lr-icon set -@name="fsIcon"></lr-icon></button></div></div>`;re.bindAttributes({video:"video",src:"src"});var wa="css-src";function Ze(r){return class extends r{constructor(){super(...arguments);u(this,"renderShadow",!0);u(this,"pauseRender",!0);u(this,"requireCtxName",!0)}shadowReadyCallback(){}initCallback(){super.initCallback(),this.setAttribute("hidden",""),ni({element:this,attribute:wa,onSuccess:t=>{this.attachShadow({mode:"open"});let i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t,i.onload=()=>{window.requestAnimationFrame(()=>{this.render(),window.setTimeout(()=>{this.removeAttribute("hidden"),this.shadowReadyCallback()})})},this.shadowRoot.prepend(i)},onTimeout:()=>{console.error("Attribute `css-src` is required and it is not set. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/")}})}}}l(Ze,"shadowed");var xr=class xr extends Ze(y){};l(xr,"ShadowWrapper");var ne=xr;var Bi=class Bi extends y{initCallback(){super.initCallback(),this.subConfigValue("removeCopyright",e=>{this.toggleAttribute("hidden",!!e)})}};l(Bi,"Copyright"),u(Bi,"template",`<a href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4" target="_blank noopener" class="credits" >Powered by Uploadcare</a >`);var Vi=Bi;var Er=class Er extends ne{constructor(){super(...arguments);u(this,"requireCtxName",!0);u(this,"init$",gi(this));u(this,"_template",null)}static set template(t){this._template=t+"<slot></slot>"}static get template(){return this._template}};l(Er,"SolutionBlock");var At=Er;var Ar=class Ar extends At{};l(Ar,"FileUploaderRegular");var Je=Ar;Je.template=`<lr-simple-btn></lr-simple-btn><lr-modal strokes block-body-scrolling><lr-start-from><lr-drop-area with-icon clickable></lr-drop-area><lr-source-list wrap></lr-source-list><button type="button" l10n="start-from-cancel" class="secondary-btn" set="onclick: *historyBack"></button><lr-copyright></lr-copyright></lr-start-from><lr-upload-list></lr-upload-list><lr-camera-source></lr-camera-source><lr-url-source></lr-url-source><lr-external-source></lr-external-source><lr-cloud-image-editor-activity></lr-cloud-image-editor-activity></lr-modal><lr-message-box></lr-message-box><lr-progress-bar-common></lr-progress-bar-common>`;var $r=class $r extends At{constructor(){super(...arguments);u(this,"pauseRender",!0)}shadowReadyCallback(){let t=this.ref.uBlock;this.sub("*currentActivity",i=>{i||(this.$["*currentActivity"]=t.initActivity||b.activities.START_FROM)}),this.sub("*uploadList",i=>{(i==null?void 0:i.length)>0?this.$["*currentActivity"]=b.activities.UPLOAD_LIST:this.$["*currentActivity"]=t.initActivity||b.activities.START_FROM}),this.subConfigValue("sourceList",i=>{i!=="local"&&(this.cfg.sourceList="local")}),this.subConfigValue("confirmUpload",i=>{i!==!1&&(this.cfg.confirmUpload=!1)})}};l($r,"FileUploaderMinimal");var Qe=$r;Qe.template=`<lr-start-from><lr-drop-area clickable l10n="choose-file"></lr-drop-area><lr-copyright></lr-copyright></lr-start-from><lr-upload-list ref="uBlock"></lr-upload-list><lr-message-box></lr-message-box>`;var Sr=class Sr extends At{constructor(){super(),this.init$={...this.init$,couldCancel:!1,cancel:()=>{this.couldHistoryBack?this.$["*historyBack"]():this.couldShowList&&(this.$["*currentActivity"]=b.activities.UPLOAD_LIST)}}}get couldHistoryBack(){let e=this.$["*history"];return e.length>1&&e[e.length-1]!==b.activities.START_FROM}get couldShowList(){return this.cfg.showEmptyList||this.$["*uploadList"].length>0}shadowReadyCallback(){let e=this.ref.uBlock;this.sub("*currentActivity",t=>{t||(this.$["*currentActivity"]=e.initActivity||b.activities.START_FROM)}),this.sub("*uploadList",t=>{(t==null?void 0:t.length)>0&&this.$["*currentActivity"]===(e.initActivity||b.activities.START_FROM)&&(this.$["*currentActivity"]=b.activities.UPLOAD_LIST)}),this.sub("*history",()=>{this.$.couldCancel=this.couldHistoryBack||this.couldShowList})}};l(Sr,"FileUploaderInline");var ti=Sr;ti.template=`<lr-start-from><lr-drop-area with-icon clickable></lr-drop-area><lr-source-list wrap></lr-source-list><button type="button" l10n="start-from-cancel" class="cancel-btn secondary-btn" set="onclick: cancel; @hidden: !couldCancel" ></button><lr-copyright></lr-copyright></lr-start-from><lr-upload-list ref="uBlock"></lr-upload-list><lr-camera-source></lr-camera-source><lr-url-source></lr-url-source><lr-external-source></lr-external-source><lr-message-box></lr-message-box><lr-progress-bar></lr-progress-bar><lr-cloud-image-editor-activity></lr-cloud-image-editor-activity>`;var Ir=class Ir extends Ze(lt){shadowReadyCallback(){this.__shadowReady=!0,this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async initEditor(){this.__shadowReady&&await super.initEditor()}};l(Ir,"CloudImageEditor");var zi=Ir;function ji(r){for(let e in r){let t=[...e].reduce((i,s)=>(s.toUpperCase()===s&&(s="-"+s.toLowerCase()),i+=s),"");t.startsWith("-")&&(t=t.replace("-","")),t.startsWith("lr-")||(t="lr-"+t),r[e].reg&&r[e].reg(t)}}l(ji,"registerBlocks");var Or="LR";async function oo(r,e=!1){return new Promise((t,i)=>{if(typeof document!="object"){t(null);return}if(typeof window=="object"&&window[Or]){t(window[Or]);return}let s=document.createElement("script");s.async=!0,s.src=r,s.onerror=()=>{i()},s.onload=()=>{let n=window[Or];e&&ji(n),t(n)},document.head.appendChild(s)})}l(oo,"connectBlocksFrom");return mo(Ta);})();